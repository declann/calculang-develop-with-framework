/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/@tidyjs/tidy@2.5.2/dist/es/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{ascending as n,group as t,fsum as e,shuffle as r,extent as o,Adder as u,min as c,max as s,median as f,deviation as i,variance as l}from"../../d3-array@2.12.1/_esm.js";function a(n,...t){if("function"==typeof n)throw new Error("You must supply the data as the first argument to tidy()");let e=n;for(const n of t)n&&(e=n(e));return e}function p(n){return t=>t.filter(n)}function y(n,t){return e=>{if("function"==typeof n){if(!n(e))return e}else if(!n)return e;return a(e,...t)}}function d(n){return t=>t.map(n)}function h(n){return null==n?[]:Array.isArray(n)?n:[n]}function g(n){return t=>{if(!(n=h(n)).length){const n=new Set;for(const e of t)n.add(e);return Array.from(n)}const e=new Map,r=[],o=n[n.length-1];for(const u of t){let t=e,c=!1;for(const e of n){const n="function"==typeof e?e(u):u[e];if(e===o){c=t.has(n),c||(r.push(u),t.set(n,!0));break}t.has(n)||t.set(n,new Map),t=t.get(n)}}return r}}function m(n){return t=>{const e=h(n).map((n=>"function"==typeof n?1===n.length?b(n):n:b(n)));return t.slice().sort(((n,t)=>{for(const r of e){const e=r(n,t);if(e)return e}return 0}))}}function b(n){const t="function"==typeof n?n:t=>t[n];return function(n,e){return w(t(n),t(e),!1)}}function v(n){const t="function"==typeof n?n:t=>t[n];return function(n,e){return w(t(n),t(e),!0)}}function j(n,t,e){let{position:r="start"}=null!=e?e:{};const o="end"===r?-1:1,u=new Map;for(let n=0;n<t.length;++n)u.set(t[n],n);const c="function"==typeof n?n:t=>t[n];return function(n,t){var e,r;const s=null!=(e=u.get(c(n)))?e:-1,f=null!=(r=u.get(c(t)))?r:-1;return s>=0&&f>=0?s-f:s>=0?-1*o:f>=0?1*o:0}}function w(t,e,r){let o=r?e:t,u=r?t:e;if(k(o)&&k(u)){const n=(o!=o?0:null===o?1:2)-(u!=u?0:null===u?1:2);return r?-n:n}return k(o)?r?-1:1:k(u)?r?1:-1:n(o,u)}function k(n){return null==n||n!=n}function A(n,t){return e=>{t=null!=t?t:{};const r={},o=Object.keys(n);for(const t of o)r[t]=n[t](e);if(t.rest&&e.length){const n=Object.keys(e[0]);for(const u of n)o.includes(u)||(r[u]=t.rest(u)(e))}return[r]}}function O(n,t,e,r){if(!n.length)return[];const o={};let u;if(null==r)u=Object.keys(n[0]);else{u=[];for(const t of h(r))"function"==typeof t?u.push(...t(n)):u.push(t)}for(const r of u){if(e){if(!e(n.map((n=>n[r]))))continue}o[r]=t(r)(n)}return[o]}function S(n){return t=>O(t,n)}function M(n,t){return e=>O(e,t,n)}function x(n,t){return e=>O(e,t,void 0,n)}function $(n){return t=>{const e=t.map((n=>({...n})));let r=0;for(const t of e){for(const o in n){const u=n[o],c="function"==typeof u?u(t,r,e):u;t[o]=c}++r}return e}}function E(n,t){return e=>{const r=A(n)(e),o=$(t)(r);return[...e,...o]}}function T(n,t){return e=>{const r=S(n)(e),o=$(t)(r);return[...e,...o]}}function U(n,t,e){return r=>{const o=M(n,t)(r),u=$(e)(o);return[...r,...u]}}function C(n,t,e){return r=>{const o=x(n,t)(r),u=$(e)(o);return[...r,...u]}}function F(n,t){if(null==n||"object"!=typeof n||Array.isArray(n))return n;const e=Object.fromEntries(t.filter((n=>"function"!=typeof n[0]&&null!=n[0])));return Object.assign(e,n)}function D(n,t,e,r,o,u=0){for(const[c,s]of n.entries()){const n=[...e,c];if(s instanceof Map){D(s,r(t,n,u),n,r,o,u+1)}else o(t,n,s,u)}return t}function L(n,t,e=(n=>n[n.length-1])){const r=new Map;return D(n,r,[],(function(n,t){const r=new Map;return n.set(e(t),r),r}),(function(n,r,o){n.set(e(r),t(o,r))})),r}const K=n=>n;function _(n,e,r){"function"==typeof e?e=[e]:2!==arguments.length||null==e||Array.isArray(e)||(r=e);return o=>{const u=function(n,e){const r=h(e).map(((n,t)=>{const e="function"==typeof n?n:t=>t[n],r=new Map;return t=>{const o=e(t),u=function(n){const t=typeof n;return null!=n&&("object"===t||"function"===t)}(o)?o.valueOf():o;if(r.has(u))return r.get(u);const c=[n,o];return r.set(u,c),c}})),o=t(n,...r);return o}(o,n),c=function(n,t,e){let r=n;if(!(null==t?void 0:t.length))return r;for(const n of t)n&&(r=L(r,((t,r)=>{let o=n(t,{groupKeys:r});return!1!==e&&(o=o.map((n=>F(n,r)))),o})));return r}(u,e,null==r?void 0:r.addGroupKeys);if(null==r?void 0:r.export)switch(r.export){case"grouped":return c;case"levels":return I(c,r);case"entries-obj":case"entriesObject":return I(c,{...r,export:"levels",levels:["entries-object"]});default:return I(c,{...r,export:"levels",levels:[r.export]})}const s=function(n,t){const e=[];return D(n,e,[],K,((n,e,r)=>{let o=r;!1!==t&&(o=r.map((n=>F(n,e)))),n.push(...o)})),e}(c,null==r?void 0:r.addGroupKeys);return s}}_.grouped=n=>({...n,export:"grouped"}),_.entries=n=>({...n,export:"entries"}),_.entriesObject=n=>({...n,export:"entries-object"}),_.object=n=>({...n,export:"object"}),_.map=n=>({...n,export:"map"}),_.keys=n=>({...n,export:"keys"}),_.values=n=>({...n,export:"values"}),_.levels=n=>({...n,export:"levels"});const G=n=>n.join("/");function I(n,t){const{groupFn:e,keyFn:r}=function(n){var t;const{flat:e,single:r,mapLeaf:o=K,mapLeaves:u=K,addGroupKeys:c}=n;let s;return n.flat&&(s=null!=(t=n.compositeKey)?t:G),{groupFn:(n,t)=>r?o(!1===c?n[0]:F(n[0],t)):u(n.map((n=>o(!1===c?n:F(n,t))))),keyFn:e?n=>s(n.map((n=>n[1]))):n=>n[n.length-1][1]}}(t);let{mapEntry:o=K}=t;const{levels:u=["entries"]}=t,c=[];for(const n of u)switch(n){case"entries":case"entries-object":case"entries-obj":case"entriesObject":{const e="entries-object"!==n&&"entries-obj"!==n&&"entriesObject"!==n||null!=t.mapEntry?o:([n,t])=>({key:n,values:t});c.push({id:"entries",createEmptySubgroup:()=>[],addSubgroup:(n,t,r,o)=>{n.push(e([r,t],o))},addLeaf:(n,t,r,o)=>{n.push(e([t,r],o))}});break}case"map":c.push({id:"map",createEmptySubgroup:()=>new Map,addSubgroup:(n,t,e)=>{n.set(e,t)},addLeaf:(n,t,e)=>{n.set(t,e)}});break;case"object":c.push({id:"object",createEmptySubgroup:()=>({}),addSubgroup:(n,t,e)=>{n[e]=t},addLeaf:(n,t,e)=>{n[t]=e}});break;case"keys":c.push({id:"keys",createEmptySubgroup:()=>[],addSubgroup:(n,t,e)=>{n.push([e,t])},addLeaf:(n,t)=>{n.push(t)}});break;case"values":c.push({id:"values",createEmptySubgroup:()=>[],addSubgroup:(n,t)=>{n.push(t)},addLeaf:(n,t,e)=>{n.push(e)}});break;default:"object"==typeof n&&c.push(n)}return D(n,c[0].createEmptySubgroup(),[],((n,e,o)=>{var u,s;if(t.flat)return n;const f=null!=(u=c[o])?u:c[c.length-1],i=(null!=(s=c[o+1])?s:f).createEmptySubgroup();return f.addSubgroup(n,i,r(e),o),i}),((n,t,o,u)=>{var s;(null!=(s=c[u])?s:c[c.length-1]).addLeaf(n,r(t),e(o,t),u)}))}function R(n){if(null==n?void 0:n.predicate){const t=n.predicate;return n=>n.reduce(((e,r,o)=>t(r,o,n)?e+1:e),0)}return n=>n.length}function Y(n,t){let r="function"==typeof n?n:t=>t[n];if(null==t?void 0:t.predicate){const n=r,e=t.predicate;r=(t,r,o)=>e(t,r,o)?n(t,r,o):0}return n=>e(n,r)}function z(n){return t=>{const{name:e="n",wt:r}=null!=n?n:{};return A({[e]:null==r?R():Y(r)})(t)}}function q(n,t){return e=>{t=null!=t?t:{};const{name:r="n",sort:o}=t;return a(e,_(n,[z(t)]),o?m(v(r)):K)}}function B(n){return t=>t.map((t=>{var e;const r={},o=Object.keys(t);for(const u of o){r[null!=(e=n[u])?e:u]=t[u]}return r}))}function N(n,t){return e=>e.slice(n,t)}const Z=n=>N(0,n),H=n=>N(-n);function J(n,t){return e=>m(t)(e).slice(0,n)}function P(n,t){return e=>"function"==typeof t?m(t)(e).slice(-n).reverse():m(v(t))(e).slice(0,n)}function Q(n,t){t=null!=t?t:{};const{replace:e}=t;return t=>{if(!t.length)return t.slice();if(e){const e=[];for(let r=0;r<n;++r)e.push(t[Math.floor(Math.random()*t.length)]);return e}return r(t.slice()).slice(0,n)}}function V(n,t){if(0===n.length||0===t.length)return{};const e=Object.keys(n[0]),r=Object.keys(t[0]),o={};for(const n of e)r.includes(n)&&(o[n]=n);return o}function W(n){if(Array.isArray(n)){const t={};for(const e of n)t[e]=e;return t}return"object"==typeof n?n:{[n]:n}}function X(n,t,e){for(const r in e){if(n[e[r]]!==t[r])return!1}return!0}function nn(n,t){return e=>{const r=null==(null==t?void 0:t.by)?V(e,n):W(t.by);return e.flatMap((t=>n.filter((n=>X(t,n,r))).map((n=>({...t,...n})))))}}function tn(n,t){return e=>{if(!n.length)return e;const r=null==(null==t?void 0:t.by)?V(e,n):W(t.by),o=Object.keys(n[0]),u=e.flatMap((t=>{const e=n.filter((n=>X(t,n,r)));if(e.length)return e.map((n=>({...t,...n})));const u=Object.fromEntries(o.filter((n=>null==t[n])).map((n=>[n,void 0])));return{...t,...u}}));return u}}function en(n,t){return e=>{if(!n.length)return e;if(!e.length)return n;const r=null==(null==t?void 0:t.by)?V(e,n):W(t.by),o=new Map,u=Object.keys(n[0]),c=e.flatMap((t=>{const e=n.filter((n=>{const e=X(t,n,r);return e&&o.set(n,!0),e}));if(e.length)return e.map((n=>({...t,...n})));const c=Object.fromEntries(u.filter((n=>null==t[n])).map((n=>[n,void 0])));return{...t,...c}}));if(o.size<n.length){const t=Object.fromEntries(Object.keys(e[0]).map((n=>[n,void 0])));for(const e of n)o.has(e)||c.push({...t,...e})}return c}}function rn(n){return t=>{const e=t.map((n=>({...n})));for(const r in n){const o=n[r],u="function"==typeof o?o(e):o,c=(null==u?void 0:u[Symbol.iterator])&&"string"!=typeof u?u:t.map((()=>u));let s=-1;for(const n of e)n[r]=c[++s]}return e}}function on(n){if(n.length<1)return[];return Object.keys(n[0])}function un(){return n=>on(n)}function cn(n,t){let e=[];for(const r of h(t))"function"==typeof r?e.push(...r(n)):e.push(r);e.length&&"-"===e[0][0]&&(e=[...un()(n),...e]);const r={},o=[];for(let n=e.length-1;n>=0;n--){const t=e[n];"-"!==t[0]?r[t]?r[t]=!1:o.unshift(t):r[t.substring(1)]=!0}return e=Array.from(new Set(o)),e}function sn(n){return t=>{let e=cn(t,n);return e.length?t.map((n=>{const t={};for(const r of e)t[r]=n[r];return t})):t}}function fn(n){return t=>{const e=$(n)(t);return sn(Object.keys(n))(e)}}function ln(n){return t=>"function"==typeof n?[...t,...h(n(t))]:[...t,...h(n)]}function an(n){return t=>{const{namesFrom:e,valuesFrom:r,valuesFill:o,valuesFillMap:u,namesSep:c="_"}=n,s=Array.isArray(e)?e:[e],f=Array.isArray(r)?r:[r];if(!t.length)return[];const i=Object.keys(t[0]).filter((n=>!s.includes(n)&&!f.includes(n))),l={};for(const n of t)for(const t of s)null==l[t]&&(l[t]={}),l[t][n[t]]=!0;const p=[];for(const n in l)p.push(Object.keys(l[n]));const y={},d=function(n="_",t){function e(t,r,o){if(!o.length&&null!=r)return void t.push(r);const u=o[0],c=o.slice(1);for(const o of u)e(t,null==r?o:`${r}${n}${o}`,c)}const r=[];return e(r,null,t),r}(c,p);for(const n of d)if(1!==f.length)for(const t of f)y[`${t}${c}${n}`]=null!=u?u[t]:o;else y[n]=null!=u?u[f[0]]:o;function h(n){if(!n.length)return[];const t={...y};for(const e of i)t[e]=n[0][e];for(const e of n){const n=s.map((n=>e[n])).join(c);if(1!==f.length)for(const r of f)t[`${r}${c}${n}`]=e[r];else t[n]=e[f[0]]}return[t]}if(!i.length)return h(t);return a(t,_(i,[h]))}}function pn(n){return t=>{var e;const{namesTo:r,valuesTo:o,namesSep:u="_"}=n,c=cn(t,null!=(e=n.cols)?e:[]),s=Array.isArray(r)?r:[r],f=Array.isArray(o)?o:[o],i=s.length>1,l=f.length>1,a=[];for(const n of t){const t=Object.keys(n).filter((n=>!c.includes(n))),e={};for(const r of t)e[r]=n[r];const r=l?Array.from(new Set(c.map((n=>n.substring(n.indexOf(u)+1))))):c;for(const t of r){const r={...e};for(const e of f){const o=l?`${e}${u}${t}`:t,c=i?t.split(u):[t];let f=0;for(const t of s){const u=c[f++];r[t]=u,r[e]=n[o]}}a.push(r)}}return a}}function yn(n){return t=>{const e=function(n){if(Array.isArray(n)){const t={};for(const e of n)t[e]=e;return t}if("object"==typeof n)return n;return{[n]:n}}(n),r=[];for(const n in e){const o=e[n];let u;u="function"==typeof o?o(t):Array.isArray(o)?o:Array.from(new Set(t.map((t=>t[n])))),r.push(u.map((t=>({[n]:t}))))}return function(n){function t(n,e,r){if(!r.length&&null!=e)return void n.push(e);const o=r[0],u=r.slice(1);for(const r of o)t(n,{...e,...r},u)}const e=[];return t(e,null,n),e}(r)}}function dn(n,t=1){let[e,r]=o(n);const u=[];let c=e;for(;c<=r;)u.push(c),c+=t;return u}function hn(n,t="day",e=1){let[r,u]=o(n);const c=[];let s=new Date(r);for(;s<=u;)if(c.push(new Date(s)),"second"===t||"s"===t||"seconds"===t)s.setUTCSeconds(s.getUTCSeconds()+1*e);else if("minute"===t||"min"===t||"minutes"===t)s.setUTCMinutes(s.getUTCMinutes()+1*e);else if("day"===t||"d"===t||"days"===t)s.setUTCDate(s.getUTCDate()+1*e);else if("week"===t||"w"===t||"weeks"===t)s.setUTCDate(s.getUTCDate()+7*e);else if("month"===t||"m"===t||"months"===t)s.setUTCMonth(s.getUTCMonth()+1*e);else{if("year"!==t&&"y"!==t&&"years"!==t)throw new Error("Invalid granularity for date sequence: "+t);s.setUTCFullYear(s.getUTCFullYear()+1*e)}return c}function gn(n,t){return function(e){t=null!=t?t:1;const r="function"==typeof n?n:t=>t[n];return dn(e.map(r),t)}}function mn(n,t,e){return function(r){t=null!=t?t:"day",e=null!=e?e:1;const o="function"==typeof n?n:t=>t[n];return hn(r.map(o),t,e)}}function bn(n,t,e){return function(r){t=null!=t?t:"day",e=null!=e?e:1;const o="function"==typeof n?n:t=>t[n];return hn(r.map((n=>new Date(o(n)))),t,e).map((n=>n.toISOString()))}}function vn(n){return t=>{const e=[];for(const r of t){const t={...r};for(const e in n)null==t[e]&&(t[e]=n[e]);e.push(t)}return e}}function jn(n,t){return e=>{const r=yn(n)(e),o=tn(e)(r);return t?vn(t)(o):o}}function wn(n){return t=>{const e=h(n),r={};return t.map((n=>{const t={...n};for(const n of e)null!=t[n]?r[n]=t[n]:null!=r[n]&&(t[n]=r[n]);return t}))}}function kn(n,t){return(e,r)=>{var o;let u="[tidy.debug";if(null==(o=null==r?void 0:r.groupKeys)?void 0:o.length){const n=r.groupKeys.map((n=>n.join(": "))).join(", ");n.length&&(u+="|"+n)}t=null!=t?t:{};const{limit:c=10,output:s="table"}=t,f="--------------------------------------------------------------------------------";let i=80;const l=u+"]"+(null==n?"":" "+n);return i=Math.max(0,i-(l.length+2)),console.log(`${l} ${f.substring(0,i)}`),console[s](null==c||c>=e.length?e:e.slice(0,c)),e}}function An(n,t,e){return null==n||null==t?void 0:0===t&&0===n?0:e||0!==t?n/t:void 0}var On=Object.freeze({__proto__:null,add:function(n,t,e){return null==n||null==t?e?(null!=n?n:0)+(null!=t?t:0):void 0:n+t},rate:An,subtract:function(n,t,e){return null==n||null==t?e?(null!=n?n:0)-(null!=t?t:0):void 0:n-t}});function Sn(n,t,e){const r="function"==typeof n?n:t=>t[n],o="function"==typeof t?t:n=>n[t],{predicate:u,allowDivideByZero:c}=null!=e?e:{};return null==u?(n,t,e)=>{const u=o(n,t,e);return An(r(n,t,e),u,c)}:(n,t,e)=>{if(!u(n,t,e))return;const s=o(n,t,e);return An(r(n,t,e),s,c)}}function Mn(n){const t="function"==typeof n?n:t=>t[n];return n=>function(n,t){let e=new u,r=0;return Float64Array.from(n,(o=>e.add(+(t(o,r++,n)||0))))}(n,t)}function xn(n,t,e){const{partial:r=!1,align:o="right"}=null!=e?e:{},u=Math.floor(n/2);return e=>e.map(((c,s)=>{const f="right"===o?s:"center"===o?s+u:s+n-1;if(!r&&(f-n+1<0||f>=e.length))return;const i=Math.max(0,f-n+1),l=e.slice(i,f+1);return t(l,f)}))}function $n(n,t){const e="function"==typeof n?n:t=>t[n],{n:r=1,default:o}=null!=t?t:{};return n=>n.map(((t,u)=>{const c=n[u-r];return null==c?o:e(c,u,n)}))}function En(n,t){const e="function"==typeof n?n:t=>t[n],{n:r=1,default:o}=null!=t?t:{};return n=>n.map(((t,u)=>{const c=n[u+r];return null==c?o:e(c,u,n)}))}function Tn(n){var t;const e=null!=(t=null==n?void 0:n.startAt)?t:0;return n=>n.map(((n,t)=>t+e))}function Un(n){const t="function"==typeof n?n:t=>t[n];return n=>c(n,t)}function Cn(n){const t="function"==typeof n?n:t=>t[n];return n=>s(n,t)}function Fn(n){const t="function"==typeof n?n:t=>t[n];return n=>function(n,t){let r=0;for(let e=0;e<n.length;++e){const o=t(n[e],e,n);+o===o&&(r+=1)}return r?e(n,t)/r:void 0}(n,t)}function Dn(n,t){const r="function"==typeof n?n:t=>t[n],o="function"==typeof t?t:n=>n[t];return n=>An(e(n,r),e(n,o))}function Ln(n){const t="function"==typeof n?n:t=>t[n];return n=>f(n,t)}function Kn(n){const t="function"==typeof n?n:t=>t[n];return n=>i(n,t)}function _n(n){const t="function"==typeof n?n:t=>t[n];return n=>l(n,t)}function Gn(n,t={}){const e="function"==typeof n?n:t=>t[n];return n=>{const r=new Map;let o=0,u=0;for(const c of n){const s=e(c,u++,n);if(!r.has(s)){if(!t.includeUndefined&&void 0===s||!1===t.includeNull&&null===s)continue;o+=1,r.set(s,!0)}}return o}}function In(n){const t="function"==typeof n?n:t=>t[n];return n=>n.length?t(n[0]):void 0}function Rn(n){const t="function"==typeof n?n:t=>t[n];return n=>n.length?t(n[n.length-1]):void 0}function Yn(n,t=!0){return e=>{const r=new RegExp(`^${n}`,t?"i":void 0);return on(e).filter((n=>r.test(n)))}}function zn(n,t=!0){return e=>{const r=new RegExp(`${n}$`,t?"i":void 0);return on(e).filter((n=>r.test(n)))}}function qn(n,t=!0){return e=>{const r=new RegExp(n,t?"i":void 0);return on(e).filter((n=>r.test(n)))}}function Bn(n){return t=>on(t).filter((t=>n.test(t)))}function Nn(n,t,e){return r=>{const o=on(r),u=[];for(let r=t[0];r<=t[1];++r){const t=null==e?r:new String("00000000"+r).slice(-e);u.push(`${n}${t}`)}return o.filter((n=>u.includes(n)))}}function Zn(n){return t=>{let e=new Set;for(const r of h(n))if("function"==typeof r){const n=r(t);for(const t of n)e.add(t)}else e.add(r);return Array.from(e).map((n=>`-${n}`))}}export{On as TMath,ln as addItems,ln as addRows,m as arrange,b as asc,jn as complete,qn as contains,q as count,Mn as cumsum,kn as debug,v as desc,Kn as deviation,g as distinct,zn as endsWith,un as everything,yn as expand,wn as fill,p as filter,In as first,j as fixedOrder,en as fullJoin,gn as fullSeq,mn as fullSeqDate,bn as fullSeqDateISOString,_ as groupBy,nn as innerJoin,$n as lag,Rn as last,En as lead,tn as leftJoin,d as map,Bn as matches,Cn as max,Fn as mean,Dn as meanRate,Ln as median,Un as min,$ as mutate,rn as mutateWithSummary,R as n,Gn as nDistinct,Zn as negate,Nn as numRange,sn as pick,pn as pivotLonger,an as pivotWider,Sn as rate,B as rename,vn as replaceNully,xn as roll,Tn as rowNumber,sn as select,N as slice,Z as sliceHead,P as sliceMax,J as sliceMin,Q as sliceSample,H as sliceTail,m as sort,Yn as startsWith,Y as sum,A as summarize,S as summarizeAll,x as summarizeAt,M as summarizeIf,z as tally,a as tidy,E as total,T as totalAll,C as totalAt,U as totalIf,fn as transmute,_n as variance,dn as vectorSeq,hn as vectorSeqDate,y as when};export default null;
