/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/compassql@0.21.2/build/compassql.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var e="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t=[],n=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,i=!1;function o(){i=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=0;r<64;++r)t[r]=e[r],n[e.charCodeAt(r)]=r;n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63}function a(e,n,r){for(var i,o,a=[],s=n;s<r;s+=3)i=(e[s]<<16)+(e[s+1]<<8)+e[s+2],a.push(t[(o=i)>>18&63]+t[o>>12&63]+t[o>>6&63]+t[63&o]);return a.join("")}function s(e){var n;i||o();for(var r=e.length,s=r%3,c="",u=[],l=16383,d=0,f=r-s;d<f;d+=l)u.push(a(e,d,d+l>f?f:d+l));return 1===s?(n=e[r-1],c+=t[n>>2],c+=t[n<<4&63],c+="=="):2===s&&(n=(e[r-2]<<8)+e[r-1],c+=t[n>>10],c+=t[n>>4&63],c+=t[n<<2&63],c+="="),u.push(c),u.join("")}function c(e,t,n,r,i){var o,a,s=8*i-r-1,c=(1<<s)-1,u=c>>1,l=-7,d=n?i-1:0,f=n?-1:1,h=e[t+d];for(d+=f,o=h&(1<<-l)-1,h>>=-l,l+=s;l>0;o=256*o+e[t+d],d+=f,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=r;l>0;a=256*a+e[t+d],d+=f,l-=8);if(0===o)o=1-u;else{if(o===c)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,r),o-=u}return(h?-1:1)*a*Math.pow(2,o-r)}function u(e,t,n,r,i,o){var a,s,c,u=8*o-i-1,l=(1<<u)-1,d=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:o-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),(t+=a+d>=1?f/c:f*Math.pow(2,1-d))*c>=2&&(a++,c/=2),a+d>=l?(s=0,a=l):a+d>=1?(s=(t*c-1)*Math.pow(2,i),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),a=0));i>=8;e[n+h]=255&s,h+=p,s/=256,i-=8);for(a=a<<i|s,u+=i;u>0;e[n+h]=255&a,h+=p,a/=256,u-=8);e[n+h-p]|=128*g}var l={}.toString,d=Array.isArray||function(e){return"[object Array]"==l.call(e)};function f(){return p.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function h(e,t){if(f()<t)throw new RangeError("Invalid typed array length");return p.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=p.prototype:(null===e&&(e=new p(t)),e.length=t),e}function p(e,t,n){if(!(p.TYPED_ARRAY_SUPPORT||this instanceof p))return new p(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return y(this,e)}return g(this,e,t,n)}function g(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);p.TYPED_ARRAY_SUPPORT?(e=t).__proto__=p.prototype:e=v(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!p.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|w(t,n);e=h(e,r);var i=e.write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(b(t)){var n=0|E(t.length);return 0===(e=h(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?h(e,0):v(e,t);if("Buffer"===t.type&&d(t.data))return v(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function m(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function y(e,t){if(m(t),e=h(e,t<0?0:0|E(t)),!p.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function v(e,t){var n=t.length<0?0:0|E(t.length);e=h(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function E(e){if(e>=f())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+f().toString(16)+" bytes");return 0|e}function b(e){return!(null==e||!e._isBuffer)}function w(e,t){if(b(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return Q(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return V(e).length;default:if(r)return Q(e).length;t=(""+t).toLowerCase(),r=!0}}function T(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return F(this,t,n);case"utf8":case"utf-8":return P(this,t,n);case"ascii":return k(this,t,n);case"latin1":case"binary":return D(this,t,n);case"base64":return _(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function A(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function S(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=p.from(t,r)),b(t))return 0===t.length?-1:C(e,t,n,r,i);if("number"==typeof t)return t&=255,p.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):C(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function C(e,t,n,r,i){var o,a=1,s=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,s/=2,c/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var l=-1;for(o=n;o<s;o++)if(u(e,o)===u(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===c)return l*a}else-1!==l&&(o-=o-l),l=-1}else for(n+c>s&&(n=s-c),o=n;o>=0;o--){for(var d=!0,f=0;f<c;f++)if(u(e,o+f)!==u(t,f)){d=!1;break}if(d)return o}return-1}function N(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function O(e,t,n,r){return K(Q(t,e.length-n),e,n,r)}function x(e,t,n,r){return K(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function I(e,t,n,r){return x(e,t,n,r)}function U(e,t,n,r){return K(V(t),e,n,r)}function M(e,t,n,r){return K(function(e,t){for(var n,r,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)r=(n=e.charCodeAt(a))>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function _(e,t,n){return 0===t&&n===e.length?s(e):s(e.slice(t,n))}function P(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,a,s,c,u=e[i],l=null,d=u>239?4:u>223?3:u>191?2:1;if(i+d<=n)switch(d){case 1:u<128&&(l=u);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)>127&&(l=c);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(c=(15&u)<<12|(63&o)<<6|63&a)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(c=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&c<1114112&&(l=c)}null===l?(l=65533,d=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=d}return function(e){var t=e.length;if(t<=R)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=R));return n}(r)}p.TYPED_ARRAY_SUPPORT=void 0===e.TYPED_ARRAY_SUPPORT||e.TYPED_ARRAY_SUPPORT,f(),p.poolSize=8192,p._augment=function(e){return e.__proto__=p.prototype,e},p.from=function(e,t,n){return g(null,e,t,n)},p.TYPED_ARRAY_SUPPORT&&(p.prototype.__proto__=Uint8Array.prototype,p.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&p[Symbol.species]),p.alloc=function(e,t,n){return function(e,t,n,r){return m(t),t<=0?h(e,t):void 0!==n?"string"==typeof r?h(e,t).fill(n,r):h(e,t).fill(n):h(e,t)}(null,e,t,n)},p.allocUnsafe=function(e){return y(null,e)},p.allocUnsafeSlow=function(e){return y(null,e)},p.isBuffer=function(e){return null!=e&&(!!e._isBuffer||J(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&J(e.slice(0,0))}(e))},p.compare=function(e,t){if(!b(e)||!b(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},p.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},p.concat=function(e,t){if(!d(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return p.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=p.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!b(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},p.byteLength=w,p.prototype._isBuffer=!0,p.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)A(this,t,t+1);return this},p.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)A(this,t,t+3),A(this,t+1,t+2);return this},p.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)A(this,t,t+7),A(this,t+1,t+6),A(this,t+2,t+5),A(this,t+3,t+4);return this},p.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?P(this,0,e):T.apply(this,arguments)},p.prototype.equals=function(e){if(!b(e))throw new TypeError("Argument must be a Buffer");return this===e||0===p.compare(this,e)},p.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},p.prototype.compare=function(e,t,n,r,i){if(!b(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),a=(n>>>=0)-(t>>>=0),s=Math.min(o,a),c=this.slice(r,i),u=e.slice(t,n),l=0;l<s;++l)if(c[l]!==u[l]){o=c[l],a=u[l];break}return o<a?-1:a<o?1:0},p.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},p.prototype.indexOf=function(e,t,n){return S(this,e,t,n,!0)},p.prototype.lastIndexOf=function(e,t,n){return S(this,e,t,n,!1)},p.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return N(this,e,t,n);case"utf8":case"utf-8":return O(this,e,t,n);case"ascii":return x(this,e,t,n);case"latin1":case"binary":return I(this,e,t,n);case"base64":return U(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},p.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var R=4096;function k(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function D(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function F(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=q(e[o]);return i}function L(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function B(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function $(e,t,n,r,i,o){if(!b(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function Y(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function W(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function j(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function H(e,t,n,r,i){return i||j(e,0,n,4),u(e,t,n,r,23,4),n+4}function G(e,t,n,r,i){return i||j(e,0,n,8),u(e,t,n,r,52,8),n+8}p.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),p.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=p.prototype;else{var i=t-e;n=new p(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},p.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||B(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},p.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||B(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},p.prototype.readUInt8=function(e,t){return t||B(e,1,this.length),this[e]},p.prototype.readUInt16LE=function(e,t){return t||B(e,2,this.length),this[e]|this[e+1]<<8},p.prototype.readUInt16BE=function(e,t){return t||B(e,2,this.length),this[e]<<8|this[e+1]},p.prototype.readUInt32LE=function(e,t){return t||B(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},p.prototype.readUInt32BE=function(e,t){return t||B(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},p.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||B(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},p.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||B(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},p.prototype.readInt8=function(e,t){return t||B(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},p.prototype.readInt16LE=function(e,t){t||B(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},p.prototype.readInt16BE=function(e,t){t||B(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},p.prototype.readInt32LE=function(e,t){return t||B(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},p.prototype.readInt32BE=function(e,t){return t||B(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},p.prototype.readFloatLE=function(e,t){return t||B(e,4,this.length),c(this,e,!0,23,4)},p.prototype.readFloatBE=function(e,t){return t||B(e,4,this.length),c(this,e,!1,23,4)},p.prototype.readDoubleLE=function(e,t){return t||B(e,8,this.length),c(this,e,!0,52,8)},p.prototype.readDoubleBE=function(e,t){return t||B(e,8,this.length),c(this,e,!1,52,8)},p.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||$(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},p.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||$(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},p.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||$(this,e,t,1,255,0),p.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},p.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||$(this,e,t,2,65535,0),p.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Y(this,e,t,!0),t+2},p.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||$(this,e,t,2,65535,0),p.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Y(this,e,t,!1),t+2},p.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||$(this,e,t,4,4294967295,0),p.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):W(this,e,t,!0),t+4},p.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||$(this,e,t,4,4294967295,0),p.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):W(this,e,t,!1),t+4},p.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);$(this,e,t,n,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},p.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);$(this,e,t,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},p.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||$(this,e,t,1,127,-128),p.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},p.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||$(this,e,t,2,32767,-32768),p.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Y(this,e,t,!0),t+2},p.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||$(this,e,t,2,32767,-32768),p.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Y(this,e,t,!1),t+2},p.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||$(this,e,t,4,2147483647,-2147483648),p.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):W(this,e,t,!0),t+4},p.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||$(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),p.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):W(this,e,t,!1),t+4},p.prototype.writeFloatLE=function(e,t,n){return H(this,e,t,!0,n)},p.prototype.writeFloatBE=function(e,t,n){return H(this,e,t,!1,n)},p.prototype.writeDoubleLE=function(e,t,n){return G(this,e,t,!0,n)},p.prototype.writeDoubleBE=function(e,t,n){return G(this,e,t,!1,n)},p.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!p.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},p.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!p.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var a=b(e)?e:Q(new p(e,r).toString()),s=a.length;for(o=0;o<n-t;++o)this[o+t]=a[o%s]}return this};var z=/[^+\/0-9A-Za-z-_]/g;function q(e){return e<16?"0"+e.toString(16):e.toString(16)}function Q(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function V(e){return function(e){var t,a,s,c,u,l;i||o();var d=e.length;if(d%4>0)throw new Error("Invalid string. Length must be a multiple of 4");u="="===e[d-2]?2:"="===e[d-1]?1:0,l=new r(3*d/4-u),s=u>0?d-4:d;var f=0;for(t=0,a=0;t<s;t+=4,a+=3)c=n[e.charCodeAt(t)]<<18|n[e.charCodeAt(t+1)]<<12|n[e.charCodeAt(t+2)]<<6|n[e.charCodeAt(t+3)],l[f++]=c>>16&255,l[f++]=c>>8&255,l[f++]=255&c;return 2===u?(c=n[e.charCodeAt(t)]<<2|n[e.charCodeAt(t+1)]>>4,l[f++]=255&c):1===u&&(c=n[e.charCodeAt(t)]<<10|n[e.charCodeAt(t+1)]<<4|n[e.charCodeAt(t+2)]>>2,l[f++]=c>>8&255,l[f++]=255&c),l}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(z,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function K(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function J(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var X="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Z={exports:{}};!function(e){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
function t(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n}function n(e,t){return e(t={exports:{}},t.exports),t.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==X||"undefined"!=typeof self&&self,n((function(e){var t=function(){function e(e,t){return null!=t&&e instanceof t}var t,n,r;try{t=Map}catch(e){t=function(){}}try{n=Set}catch(e){n=function(){}}try{r=Promise}catch(e){r=function(){}}function i(o,a,s,c,l){"object"==typeof a&&(s=a.depth,c=a.prototype,l=a.includeNonEnumerable,a=a.circular);var d=[],f=[],h=void 0!==p;function g(o,s){if(null===o)return null;if(0===s)return o;var m,y;if("object"!=typeof o)return o;if(e(o,t))m=new t;else if(e(o,n))m=new n;else if(e(o,r))m=new r((function(e,t){o.then((function(t){e(g(t,s-1))}),(function(e){t(g(e,s-1))}))}));else if(i.__isArray(o))m=[];else if(i.__isRegExp(o))m=new RegExp(o.source,u(o)),o.lastIndex&&(m.lastIndex=o.lastIndex);else if(i.__isDate(o))m=new Date(o.getTime());else{if(h&&p.isBuffer(o))return m=p.allocUnsafe?p.allocUnsafe(o.length):new p(o.length),o.copy(m),m;e(o,Error)?m=Object.create(o):void 0===c?(y=Object.getPrototypeOf(o),m=Object.create(y)):(m=Object.create(c),y=c)}if(a){var v=d.indexOf(o);if(-1!=v)return f[v];d.push(o),f.push(m)}for(var E in e(o,t)&&o.forEach((function(e,t){var n=g(t,s-1),r=g(e,s-1);m.set(n,r)})),e(o,n)&&o.forEach((function(e){var t=g(e,s-1);m.add(t)})),o){var b;y&&(b=Object.getOwnPropertyDescriptor(y,E)),b&&null==b.set||(m[E]=g(o[E],s-1))}if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(o);for(E=0;E<w.length;E++){var T=w[E];(!(S=Object.getOwnPropertyDescriptor(o,T))||S.enumerable||l)&&(m[T]=g(o[T],s-1),S.enumerable||Object.defineProperty(m,T,{enumerable:!1}))}}if(l){var A=Object.getOwnPropertyNames(o);for(E=0;E<A.length;E++){var S,C=A[E];(S=Object.getOwnPropertyDescriptor(o,C))&&S.enumerable||(m[C]=g(o[C],s-1),Object.defineProperty(m,C,{enumerable:!1}))}}return m}return void 0===a&&(a=!0),void 0===s&&(s=1/0),g(o,s)}function o(e){return Object.prototype.toString.call(e)}function a(e){return"object"==typeof e&&"[object Date]"===o(e)}function s(e){return"object"==typeof e&&"[object Array]"===o(e)}function c(e){return"object"==typeof e&&"[object RegExp]"===o(e)}function u(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return i.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},i.__objToStr=o,i.__isDate=a,i.__isArray=s,i.__isRegExp=c,i.__getRegExpFlags=u,i}();e.exports&&(e.exports=t)}));var r=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n,r="boolean"==typeof t.cycles&&t.cycles,i=t.cmp&&(n=t.cmp,function(e){return function(t,r){var i={key:t,value:e[t]},o={key:r,value:e[r]};return n(i,o)}}),o=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var n,a;if(Array.isArray(t)){for(a="[",n=0;n<t.length;n++)n&&(a+=","),a+=e(t[n])||"null";return a+"]"}if(null===t)return"null";if(-1!==o.indexOf(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=o.push(t)-1,c=Object.keys(t).sort(i&&i(t));for(a="",n=0;n<c.length;n++){var u=c[n],l=e(t[u]);l&&(a&&(a+=","),a+=JSON.stringify(u)+":"+l)}return o.splice(s,1),"{"+a+"}"}}(e)};function i(e,t,n){return e.fields=t||[],e.fname=n,e}function o(e){throw Error(e)}function a(e){var t,n,r,i=[],a=null,s=0,c=e.length,u="";function l(){i.push(u+e.substring(t,n)),u="",t=n+1}for(e+="",t=n=0;n<c;++n)if("\\"===(r=e[n]))u+=e.substring(t,n),t=++n;else if(r===a)l(),a=null,s=-1;else{if(a)continue;t===s&&'"'===r||t===s&&"'"===r?(t=n+1,a=r):"."!==r||s?"["===r?(n>t&&l(),s=t=n+1):"]"===r&&(s||o("Access path missing open bracket: "+e),s>0&&l(),s=0,t=n+1):n>t?l():t=n+1}return s&&o("Access path missing closing bracket: "+e),a&&o("Access path missing closing quote: "+e),n>t&&(n++,l()),i}var s=Array.isArray;function c(e){return e===Object(e)}function u(e){return"string"==typeof e}function l(e){return s(e)?"["+e.map(l)+"]":c(e)||u(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function d(e,t){var n=a(e),r="return _["+n.map(l).join("][")+"];";return i(Function("_",r),[e=1===n.length?n[0]:e],t||e)}var f=[];function h(e,t,n){var r=[t].concat([].slice.call(n));console[e](...r)}d("id"),i((function(e){return e}),f,"identity"),i((function(){return 0}),f,"zero"),i((function(){return 1}),f,"one"),i((function(){return!0}),f,"true"),i((function(){return!1}),f,"false");var g=0,m=1,y=2,v=3,E=4;function b(e,t){var n=e||g;return{level:function(e){return arguments.length?(n=+e,this):n},error:function(){return n>=m&&h(t||"error","ERROR",arguments),this},warn:function(){return n>=y&&h(t||"warn","WARN",arguments),this},info:function(){return n>=v&&h(t||"log","INFO",arguments),this},debug:function(){return n>=E&&h(t||"log","DEBUG",arguments),this}}}function w(e){return"boolean"==typeof e}function T(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=!0;return t}Set.prototype.toJSON=function(){return`Set(${[...this].map((e=>r(e))).join(",")})`};const A=r;function S(e,t){return e.indexOf(t)>-1}function C(e,t){let n=0;for(const[r,i]of e.entries())if(t(i,r,n++))return!0;return!1}const N=Object.keys;function O(e){return N(e)}function x(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function I(e,t="datum"){return`${t}[${l(a(e).join("."))}]`}function U(e){return`${a(e).map((e=>e.replace(".","\\."))).join("\\.")}`}function M(...e){for(const t of e)if(void 0!==t)return t}function _(e){return P(e)?e:`__${e}`}function P(e){return 0===e.indexOf("__")}const R="row",k="column",D="facet",F="x",L="y",B="x2",$="y2",Y="latitude",W="longitude",j="latitude2",H="longitude2",G="color",z="fill",q="stroke",Q="shape",V="size",K="opacity",J="fillOpacity",Z="strokeOpacity",ee="strokeWidth",te="text",ne="order",re="detail",ie="key",oe="tooltip",ae="href",se={longitude:1,longitude2:1,latitude:1,latitude2:1},ce=Object.assign({x:1,y:1,x2:1,y2:1},se,{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,size:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1});function ue(e){return"color"===e||"fill"===e||"stroke"===e}const le={row:1,column:1,facet:1},de=Object.assign({},ce,le),fe=O(de);function he(e){return!!de[e]}t(de,["order","detail"]),t(de,["order","detail","row","column","facet"]);const pe=t(ce,["x","y","x2","y2","latitude","longitude","latitude2","longitude2"]),ge=O(pe),me={x:1,y:1},ye=t(pe,["text","tooltip","href","detail","key","order"]),ve=Object.assign({},me,ye);function Ee(e){return!!ve[e]}function be(e,t){return we(e)[t]}function we(e){switch(e){case G:case z:case q:case re:case ie:case oe:case ae:case ne:case K:case J:case Z:case ee:case D:case R:case k:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",rect:"always",line:"always",trail:"always",area:"always",text:"always",geoshape:"always"};case F:case L:case Y:case W:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",rect:"always",line:"always",trail:"always",area:"always",text:"always"};case B:case $:case j:case H:return{rule:"always",bar:"always",rect:"always",area:"always",circle:"binned",point:"binned",square:"binned",tick:"binned"};case V:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case Q:return{point:"always",geoshape:"always"};case te:return{text:"always"}}}function Te(e){switch(e){case F:case L:case V:case ee:case K:case J:case Z:case B:case $:return;case D:case R:case k:case Q:case te:case oe:case ae:return"discrete";case G:case z:case q:return"flexible";case Y:case W:case j:case H:case re:case ie:case ne:return}throw new Error("rangeType not implemented for "+e)}const Ae={orient:1,bandPosition:1,domain:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,values:1,zindex:1},Se=Object.assign({},Ae,{encoding:1});Object.assign({gridScale:1,scale:1},Ae,{encode:1});const Ce=O(Se),Ne={clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1};Object.assign({},Ne,{opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,encode:1});const Oe=O(Ne),xe="Invalid spec",Ie='Autosize "fit" only works for single views and layered views.',Ue='Cannot use a fixed value of "rangeStep" when "autosize" is "fit".';function Me(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function _e(e){return`The "nearest" transform is not supported for ${e} marks.`}function Pe(e){return`Selection not supported for ${e} yet`}function Re(e){return`Cannot find a selection named "${e}"`}const ke="Scale bindings are currently only supported for scales with unbinned, continuous domains.",De="Selections bound to scales cannot be separately initialized.";function Fe(e){return`Unknown repeated value "${e}".`}function Le(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const Be="Axes cannot be shared in concatenated views yet (https://github.com/vega/vega-lite/issues/2415).",$e="Axes cannot be shared in repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function Ye(e){return`Unrecognized parse "${e}".`}function We(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function je(e){return`Ignoring an invalid transform: ${A(e)}.`}const He='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function Ge(e){return`Layer's shared ${e.join(",")} channel ${1===e.length?"is":"are"} overriden`}function ze(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${A(t)} is overridden by a child projection ${A(n)}.`}function qe(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${A(n)}}.`}function Qe(e){return`Invalid field type "${e}"`}function Ve(e,t,n){return`A ${n.scaleType?`${n.scaleType} scale`:n.zeroFalse?"scale with zero=false":"scale with custom domain that excludes zero"} is used to encode ${e}'s ${t}. This can be misleading as the ${"x"===t?"width":"height"} of the ${e} can be arbitrary based on the scale domain. You may want to use point mark instead.`}function Ke(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function Je(e){return`Invalid aggregation operator "${e}"`}function Xe(e,t){return`Missing type for channel "${e}", using "${t}" instead.`}function Ze(e,t){const{fill:n,stroke:r}=t;return`Dropping color ${e} as the plot also has `+(n&&r?"fill and stroke":n?"fill":"stroke")}function et(e,t){return`Dropping ${A(e)} from channel "${t}" since it does not contain data field or value.`}function tt(e,t,n){return`${e}-encoding with type ${t} is deprecated. Replacing with ${n}-encoding.`}const nt="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function rt(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function it(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function ot(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function at(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function st(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${"ordinal"===t?"order":"magnitude"}.`}const ct="Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.";function ut(e,t){return`Line mark is for continuous lines and thus cannot be used with ${e&&t?"x2 and y2":e?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function lt(e,t){return`Specified orient "${e}" overridden with "${t}"`}const dt="custom domain scale cannot be unioned with default field-based domain";function ft(e){return`Cannot use the scale property "${e}" with non-color channel.`}function ht(e){return`Using unaggregated domain with raw field has no effect (${A(e)}).`}function pt(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function gt(e){return`Unaggregated domain is currently unsupported for log scale (${A(e)}).`}function mt(e){return`Cannot apply size to non-oriented mark "${e}".`}function yt(e){return`rangeStep for "${e}" is dropped as top-level ${"x"===e?"width":"height"} is provided.`}function vt(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function Et(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function bt(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function wt(e,t){return`Scale type "${t}" does not work with mark "${e}".`}function Tt(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${A(n)} and ${A(r)}).  Using ${A(n)}.`}function At(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function St(e){return`Dropping sort property ${A(e)} as unioned domains only support boolean or op 'count'.`}const Ct="Unable to merge domains",Nt="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",Ot="Invalid channel for axis.";function xt(e){return`Cannot stack "${e}" if there is already "${e}2"`}function It(e){return`Cannot stack non-linear scale (${e})`}function Ut(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}")`}function Mt(e,t){return`Invalid ${e}: ${A(t)}`}function _t(e){return`Time unit "${e}" is not supported. We are replacing it with ${e.replace("day","date")}.`}function Pt(e){return`Dropping day from datetime ${A(e)} as day cannot be combined with other units.`}function Rt(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function kt(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function Dt(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function Ft(e,t){return`Center is not needed to be specified in ${t} when extent is ${e}.`}function Lt(e){return`1D error band does not support ${e}`}function Bt(e){return`Channel ${e} is required for "binned" bin`}function $t(e){return`Domain for ${e} is required for threshold scale`}const Yt=Object.freeze({INVALID_SPEC:xe,FIT_NON_SINGLE:Ie,CANNOT_FIX_RANGE_STEP_WITH_FIT:Ue,cannotProjectOnChannelWithoutField:Me,nearestNotSupportForContinuous:_e,selectionNotSupported:Pe,selectionNotFound:Re,SCALE_BINDINGS_CONTINUOUS:ke,NO_INIT_SCALE_BINDINGS:De,noSuchRepeatedValue:Fe,columnsNotSupportByRowCol:Le,CONCAT_CANNOT_SHARE_AXIS:Be,REPEAT_CANNOT_SHARE_AXIS:$e,unrecognizedParse:Ye,differentParse:We,invalidTransformIgnored:je,NO_FIELDS_NEEDS_AS:He,encodingOverridden:Ge,projectionOverridden:ze,primitiveChannelDef:qe,invalidFieldType:Qe,nonZeroScaleUsedWithLengthMark:Ve,invalidFieldTypeForCountAggregate:Ke,invalidAggregate:Je,missingFieldType:Xe,droppingColor:Ze,emptyFieldDef:et,latLongDeprecated:tt,LINE_WITH_VARYING_SIZE:nt,incompatibleChannel:rt,invalidEncodingChannel:it,facetChannelShouldBeDiscrete:ot,facetChannelDropped:at,discreteChannelCannotEncode:st,BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL:ct,lineWithRange:ut,orientOverridden:lt,CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN:dt,cannotUseScalePropertyWithNonColor:ft,unaggregateDomainHasNoEffectForRawField:ht,unaggregateDomainWithNonSharedDomainOp:pt,unaggregatedDomainWithLogScale:gt,cannotApplySizeToNonOrientedMark:mt,rangeStepDropped:yt,scaleTypeNotWorkWithChannel:vt,scaleTypeNotWorkWithFieldDef:Et,scalePropertyNotWorkWithScaleType:bt,scaleTypeNotWorkWithMark:wt,mergeConflictingProperty:Tt,independentScaleMeansIndependentGuide:At,domainSortDropped:St,UNABLE_TO_MERGE_DOMAINS:Ct,MORE_THAN_ONE_SORT:Nt,INVALID_CHANNEL_FOR_AXIS:Ot,cannotStackRangedMark:xt,cannotStackNonLinearScale:It,stackNonSummativeAggregate:Ut,invalidTimeUnit:Mt,dayReplacedWithDate:_t,droppedDay:Pt,errorBarCenterAndExtentAreNotNeeded:Rt,errorBarCenterIsUsedWithWrongExtent:kt,errorBarContinuousAxisHasCustomizedAggregate:Dt,errorBarCenterIsNotNeeded:Ft,errorBand1DNotSupport:Lt,channelRequiredForBinned:Bt,domainRequiredForThresholdScale:$t});let Wt=b(y);function jt(...e){Wt.warn.apply(Wt,arguments)}const Ht={quantitative:1,ordinal:1,temporal:1,nominal:1,geojson:1},Gt="quantitative",zt="ordinal",qt="temporal",Qt="nominal",Vt="geojson";function Kt(e){if(e)switch(e=e.toLowerCase()){case"q":case Gt:return"quantitative";case"t":case qt:return"temporal";case"o":case zt:return"ordinal";case"n":case Qt:return"nominal";case Vt:return"geojson"}}var Jt;!function(e){e.LINEAR="linear",e.LOG="log",e.POW="pow",e.SQRT="sqrt",e.SYMLOG="symlog",e.TIME="time",e.UTC="utc",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.BIN_ORDINAL="bin-ordinal",e.ORDINAL="ordinal",e.POINT="point",e.BAND="band"}(Jt||(Jt={}));const Xt=N({linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"}),Zt=["linear","log","pow","sqrt","symlog","time","utc"],en=T(Zt),tn=T(["quantile","quantize","threshold"]),nn=T(Zt.concat(["quantile","quantize","threshold"])),rn=T(["ordinal","bin-ordinal","point","band"]);function on(e){return e in rn}function an(e){return e in nn}function sn(e){return e in en}function cn(e){return e in tn}const un={type:1,domain:1,range:1,rangeStep:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},ln=O(un);function dn(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!S(["point","band","identity"],e);case"bins":return!S(["point","band","identity","ordinal"],e);case"round":return sn(e)||"band"===e||"point"===e;case"padding":return sn(e)||S(["point","band"],e);case"paddingOuter":case"rangeStep":return S(["point","band"],e);case"paddingInner":return"band"===e;case"clamp":return sn(e);case"nice":return sn(e)||"quantize"===e||"threshold"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"constant":return"symlog"===e;case"zero":return an(e)&&!S(["log","time","utc","threshold","quantile"],e)}throw new Error(`Invalid scale property ${t}.`)}function fn(e,t){switch(t){case"interpolate":case"scheme":return ue(e)?void 0:Yt.cannotUseScalePropertyWithNonColor(e);case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeStep":case"reverse":case"round":case"clamp":case"zero":return}throw new Error(`Invalid scale property "${t}".`)}function hn(e,t){return S([zt,Qt],t)?void 0===e||on(e):t===qt?S([Jt.TIME,Jt.UTC,void 0],e):t!==Gt||S([Jt.LOG,Jt.POW,Jt.SQRT,Jt.SYMLOG,Jt.QUANTILE,Jt.QUANTIZE,Jt.THRESHOLD,Jt.LINEAR,void 0],e)}function pn(e,t){switch(e){case F:case L:return sn(t)||S(["band","point"],t);case V:case ee:case K:case J:case Z:return sn(t)||cn(t)||S(["band","point"],t);case G:case z:case q:return"band"!==t;case Q:return"ordinal"===t}return!1}function gn(){const e={};for(const t of fe)for(const n of N(Ht))for(const r of Xt){const i=mn(t,n);pn(t,r)&&hn(r,n)&&(e[i]=e[i]||[],e[i].push(r))}return e}function mn(e,t){return e+"_"+t}t(un,["type","domain","range","rangeStep","scheme"]),gn();var yn=n((function(e){var t=e.exports,n="__name__";t.namedfunc=function(e,t){return t[n]=e,t},t.name=function(e){return null==e?null:e[n]},t.identity=function(e){return e},t.true=t.namedfunc("true",(function(){return!0})),t.false=t.namedfunc("false",(function(){return!1})),t.duplicate=function(e){return JSON.parse(JSON.stringify(e))},t.equal=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},t.extend=function(e){for(var t,n,r=1,i=arguments.length;r<i;++r)for(n in t=arguments[r])e[n]=t[n];return e},t.length=function(e){return null!=e&&null!=e.length?e.length:null},t.keys=function(e){var t,n=[];for(t in e)n.push(t);return n},t.vals=function(e){var t,n=[];for(t in e)n.push(e[t]);return n},t.toMap=function(e,n){return(n=t.$(n))?e.reduce((function(e,t){return e[n(t)]=1,e}),{}):e.reduce((function(e,t){return e[t]=1,e}),{})},t.keystr=function(e){var t=e.length;if(!t)return"";for(var n=String(e[0]),r=1;r<t;++r)n+="|"+String(e[r]);return n};var r=Object.prototype.toString;t.isObject=function(e){return e===Object(e)},t.isFunction=function(e){return"[object Function]"===r.call(e)},t.isString=function(e){return"string"==typeof value||"[object String]"===r.call(e)},t.isArray=Array.isArray||function(e){return"[object Array]"===r.call(e)},t.isNumber=function(e){return"number"==typeof e||"[object Number]"===r.call(e)},t.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==r.call(e)},t.isDate=function(e){return"[object Date]"===r.call(e)},t.isValid=function(e){return null!=e&&e==e},t.isBuffer=p.isBuffer||t.false,t.number=function(e){return null==e||""===e?null:+e},t.boolean=function(e){return null==e||""===e?null:"false"!==e&&!!e},t.date=function(e,t){var n=t||Date;return null==e||""===e?null:n.parse(e)},t.array=function(e){return null!=e?t.isArray(e)?e:[e]:[]},t.str=function(e){return t.isArray(e)?"["+e.map(t.str)+"]":t.isObject(e)||t.isString(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e};var i=/\[(.*?)\]|[^.\[]+/g;function o(e,t){var n,r="";for(n=0;n<e;++n)r+=t;return r}function a(e,t,n){var r=0,i=e.split(s);return(e=n?(i=i.reverse()).filter((function(e){return(r+=e.length)<=t})).reverse():i.filter((function(e){return(r+=e.length)<=t}))).length?e.join("").trim():i[0].slice(0,t)}t.field=function(e){return String(e).match(i).map((function(e){return"["!==e[0]?e:"'"!==e[1]&&'"'!==e[1]?e.slice(1,-1):e.slice(2,-2).replace(/\\(["'])/g,"$1")}))},t.accessor=function(e){return null==e||t.isFunction(e)?e:t.namedfunc(e,Function("x","return x["+t.field(e).map(t.str).join("][")+"];"))},t.$=t.accessor,t.mutator=function(e){var n;return t.isString(e)&&(n=t.field(e)).length>1?function(e,t){for(var r=0;r<n.length-1;++r)e=e[n[r]];e[n[r]]=t}:function(t,n){t[e]=n}},t.$func=function(e,n){return function(r){r=t.$(r)||t.identity;var i=e+(t.name(r)?"_"+t.name(r):"");return t.namedfunc(i,(function(e){return n(r(e))}))}},t.$valid=t.$func("valid",t.isValid),t.$length=t.$func("length",t.length),t.$in=function(e,n){e=t.$(e);var r=t.isArray(n)?t.toMap(n):n;return function(t){return!!r[e(t)]}},t.comparator=function(e){var n=[];return void 0===e&&(e=[]),e=t.array(e).map((function(e){var r=1;return"-"===e[0]?(r=-1,e=e.slice(1)):"+"===e[0]&&(r=1,e=e.slice(1)),n.push(r),t.accessor(e)})),function(r,i){var o,a,s,c;for(o=0,a=e.length;o<a;++o)if(s=e[o],c=t.cmp(s(r),s(i)))return c*n[o];return 0}},t.cmp=function(e,t){return(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t==t?-1:t!=t&&e==e?1:0)},t.numcmp=function(e,t){return e-t},t.stablesort=function(e,t,n){var r=e.reduce((function(e,t,r){return e[n(t)]=r,e}),{});return e.sort((function(e,i){var o=t(e),a=t(i);return o<a?-1:o>a?1:r[n(e)]-r[n(i)]})),e},t.permute=function(e){for(var t,n,r=e.length;r;)n=Math.floor(Math.random()*r--),t=e[r],e[r]=e[n],e[n]=t},t.pad=function(e,t,n,r){r=r||" ";var i=t-e.length;if(i<=0)return e;switch(n){case"left":return o(i,r)+e;case"middle":case"center":return o(Math.floor(i/2),r)+e+o(Math.ceil(i/2),r);default:return e+o(i,r)}},t.truncate=function(e,t,n,r,i){var o=e.length;if(o<=t)return e;i=void 0!==i?String(i):"â€¦";var s=Math.max(0,t-i.length);switch(n){case"left":return i+(r?a(e,s,1):e.slice(o-s));case"middle":case"center":var c=Math.ceil(s/2),u=Math.floor(s/2);return(r?a(e,c):e.slice(0,c))+i+(r?a(e,u,1):e.slice(o-u));default:return(r?a(e,s):e.slice(0,s))+i}};var s=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/})),vn=yn.isArray,En=yn.cmp,bn=yn.keys,wn=yn.duplicate,Tn=yn.extend,An=yn.isObject,Sn=yn.isBoolean,Cn=yn.toMap,Nn=yn.isString;function On(e,t){return-1!==e.indexOf(t)}function xn(e,t){for(let n=0;n<e.length;n++)if(!t(e[n],n))return!1;return!0}function In(e,t,n){if(e.forEach)e.forEach.call(n,t);else for(let r in e)t.call(n,e[r],r,e)}function Un(e,t){let n,r=0;for(n in e)if(t(e[n],n,r++))return!0;return!1}function Mn(e,t){return e.map((e=>vn(e)?Mn(e,t):t(e)))}function _n(e,t){return e.filter((function(e){return!On(t,e)}))}function Pn(e){return Object.keys(e)}var Rn=Object.freeze({isArray:vn,contains:On,every:xn,forEach:In,some:Un,nestedMap:Mn,without:_n,flagKeys:Pn,cmp:En,keys:bn,duplicate:wn,extend:Tn,isObject:An,isBoolean:Sn,toMap:Cn});function kn(e){return!!e.parent}const Dn={channel:1,aggregate:1,autoCount:1,bin:1,timeUnit:1,hasFn:1,sort:1,stack:1,field:1,type:1,format:1,scale:1,axis:1,legend:1,value:1},Fn=Pn(Dn);function Ln(e){return e in Dn}const Bn={bin:1,scale:1,sort:1,axis:1,legend:1};function $n(e){return Bn[e]}const Yn=["maxbins","divide","extent","base","step","steps","minstep"],Wn=["field","op","order"],jn=Yn.map((e=>({parent:"bin",child:e}))),Hn=Wn.map((e=>({parent:"sort",child:e}))),Gn=ln.map((e=>({parent:"scale",child:e}))),zn=Ce.map((e=>({parent:"axis",child:e}))),qn=Oe.map((e=>({parent:"legend",child:e}))),Qn=[].concat(jn,Hn,Gn,zn,qn),Vn=["width","height","background","padding","title"],Kn=".";function Jn(e){return kn(e)?e.parent+Kn+e.child:e}function Xn(e){const t=e.split(Kn);if(1===t.length)return e;if(2===t.length)return{parent:t[0],child:t[1]};throw"Invalid property key with "+t.length+" dots: "+e}const Zn=Qn.reduce(((e,t)=>(e[t.parent]=e[t.parent]||[],e[t.parent][t.child]=t,e)),{});function er(e,t){return(Zn[e]||{})[t]}function tr(e){return Ln(e)||kn(e)}const nr=[].concat(Fn,Qn),rr=["type","field","bin","timeUnit","aggregate","autoCount","channel","mark","stack","scale","sort","axis","legend"].concat(jn,Gn,zn,qn,Hn);var ir;!function(e){e.MARK="mark",e.TRANSFORM="transform",e.STACK="stack",e.FORMAT="format",e.CHANNEL="channel",e.AGGREGATE="aggregate",e.AUTOCOUNT="autoCount",e.BIN="bin",e.HAS_FN="hasFn",e.TIMEUNIT="timeUnit",e.FIELD="field",e.TYPE="type",e.SORT="sort",e.SCALE="scale",e.AXIS="axis",e.LEGEND="legend",e.WIDTH="width",e.HEIGHT="height",e.BACKGROUND="background",e.PADDING="padding",e.TITLE="title"}(ir||(ir={}));var or=Object.freeze({isEncodingNestedProp:kn,ENCODING_TOPLEVEL_PROPS:Fn,isEncodingTopLevelProperty:Ln,isEncodingNestedParent:$n,BIN_CHILD_PROPS:Yn,SORT_CHILD_PROPS:Wn,SORT_PROPS:Hn,SCALE_PROPS:Gn,ENCODING_NESTED_PROPS:Qn,VIEW_PROPS:Vn,toKey:Jn,fromKey:Xn,getEncodingNestedProp:er,isEncodingProperty:tr,ALL_ENCODING_PROPS:nr,DEFAULT_PROP_PRECEDENCE:rr,get Property(){return ir}});const ar="area",sr="bar",cr="line",ur="point",lr="rect",dr="rule",fr="text",hr="tick",pr="circle",gr="square";function mr(e){return S(["line","area","trail"],e)}function yr(e){return e.type}var vr;T(O({area:1,bar:1,line:1,point:1,text:1,tick:1,trail:1,rect:1,geoshape:1,rule:1,circle:1,square:1})),["january","february","march","april","may","june","july","august","september","october","november","december"].map((e=>e.substr(0,3))),["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].map((e=>e.substr(0,3))),function(e){e.YEAR="year",e.MONTH="month",e.DAY="day",e.DATE="date",e.HOURS="hours",e.MINUTES="minutes",e.SECONDS="seconds",e.MILLISECONDS="milliseconds",e.YEARMONTH="yearmonth",e.YEARMONTHDATE="yearmonthdate",e.YEARMONTHDATEHOURS="yearmonthdatehours",e.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",e.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",e.MONTHDATE="monthdate",e.MONTHDATEHOURS="monthdatehours",e.HOURSMINUTES="hoursminutes",e.HOURSMINUTESSECONDS="hoursminutesseconds",e.MINUTESSECONDS="minutesseconds",e.SECONDSMILLISECONDS="secondsmilliseconds",e.QUARTER="quarter",e.YEARQUARTER="yearquarter",e.QUARTERMONTH="quartermonth",e.YEARQUARTERMONTH="yearquartermonth",e.UTCYEAR="utcyear",e.UTCMONTH="utcmonth",e.UTCDAY="utcday",e.UTCDATE="utcdate",e.UTCHOURS="utchours",e.UTCMINUTES="utcminutes",e.UTCSECONDS="utcseconds",e.UTCMILLISECONDS="utcmilliseconds",e.UTCYEARMONTH="utcyearmonth",e.UTCYEARMONTHDATE="utcyearmonthdate",e.UTCYEARMONTHDATEHOURS="utcyearmonthdatehours",e.UTCYEARMONTHDATEHOURSMINUTES="utcyearmonthdatehoursminutes",e.UTCYEARMONTHDATEHOURSMINUTESSECONDS="utcyearmonthdatehoursminutesseconds",e.UTCMONTHDATE="utcmonthdate",e.UTCMONTHDATEHOURS="utcmonthdatehours",e.UTCHOURSMINUTES="utchoursminutes",e.UTCHOURSMINUTESSECONDS="utchoursminutesseconds",e.UTCMINUTESSECONDS="utcminutesseconds",e.UTCSECONDSMILLISECONDS="utcsecondsmilliseconds",e.UTCQUARTER="utcquarter",e.UTCYEARQUARTER="utcyearquarter",e.UTCQUARTERMONTH="utcquartermonth",e.UTCYEARQUARTERMONTH="utcyearquartermonth"}(vr||(vr={}));const Er={year:1,quarter:1,month:1,day:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},br=O(Er);function wr(e){return!!Er[e]}const Tr={utcyear:1,utcquarter:1,utcmonth:1,utcday:1,utcdate:1,utchours:1,utcminutes:1,utcseconds:1,utcmilliseconds:1};function Ar(e){return!!Tr[e]}const Sr={yearquarter:1,yearquartermonth:1,yearmonth:1,yearmonthdate:1,yearmonthdatehours:1,yearmonthdatehoursminutes:1,yearmonthdatehoursminutesseconds:1,quartermonth:1,monthdate:1,monthdatehours:1,hoursminutes:1,hoursminutesseconds:1,minutesseconds:1,secondsmilliseconds:1},Cr={utcyearquarter:1,utcyearquartermonth:1,utcyearmonth:1,utcyearmonthdate:1,utcyearmonthdatehours:1,utcyearmonthdatehoursminutes:1,utcyearmonthdatehoursminutesseconds:1,utcquartermonth:1,utcmonthdate:1,utcmonthdatehours:1,utchoursminutes:1,utchoursminutesseconds:1,utcminutesseconds:1,utcsecondsmilliseconds:1},Nr=Object.assign({},Tr,Cr);function Or(e){return!!Nr[e]}const xr=Object.assign({},Er,Tr,Sr,Cr);function Ir(e){return!!xr[e]}const Ur={year:"setFullYear",month:"setMonth",date:"setDate",hours:"setHours",minutes:"setMinutes",seconds:"setSeconds",milliseconds:"setMilliseconds",quarter:null,day:null};function Mr(e,t){const n=Or(e),r=n?new Date(Date.UTC(1972,0,1,0,0,0,0)):new Date(1972,0,1,0,0,0,0);for(const i of br)if(Pr(e,i))switch(i){case vr.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case vr.QUARTER:{const{getDateMethod:e,setDateMethod:i}=_r("month",n);r[i](3*Math.floor(t[e]()/3));break}default:{const{getDateMethod:e,setDateMethod:o}=_r(i,n);r[o](t[e]())}}return r}function _r(e,t){const n=Ur[e];return{setDateMethod:t?"setUTC"+n.substr(3):n,getDateMethod:"get"+(t?"UTC":"")+n.substr(3)}}function Pr(e,t){const n=e.indexOf(t);return n>-1&&(t!==vr.SECONDS||0===n||"i"!==e.charAt(n-1))}const Rr="?";function kr(e){return Dr(e)||Fr(e)}function Dr(e){return e===Rr}function Fr(e){return!(void 0===e||null==e||!e.enum&&!e.name||vn(e))}function Lr(e,t,n){return Tn({},{name:t,enum:n},e===Rr?{}:e)}function Br(e){let t={},n={};for(const r of e){const e=[0];for(let t=0;t<r.length;t++)r.charAt(t).toUpperCase()===r.charAt(t)&&e.push(t);let i=e.map((e=>r.charAt(e))).join("").toLowerCase();if(n[i])if(e[e.length-1]===r.length-1||(i=e.concat([r.length-1]).map((e=>r.charAt(e))).join("").toLowerCase(),n[i]))for(let e=1;!t[r];e++){let o=i+"_"+e;if(!n[o]){t[r]=o,n[o]=!0;break}}else t[r]=i,n[i]=!0;else t[r]=i,n[i]=!0}return t}const $r={mark:"m",channel:"c",aggregate:"a",autoCount:"#",hasFn:"h",bin:"b",sort:"so",stack:"st",scale:"s",format:"f",axis:"ax",legend:"l",value:"v",timeUnit:"tu",field:"f",type:"t",binProps:{maxbins:"mb",min:"mi",max:"ma",base:"b",step:"s",steps:"ss",minstep:"ms",divide:"d"},sortProps:{field:"f",op:"o",order:"or"},scaleProps:Br(ln),axisProps:Br(Ce),legendProps:Br(Oe)};function Yr(e){if(kn(e))return $r[e.parent]+"-"+$r[e.parent+"Props"][e.child];if($r[e])return $r[e];throw new Error("Default name undefined for "+e)}const Wr=[!1,!0],jr={maxbins:[5,10,20],extent:[void 0],base:[10],step:[void 0],steps:[void 0],minstep:[void 0],divide:[[5,2]],binned:[!1],anchor:[void 0],nice:[!0]},Hr={field:[void 0],op:["min","mean"],order:["ascending","descending"]},Gr={type:[void 0,Jt.LOG],domain:[void 0],base:[void 0],exponent:[1,2],constant:[void 0],bins:[void 0],clamp:Wr,nice:Wr,reverse:Wr,round:Wr,zero:Wr,padding:[void 0],paddingInner:[void 0],paddingOuter:[void 0],interpolate:[void 0],range:[void 0],rangeStep:[17,21],scheme:[void 0]},zr={zindex:[1,0],offset:[void 0],orient:[void 0],values:[void 0],bandPosition:[void 0],encoding:[void 0],domain:Wr,domainColor:[void 0],domainDash:[void 0],domainDashOffset:[void 0],domainOpacity:[void 0],domainWidth:[void 0],formatType:[void 0],grid:Wr,gridColor:[void 0],gridDash:[void 0],gridDashOffset:[void 0],gridOpacity:[void 0],gridWidth:[void 0],format:[void 0],labels:Wr,labelAlign:[void 0],labelAngle:[void 0],labelBaseline:[void 0],labelColor:[void 0],labelFlushOffset:[void 0],labelFont:[void 0],labelFontSize:[void 0],labelFontStyle:[void 0],labelFontWeight:[void 0],labelLimit:[void 0],labelOpacity:[void 0],labelSeparation:[void 0],labelOverlap:[void 0],labelPadding:[void 0],labelBound:[void 0],labelFlush:[void 0],maxExtent:[void 0],minExtent:[void 0],position:[void 0],ticks:Wr,tickColor:[void 0],tickCount:[void 0],tickDash:[void 0],tickExtra:[void 0],tickDashOffset:[void 0],tickMinStep:[void 0],tickOffset:[void 0],tickOpacity:[void 0],tickRound:[void 0],tickSize:[void 0],tickWidth:[void 0],title:[void 0],titleAlign:[void 0],titleAnchor:[void 0],titleAngle:[void 0],titleBaseline:[void 0],titleColor:[void 0],titleFont:[void 0],titleFontSize:[void 0],titleFontStyle:[void 0],titleFontWeight:[void 0],titleLimit:[void 0],titleOpacity:[void 0],titlePadding:[void 0],titleX:[void 0],titleY:[void 0]},qr={orient:["left","right"],format:[void 0],type:[void 0],values:[void 0],zindex:[void 0],clipHeight:[void 0],columnPadding:[void 0],columns:[void 0],cornerRadius:[void 0],direction:[void 0],encoding:[void 0],fillColor:[void 0],formatType:[void 0],gridAlign:[void 0],offset:[void 0],padding:[void 0],rowPadding:[void 0],strokeColor:[void 0],labelAlign:[void 0],labelBaseline:[void 0],labelColor:[void 0],labelFont:[void 0],labelFontSize:[void 0],labelFontStyle:[void 0],labelFontWeight:[void 0],labelLimit:[void 0],labelOffset:[void 0],labelOpacity:[void 0],labelOverlap:[void 0],labelPadding:[void 0],labelSeparation:[void 0],legendX:[void 0],legendY:[void 0],gradientLength:[void 0],gradientOpacity:[void 0],gradientStrokeColor:[void 0],gradientStrokeWidth:[void 0],gradientThickness:[void 0],symbolDash:[void 0],symbolDashOffset:[void 0],symbolFillColor:[void 0],symbolOffset:[void 0],symbolOpacity:[void 0],symbolSize:[void 0],symbolStrokeColor:[void 0],symbolStrokeWidth:[void 0],symbolType:[void 0],tickCount:[void 0],tickMinStep:[void 0],title:[void 0],titleAnchor:[void 0],titleAlign:[void 0],titleBaseline:[void 0],titleColor:[void 0],titleFont:[void 0],titleFontSize:[void 0],titleFontStyle:[void 0],titleFontWeight:[void 0],titleLimit:[void 0],titleOpacity:[void 0],titleOrient:[void 0],titlePadding:[void 0]},Qr={mark:[ur,sr,cr,ar,lr,hr,fr],channel:[F,L,R,k,V,G],aggregate:[void 0,"mean"],autoCount:Wr,bin:Wr,hasFn:Wr,timeUnit:[void 0,vr.YEAR,vr.MONTH,vr.MINUTES,vr.SECONDS],field:[void 0],type:[Qt,zt,Gt,qt],sort:["ascending","descending"],stack:["zero","normalize","center",null],value:[void 0],format:[void 0],title:[void 0],scale:[!0],axis:Wr,legend:Wr,binProps:jr,sortProps:Hr,scaleProps:Gr,axisProps:zr,legendProps:qr};function Vr(e,t,n){if("field"===e||kn(e)&&"sort"===e.parent&&"field"===e.child)return t.fieldNames();let r;if(r=kn(e)?n.enum[e.parent+"Props"][e.child]:n.enum[e],void 0!==r)return r;throw new Error("No default enumValues for "+JSON.stringify(e))}var Kr=Object.freeze({SHORT_WILDCARD:Rr,isWildcard:kr,isShortWildcard:Dr,isWildcardDef:Fr,initWildcard:Lr,DEFAULT_NAME:$r,getDefaultName:Yr,DEFAULT_ENUM_INDEX:Qr,getDefaultEnumValues:Vr});const Jr={verbose:!1,defaultSpecConfig:{line:{point:!0},scale:{useUnaggregatedDomain:!0}},propertyPrecedence:rr.map(Jn),enum:Qr,numberNominalProportion:.05,numberNominalLimit:40,constraintManuallySpecifiedValue:!1,autoAddCount:!1,hasAppropriateGraphicTypeForMark:!0,omitAggregate:!1,omitAggregatePlotWithDimensionOnlyOnFacet:!0,omitAggregatePlotWithoutDimension:!1,omitBarLineAreaWithOcclusion:!0,omitBarTickWithSize:!0,omitMultipleNonPositionalChannels:!0,omitRaw:!1,omitRawContinuousFieldForAggregatePlot:!0,omitRepeatedField:!0,omitNonPositionalOrFacetOverPositionalChannels:!0,omitTableWithOcclusionIfAutoAddCount:!0,omitVerticalDotPlot:!1,omitInvalidStackSpec:!0,omitNonSumStack:!0,preferredBinAxis:F,preferredTemporalAxis:F,preferredOrdinalAxis:L,preferredNominalAxis:L,preferredFacet:R,minCardinalityForBin:15,maxCardinalityForCategoricalColor:20,maxCardinalityForFacet:20,maxCardinalityForShape:6,timeUnitShouldHaveVariation:!0,typeMatchesSchemaType:!0,stylize:!0,smallRangeStepForHighCardinalityOrFacet:{maxCardinality:10,rangeStep:12},nominalColorScaleForHighCardinality:{maxCardinality:10,palette:"category20"},xAxisOnTopForHighYCardinalityWithoutColumn:{maxCardinality:30},maxGoodCardinalityForFacet:5,maxGoodCardinalityForColor:7,minPercentUniqueForKey:.8,minCardinalityForKey:50};function Xr(e){return Object.assign({},Jr,e,{enum:Zr(e.enum)})}function Zr(e){return Object.assign({},Qr,e,{binProps:ei(e,"bin"),scaleProps:ei(e,"scale"),axisProps:ei(e,"axis"),legendProps:ei(e,"legend")})}function ei(e,t){return Object.assign({},Qr[t+"Props"],e[t+"Props"])}var ti=Object.freeze({DEFAULT_QUERY_CONFIG:Jr,extendConfig:Xr});const ni={argmax:1,argmin:1,average:1,count:1,distinct:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1};function ri(e){return!!e&&!!e.argmin}function ii(e){return!!e&&!!e.argmax}function oi(e){return u(e)&&!!ni[e]}const ai=["count","sum","distinct","valid","missing"];function si(e){return w(e)&&(e=bi(e,void 0)),"bin"+N(e).map((t=>x(`_${t}_${e[t]}`))).join("")}function ci(e){return!0===e||ui(e)&&!e.binned}function ui(e){return c(e)}function li(e){switch(e){case R:case k:case V:case G:case z:case q:case ee:case K:case J:case Z:case Q:return 6;default:return 10}}function di(e){return!!e&&!!e.condition&&!s(e.condition)&&fi(e.condition)}function fi(e){return!(!e||!e.field&&"count"!==e.aggregate)}function hi(e){return fi(e)&&u(e.field)}function pi(e){return!!e.op}function gi(e,t={}){let n=e.field;const r=t.prefix;let i=t.suffix,o="";if(vi(e))n=_("count");else{let r;if(!t.nofn)if(pi(e))r=e.op;else{const{bin:a,aggregate:s,timeUnit:c}=e;ci(a)?(r=si(a),i=(t.binSuffix||"")+(t.suffix||"")):s?ii(s)?(o=`.${n}`,n=`argmax_${s.argmax}`):ri(s)?(o=`.${n}`,n=`argmin_${s.argmin}`):r=String(s):c&&(r=String(c))}r&&(n=n?`${r}_${n}`:r)}return i&&(n=`${n}_${i}`),r&&(n=`${r}_${n}`),t.forAs?n:t.expr?I(n,t.expr)+o:U(n)+o}function mi(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return!!e.bin;case"temporal":return!1}throw new Error(Yt.invalidFieldType(e.type))}function yi(e){return!mi(e)}function vi(e){return"count"===e.aggregate}function Ei(e){return fi(e)?e:di(e)?e.condition:void 0}function bi(e,t){return w(e)?{maxbins:li(t)}:"binned"===e?{binned:!0}:e.maxbins||e.step?e:Object.assign({},e,{maxbins:li(t)})}T(["mean","average","median","q1","q3","min","max"]);const wi={compatible:!0};function Ti(e,t){const n=e.type;if("geojson"===n&&"shape"!==t)return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case"row":case"column":case"facet":return yi(e)?{compatible:!1,warning:Yt.facetChannelShouldBeDiscrete(t)}:wi;case"x":case"y":case"color":case"fill":case"stroke":case"text":case"detail":case"key":case"tooltip":case"href":return wi;case"longitude":case"longitude2":case"latitude":case"latitude2":return n!==Gt?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:wi;case"opacity":case"fillOpacity":case"strokeOpacity":case"strokeWidth":case"size":case"x2":case"y2":return"nominal"!==n||e.sort?wi:{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`};case"shape":return S(["ordinal","nominal","geojson"],e.type)?wi:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case"order":return"nominal"!==e.type||"sort"in e?wi:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}throw new Error("channelCompatability not implemented for channel "+t)}function Ai(e,t,n,r){const i=Si(t,n,r),{type:o}=e;return Ee(t)?void 0!==o?pn(t,o)?hn(o,n.type)?o:(jt(Yt.scaleTypeNotWorkWithFieldDef(o,i)),i):(jt(Yt.scaleTypeNotWorkWithChannel(t,o,i)),i):i:null}function Si(e,t,n){switch(t.type){case"nominal":case"ordinal":if(ue(e)||"discrete"===Te(e))return"shape"===e&&"ordinal"===t.type&&jt(Yt.discreteChannelCannotEncode(e,"ordinal")),"ordinal";if(S(["x","y"],e)){if(S(["rect","bar","rule"],n))return"band";if("bar"===n)return"band"}return"point";case"temporal":return ue(e)?"time":"discrete"===Te(e)?(jt(Yt.discreteChannelCannotEncode(e,"temporal")),"ordinal"):"time";case"quantitative":return ue(e)?ci(t.bin)?"bin-ordinal":"linear":"discrete"===Te(e)?(jt(Yt.discreteChannelCannotEncode(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(Yt.invalidFieldType(t.type))}var Ci;function Ni(e){return e===zt||e===Qt||e===Ci.KEY}!function(e){e.QUANTITATIVE=Gt,e.ORDINAL=zt,e.TEMPORAL=qt,e.NOMINAL=Qt,e.KEY="key"}(Ci||(Ci={}));class Oi{constructor(e=null){this.index=e?Object.assign({},e):{}}has(e){return Jn(e)in this.index}get(e){return this.index[Jn(e)]}set(e,t){return this.index[Jn(e)]=t,this}setByKey(e,t){this.index[e]=t}map(e){const t=new Oi;for(const n in this.index)t.index[n]=e(this.index[n]);return t}size(){return bn(this.index).length}duplicate(){return new Oi(this.index)}}function xi(e,t){const n=e&&e[t];return!!n&&(s(n)?C(n,(e=>!!e.field)):fi(n)||di(n))}const Ii={zero:1,center:1,normalize:1};function Ui(e){return!!Ii[e]}const Mi=[sr,ar,dr,ur,pr,gr,cr,fr,hr],_i=[sr,ar];function Pi(e){const t=e.x,n=e.y;if(fi(t)&&fi(n))if("quantitative"===t.type&&"quantitative"===n.type){if(t.stack)return"x";if(n.stack)return"y";if(!!t.aggregate!=!!n.aggregate)return t.aggregate?"x":"y"}else{if("quantitative"===t.type)return"x";if("quantitative"===n.type)return"y"}else{if(fi(t)&&"quantitative"===t.type)return"x";if(fi(n)&&"quantitative"===n.type)return"y"}}function Ri(e,t,n,r={}){const i=yr(e)?e.type:e;if(!S(Mi,i))return null;const o=Pi(t);if(!o)return null;const a=t[o],c=hi(a)?gi(a,{}):void 0,u="x"===o?"y":"x",l=t[u],d=hi(l)?gi(l,{}):void 0,f=ge.reduce(((e,n)=>{if("tooltip"!==n&&xi(t,n)){const r=t[n];(s(r)?r:[r]).forEach((t=>{const r=Ei(t);if(r.aggregate)return;const i=hi(r)?gi(r,{}):void 0;(!i||i!==d&&i!==c)&&e.push({channel:n,fieldDef:r})}))}return e}),[]);if(0===f.length)return null;let h;if(h=void 0!==a.stack?w(a.stack)?a.stack?"zero":null:a.stack:S(_i,i)?M(n,"zero"):n,!h||!Ui(h))return null;if(a.scale&&a.scale.type&&a.scale.type!==Jt.LINEAR){if(r.disallowNonLinearStack)return null;jt(Yt.cannotStackNonLinearScale(a.scale.type))}return xi(t,o===F?B:$)?(void 0!==a.stack&&jt(Yt.cannotStackRangedMark(o)),null):(a.aggregate&&!S(ai,a.aggregate)&&jt(Yt.stackNonSummativeAggregate(a.aggregate)),{groupbyChannel:l?u:void 0,fieldChannel:o,impute:mr(i),stackBy:f,offset:h})}function ki(e){return Tn(e.data?{data:e.data}:{},e.transform?{transform:e.transform}:{},e.width?{width:e.width}:{},e.height?{height:e.height}:{},e.background?{background:e.background}:{},e.padding?{padding:e.padding}:{},e.title?{title:e.title}:{},{mark:e.mark,encodings:bn(e.encoding).map((t=>{let n={channel:t},r=e.encoding[t];for(const e in r)Ln(e)&&void 0!==r[e]&&(On(["bin","scale","axis","legend"],e)&&null===r[e]?n[e]=!1:n[e]=r[e]);return co(n)&&"count"===n.aggregate&&!n.field&&(n.field="*"),n}))},e.config?{config:e.config}:{})}function Di(e){return Un(e.encodings,(e=>co(e)&&!kr(e.aggregate)&&!!e.aggregate||fo(e)))}function Fi(e){if(!$i(e))return null;const t=po(e.encodings,{schema:null,wildcardMode:"null"});return Ri(e.mark,t,void 0,{disallowNonLinearStack:!0})}function Li(e){for(const t of e.encodings)if(void 0!==t[ir.STACK]&&!kr(t[ir.STACK]))return t[ir.STACK]}function Bi(e){for(const t of e.encodings)if(void 0!==t[ir.STACK]&&!kr(t.channel))return t.channel;return null}function $i(e){if(kr(e.mark))return!1;const t=[ir.STACK,ir.CHANNEL,ir.MARK,ir.FIELD,ir.AGGREGATE,ir.AUTOCOUNT,ir.SCALE,er("scale","type"),ir.TYPE],n=Cn(_n(nr,t)),r=e.encodings.filter((e=>!lo(e)));for(const e of r)if(Yi(e,{exclude:n}))return!1;return!0}function Yi(e,t={}){if(!An(e))return!1;for(const n in e)if(e.hasOwnProperty(n)&&(kr(e[n])&&(!t.exclude||!t.exclude[n])||Yi(e[n],t)))return!0;return!1}function Wi(e,t={}){const n=t.exclude?Cn(t.exclude.map(Jn)):{};if(kr(e.mark)&&!n.mark)return!0;for(const t of e.encodings)if(Yi(t,n))return!0;return!1}var ji=Object.freeze({fromSpec:ki,isAggregate:Di,getVlStack:Fi,getStackOffset:Li,getStackChannel:Bi,hasRequiredStackProperties:$i,hasWildcard:Wi});function Hi(e){return e.map((e=>Gi(e)))}function Gi(e){return t=>void 0!==e[t]?e[t]:t}function zi(e,t){return kr(e)?!Dr(e)&&e.enum?Rr+JSON.stringify(e.enum):Rr:t?t(e):e}function qi(e,t){return t?t(e):e}const Qi=new Oi,Vi=[].concat(rr,Hn,[ir.TRANSFORM,ir.STACK],Vn).reduce(((e,t)=>e.set(t,!0)),new Oi);function Ki(e,t=Vi,n=Qi){return Xi(ki(e),t,n)}const Ji={axis:{x:!0,y:!0,row:!0,column:!0},legend:{color:!0,opacity:!0,size:!0,shape:!0},scale:{x:!0,y:!0,color:!0,opacity:!0,row:!0,column:!0,size:!0,shape:!0},sort:{x:!0,y:!0,path:!0,order:!0},stack:{x:!0,y:!0}};function Xi(e,t=Vi,n=Qi){const r=[];let i;if(t.get(ir.MARK)&&r.push(zi(e.mark,n.get(ir.MARK))),e.transform&&e.transform.length>0&&r.push("transform:"+JSON.stringify(e.transform)),t.get(ir.STACK)&&(i=Fi(e)),e.encodings){const o=e.encodings.reduce(((e,r)=>{if(!lo(r)){let o;o=i&&r.channel===i.fieldChannel?Zi(Object.assign({},r,{stack:i.offset}),t,n):Zi(r,t,n),o&&e.push(o)}return e}),[]).sort().join("|");o&&r.push(o)}for(let n of Vn){const i=n.toString();if(t.get(n)&&e[i]){const t=e[i];r.push(`${i}=${JSON.stringify(t)}`)}}return r.join("|")}function Zi(e,t=Vi,n=Qi){const r=[];if(t.get(ir.CHANNEL)&&r.push(zi(e.channel,n.get(ir.CHANNEL))),co(e)){const i=eo(e,t,n);i&&r.push(i)}else so(e)?r.push(e.value):uo(e)&&r.push("autocount()");return r.join(":")}function eo(e,t=Vi,n=Qi){if(t.get(ir.AGGREGATE)&&lo(e))return"-";const r=to(e,t,n),i=no(e,t,n);let o;return co(e)?(o=t.get("field")?zi(e.field,n.get("field")):"...",t.get(ir.TYPE)&&(kr(e.type)?o+=","+zi(e.type,n.get(ir.TYPE)):o+=","+zi(((e.type||Gt)+"").substr(0,1),n.get(ir.TYPE))),o+=i.map((e=>{let t=e.value instanceof Array?"["+e.value+"]":e.value;return","+e.key+"="+t})).join("")):uo(e)&&(o="*,q"),o?r?(Nn(r)?r:Rr+(bn(r).length>0?JSON.stringify(r):""))+"("+o+")":o:null}function to(e,t,n){if(t.get(ir.AGGREGATE)&&e.aggregate&&!kr(e.aggregate))return qi(e.aggregate,n.get(ir.AGGREGATE));if(t.get(ir.AGGREGATE)&&fo(e))return qi("count",n.get(ir.AGGREGATE));if(t.get(ir.TIMEUNIT)&&e.timeUnit&&!kr(e.timeUnit))return qi(e.timeUnit,n.get(ir.TIMEUNIT));if(t.get(ir.BIN)&&e.bin&&!kr(e.bin))return"bin";{let n=null;for(const r of[ir.AGGREGATE,ir.AUTOCOUNT,ir.TIMEUNIT,ir.BIN]){const i=e[r];t.get(r)&&e[r]&&kr(i)&&(n=n||{},n[r]=Dr(i)?i:i.enum)}return n&&e.hasFn&&(n.hasFn=!0),n}}function no(e,t,n){const r=[];if(!Sn(e.bin)&&!Dr(e.bin)){const i=e.bin;for(const e in i){const o=er("bin",e);o&&t.get(o)&&void 0!==i[e]&&r.push({key:e,value:zi(i[e],n.get(o))})}r.sort(((e,t)=>e.key.localeCompare(t.key)))}for(const i of[ir.SCALE,ir.SORT,ir.STACK,ir.AXIS,ir.LEGEND])if((kr(e.channel)||Ji[i][e.channel])&&t.get(i)&&void 0!==e[i]){const o=e[i];if(Sn(o)||null===o)r.push({key:i+"",value:o||!1});else if(Nn(o))r.push({key:i+"",value:qi(JSON.stringify(o),n.get(i))});else{let e=[];for(const r in o){const a=er(i,r);a&&t.get(a)&&void 0!==o[r]&&e.push({key:r,value:zi(o[r],n.get(a))})}if(e.length>0){const t=e.sort(((e,t)=>e.key.localeCompare(t.key))).reduce(((e,t)=>(e[t.key]=t.value,e)),{});r.push({key:i+"",value:JSON.stringify(t)})}}}return r}function ro(e){let t=e.split("|"),n={mark:t[0],encodings:[]};for(let e=1;e<t.length;e++){const r=io(t[e],":",1),i=r[0],o=r[1];if(he(i)||"?"===i){const e=oo.encoding(i,o);n.encodings.push(e)}else"transform"!==i||(n.transform=JSON.parse(o))}return n}function io(e,t,n){let r=[],i=0;for(let o=0;o<n;o++){let n=e.indexOf(t,i);if(-1===n)break;r.push(e.substring(i,n)),i=n+1}if(r.push(e.substr(i)),r.length!==n+1)for(;r.length!==n+1;)r.push("");return r}var oo;!function(e){function t(e,t){let r=-1!==t.indexOf("(")?i(t):n(io(t,",",2));return Object.assign({channel:e},r)}function n(e){const t={};t.field=e[0],t.type=Kt(e[1].toUpperCase())||"?";let n=e[2],i=0,o=0;for(;o<n.length;){let e,a=n.indexOf("=",o);if(-1===a)break;{let s=n.substring(o,a);if("{"===n[o+s.length+1]){let t=o+s.length+1;i=r(t,n,"}");const a=n.substring(t,i+1);e=JSON.parse(a),o=i+2}else if("["===n[o+s.length+1]){let t=o+s.length+1,i=r(t,n,"]");const a=n.substring(t,i+1);e=JSON.parse(a),o=i+2}else{let t=o,r=n.indexOf(",",o+s.length);-1===r&&(r=n.length),o=r+1,e=JSON.parse(n.substring(t+s.length+1,r))}$n(s)?t[s]=e:(t.bin=t.bin||{},t.bin[s]=e)}}return t}function r(e,t,n){for(let r=e;r<t.length;r++)if(t[r]===n)return r}function i(e){const t={};if("?"===e[0]){let i=r(1,e,"}"),o=JSON.parse(e.substring(1,i+1));for(let e in o)vn(o[e])?t[e]={enum:o[e]}:t[e]=o[e];return Object.assign({},t,n(io(e.substring(i+2,e.length-1),",",2)))}{let t=e.substring(0,e.indexOf("(")),r=io(e.substring(t.length+1,e.length-1),",",2);if(oi(t))return Object.assign({aggregate:t},n(r));if(Ir(t))return Object.assign({timeUnit:t},n(r));if("bin"===t)return Object.assign({bin:{}},n(r))}}e.encoding=t,e.rawFieldDef=n,e.getClosingIndex=r,e.fn=i}(oo||(oo={}));var ao=Object.freeze({getReplacerIndex:Hi,getReplacer:Gi,value:zi,replace:qi,REPLACE_NONE:Qi,INCLUDE_ALL:Vi,vlSpec:Ki,PROPERTY_SUPPORTED_CHANNELS:Ji,spec:Xi,encoding:Zi,fieldDef:eo,parse:ro,splitWithTail:io,get shorthandParser(){return oo}});function so(e){return null!=e&&void 0!==e.value}function co(e){return null!=e&&(e.field||"count"===e.aggregate)}function uo(e){return null!=e&&"autoCount"in e}function lo(e){return uo(e)&&!1===e.autoCount}function fo(e){return uo(e)&&!0===e.autoCount}const ho=[ir.AGGREGATE,ir.BIN,ir.TIMEUNIT,ir.FIELD,ir.TYPE,ir.SCALE,ir.SORT,ir.AXIS,ir.LEGEND,ir.STACK,ir.FORMAT];function po(e,t){let n={};for(const r of e){if(lo(r))continue;const{channel:e}=r;if(kr(e))throw new Error("Cannot convert wildcard channel to a fixed channel");const i=so(r)?go(r):mo(r,t);if(null!==i)n[e]=i;else if("null"===t.wildcardMode)return null}return n}function go(e){const{value:t}=e;return kr(t)?null:{value:t}}function mo(e,t={}){const{props:n=ho,schema:r,wildcardMode:i="skip"}=t;if(co(e)){const t={};for(const o of n){let n=e[o];if(kr(n)){if("skip"===i)continue;return null}if(void 0!==n){if(Ji[o]&&!Ji[o][e.channel])continue;if($n(o)&&An(n)){n=Object.assign({},n);for(const e in n)if(kr(n[e])){if("null"===i)return null;delete n[e]}}if("bin"===o&&!1===n)continue;"type"===o&&"key"===n?t.type="nominal":t[o]=n}if(o===ir.SCALE&&r&&e.type===zt){const n=e.scale,{ordinalDomain:i}=r.fieldSchema(e.field);null!==n&&i&&(t[ir.SCALE]=Object.assign({domain:i},An(n)?n:{}))}}return t}if(!1===e.autoCount)throw new Error("Cannot convert {autoCount: false} into a field def");return{aggregate:"count",field:"*",type:"quantitative"}}function yo(e){return co(e)?yi(mo(e,{props:["bin","timeUnit","field","type"]})):uo(e)}function vo(e){return co(e)?!Eo(e)&&"temporal"!==e.type:uo(e)}function Eo(e){if(co(e)){const t=mo(e,{props:["bin","timeUnit","type"]});return mi(t)||!!t.timeUnit}return!1}function bo(e){const t=!0===e.scale||e.scale===Rr?{}:e.scale||{},{type:n,channel:r,timeUnit:i,bin:o}=e,a=void 0;if(kr(t.type)||kr(n)||kr(r)||kr(o))return;if(t.type)return t.type;if("temporal"===n&&kr(i))return;if("quantitative"===n&&kr(o))return;const s={type:n===Ci.KEY?"nominal":n,timeUnit:i,bin:o};return Ai({type:t.type},r,s,a)}var wo=Object.freeze({isValueQuery:so,isFieldQuery:co,isAutoCountQuery:uo,isDisabledAutoCountQuery:lo,isEnabledAutoCountQuery:fo,toEncoding:po,toValueDef:go,toFieldDef:mo,isContinuous:yo,isMeasure:vo,isDimension:Eo,scaleType:bo}),To=n((function(e,t){!function(e,n){n(t)}(0,(function(e){var t=new Date,n=new Date;function r(e,i,o,a){function s(t){return e(t=new Date(+t)),t}return s.floor=s,s.round=function(t){var n=new Date(+t),r=new Date(t-1);return e(n),e(r),i(r,1),t-n<r-t?n:r},s.ceil=function(t){return e(t=new Date(t-1)),i(t,1),t},s.offset=function(e,t){return i(e=new Date(+e),null==t?1:Math.floor(t)),e},s.range=function(t,n,r){var o=[];if(t=new Date(t-1),n=new Date(+n),r=null==r?1:Math.floor(r),!(t<n&&r>0))return o;for(i(t,1),e(t),t<n&&o.push(new Date(+t));i(t,r),e(t),t<n;)o.push(new Date(+t));return o},s.filter=function(t){return r((function(n){for(;e(n),!t(n);)n.setTime(n-1)}),(function(e,n){for(;--n>=0;)for(;i(e,1),!t(e););}))},o&&(s.count=function(r,i){return t.setTime(+r),n.setTime(+i),e(t),e(n),Math.floor(o(t,n))},s.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?s.filter(a?function(t){return a(t)%e==0}:function(t){return s.count(0,t)%e==0}):s:null}),s}var i=r((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?r((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):i:null};var o=r((function(e){e.setMilliseconds(0)}),(function(e,t){e.setTime(+e+1e3*t)}),(function(e,t){return(t-e)/1e3}),(function(e){return e.getSeconds()})),a=r((function(e){e.setSeconds(0,0)}),(function(e,t){e.setTime(+e+6e4*t)}),(function(e,t){return(t-e)/6e4}),(function(e){return e.getMinutes()})),s=r((function(e){e.setMinutes(0,0,0)}),(function(e,t){e.setTime(+e+36e5*t)}),(function(e,t){return(t-e)/36e5}),(function(e){return e.getHours()})),c=r((function(e){e.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+t)}),(function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5}),(function(e){return e.getDate()-1}));function u(e){return r((function(t){t.setHours(0,0,0,0),t.setDate(t.getDate()-(t.getDay()+7-e)%7)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5}))}var l=u(0),d=u(1),f=u(2),h=u(3),p=u(4),g=u(5),m=u(6),y=r((function(e){e.setHours(0,0,0,0),e.setDate(1)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()})),v=r((function(e){e.setHours(0,0,0,0),e.setMonth(0,1)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()})),E=r((function(e){e.setUTCMilliseconds(0)}),(function(e,t){e.setTime(+e+1e3*t)}),(function(e,t){return(t-e)/1e3}),(function(e){return e.getUTCSeconds()})),b=r((function(e){e.setUTCSeconds(0,0)}),(function(e,t){e.setTime(+e+6e4*t)}),(function(e,t){return(t-e)/6e4}),(function(e){return e.getUTCMinutes()})),w=r((function(e){e.setUTCMinutes(0,0,0)}),(function(e,t){e.setTime(+e+36e5*t)}),(function(e,t){return(t-e)/36e5}),(function(e){return e.getUTCHours()})),T=r((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/864e5}),(function(e){return e.getUTCDate()-1}));function A(e){return r((function(t){t.setUTCHours(0,0,0,0),t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/6048e5}))}var S=A(0),C=A(1),N=A(2),O=A(3),x=A(4),I=A(5),U=A(6),M=r((function(e){e.setUTCHours(0,0,0,0),e.setUTCDate(1)}),(function(e,t){e.setUTCMonth(e.getUTCMonth()+t)}),(function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())}),(function(e){return e.getUTCMonth()})),_=r((function(e){e.setUTCHours(0,0,0,0),e.setUTCMonth(0,1)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()})),P=i.range,R=o.range,k=a.range,D=s.range,F=c.range,L=l.range,B=d.range,$=f.range,Y=h.range,W=p.range,j=g.range,H=m.range,G=l.range,z=y.range,q=v.range,Q=i,V=P,K=E.range,J=b.range,X=w.range,Z=T.range,ee=S.range,te=C.range,ne=N.range,re=O.range,ie=x.range,oe=I.range,ae=U.range,se=S.range,ce=M.range,ue=_.range,le="0.1.1";e.version=le,e.milliseconds=P,e.seconds=R,e.minutes=k,e.hours=D,e.days=F,e.sundays=L,e.mondays=B,e.tuesdays=$,e.wednesdays=Y,e.thursdays=W,e.fridays=j,e.saturdays=H,e.weeks=G,e.months=z,e.years=q,e.utcMillisecond=Q,e.utcMilliseconds=V,e.utcSeconds=K,e.utcMinutes=J,e.utcHours=X,e.utcDays=Z,e.utcSundays=ee,e.utcMondays=te,e.utcTuesdays=ne,e.utcWednesdays=re,e.utcThursdays=ie,e.utcFridays=oe,e.utcSaturdays=ae,e.utcWeeks=se,e.utcMonths=ce,e.utcYears=ue,e.millisecond=i,e.second=o,e.minute=a,e.hour=s,e.day=c,e.sunday=l,e.monday=d,e.tuesday=f,e.wednesday=h,e.thursday=p,e.friday=g,e.saturday=m,e.week=l,e.month=y,e.year=v,e.utcSecond=E,e.utcMinute=b,e.utcHour=w,e.utcDay=T,e.utcSunday=S,e.utcMonday=C,e.utcTuesday=N,e.utcWednesday=O,e.utcThursday=x,e.utcFriday=I,e.utcSaturday=U,e.utcWeek=S,e.utcMonth=M,e.utcYear=_,e.interval=r}))})),Ao=new Date,So=new Date(0,0,1).setFullYear(0),Co=new Date(Date.UTC(0,0,1)).setUTCFullYear(0);function No(e){return Ao.setTime(+e),Ao}function Oo(e,t,n,r,i,o){var a={type:e,date:t,unit:n};return r?a.step=r:a.minstep=1,null!=i&&(a.min=i),null!=o&&(a.max=o),a}function xo(e,t,n,r,i,o){return Oo(e,(function(e){return t.offset(n,e)}),(function(e){return t.count(n,e)}),r,i,o)}var Io=[xo("second",To.second,So),xo("minute",To.minute,So),xo("hour",To.hour,So),xo("day",To.day,So,[1,7]),xo("month",To.month,So,[1,3,6]),xo("year",To.year,So),Oo("seconds",(function(e){return new Date(1970,0,1,0,0,e)}),(function(e){return No(e).getSeconds()}),null,0,59),Oo("minutes",(function(e){return new Date(1970,0,1,0,e)}),(function(e){return No(e).getMinutes()}),null,0,59),Oo("hours",(function(e){return new Date(1970,0,1,e)}),(function(e){return No(e).getHours()}),null,0,23),Oo("weekdays",(function(e){return new Date(1970,0,4+e)}),(function(e){return No(e).getDay()}),[1],0,6),Oo("dates",(function(e){return new Date(1970,0,e)}),(function(e){return No(e).getDate()}),[1],1,31),Oo("months",(function(e){return new Date(1970,e%12,1)}),(function(e){return No(e).getMonth()}),[1],0,11)],Uo=[xo("second",To.utcSecond,Co),xo("minute",To.utcMinute,Co),xo("hour",To.utcHour,Co),xo("day",To.utcDay,Co,[1,7]),xo("month",To.utcMonth,Co,[1,3,6]),xo("year",To.utcYear,Co),Oo("seconds",(function(e){return new Date(Date.UTC(1970,0,1,0,0,e))}),(function(e){return No(e).getUTCSeconds()}),null,0,59),Oo("minutes",(function(e){return new Date(Date.UTC(1970,0,1,0,e))}),(function(e){return No(e).getUTCMinutes()}),null,0,59),Oo("hours",(function(e){return new Date(Date.UTC(1970,0,1,e))}),(function(e){return No(e).getUTCHours()}),null,0,23),Oo("weekdays",(function(e){return new Date(Date.UTC(1970,0,4+e))}),(function(e){return No(e).getUTCDay()}),[1],0,6),Oo("dates",(function(e){return new Date(Date.UTC(1970,0,e))}),(function(e){return No(e).getUTCDate()}),[1],1,31),Oo("months",(function(e){return new Date(Date.UTC(1970,e%12,1))}),(function(e){return No(e).getUTCMonth()}),[1],0,11)],Mo=[[31536e6,5],[7776e6,4],[2592e6,4],[12096e5,3],[6048e5,3],[1728e5,3],[864e5,3],[432e5,2],[216e5,2],[108e5,2],[36e5,2],[18e5,1],[9e5,1],[3e5,1],[6e4,1],[3e4,0],[15e3,0],[5e3,0],[1e3,0]];function _o(e,t,n,r){var i,o,a,s=Mo[0];for(i=1,o=Mo.length;i<o;++i)if(t>(s=Mo[i])[0]){if((a=t/s[0])>r)return e[Mo[i-1][1]];if(a>=n)return e[s[1]]}return e[Mo[o-1][1]]}function Po(e){var t,n,r={};for(t=0,n=e.length;t<n;++t)r[e[t].type]=e[t];return r.find=function(t,n,r){return _o(e,t,n,r)},r}var Ro=Po(Io),ko=Po(Uo);Ro.utc=ko;var Do=1e-15;function Fo(e){if(!e)throw Error("Missing binning options.");var t,n,r,i,o,a,s,c=e.maxbins||15,u=e.base||10,l=Math.log(u),d=e.div||[5,2],f=e.min,h=e.max,p=h-f;if(e.step)t=e.step;else if(e.steps)t=e.steps[Math.min(e.steps.length-1,Lo(e.steps,p/c,0,e.steps.length))];else{for(n=Math.ceil(Math.log(c)/l),r=e.minstep||0,t=Math.max(r,Math.pow(u,Math.round(Math.log(p)/l)-n));Math.ceil(p/t)>c;)t*=u;for(a=0;a<d.length;++a)(o=t/d[a])>=r&&p/o<=c&&(t=o)}return i=(o=Math.log(t))>=0?0:1+~~(-o/l),s=Math.pow(u,-i-1),{start:f=Math.min(f,Math.floor(f/t+s)*t),stop:h=Math.ceil(h/t)*t,step:t,unit:{precision:i},value:Bo,index:$o}}function Lo(e,t,n,r){for(;n<r;){var i=n+r>>>1;yn.cmp(e[i],t)<0?n=i+1:r=i}return n}function Bo(e){return this.step*Math.floor(e/this.step+Do)}function $o(e){return Math.floor((e-this.start)/this.step+Do)}function Yo(e){return this.unit.date(Bo.call(this,e))}function Wo(e){return $o.call(this,this.unit.unit(e))}Fo.date=function(e){if(!e)throw Error("Missing date binning options.");var t=e.utc?Ro.utc:Ro,n=e.min,r=e.max,i=e.maxbins||20,o=e.minbins||4,a=+r-+n,s=e.unit?t[e.unit]:t.find(a,o,i),c=Fo({min:null!=s.min?s.min:s.unit(n),max:null!=s.max?s.max:s.unit(r),maxbins:i,minstep:s.minstep,steps:s.step});return c.unit=s,c.index=Wo,e.raw||(c.value=Yo),c};var jo=Fo,Ho="__types__",Go={boolean:yn.boolean,integer:yn.number,number:yn.number,date:yn.date,string:function(e){return null==e||""===e?null:e+""}},zo={boolean:function(e){return"true"===e||"false"===e||yn.isBoolean(e)},integer:function(e){return zo.number(e)&&(e=+e)==~~e},number:function(e){return!isNaN(+e)&&!yn.isDate(e)},date:function(e){return!isNaN(Date.parse(e))}};function qo(e,t){if(!t)return e&&e[Ho]||null;e[Ho]=t}function Qo(e){return yn.keys(e)}function Vo(e){return"["+e+"]"}function Ko(e,t){var n,r,i;if(e=yn.array(e),t=yn.$(t),e[Ho]&&(n=t(e[Ho]),yn.isString(n)))return n;for(r=0,i=e.length;!yn.isValid(n)&&r<i;++r)n=t?t(e[r]):e[r];return yn.isDate(n)?"date":yn.isNumber(n)?"number":yn.isBoolean(n)?"boolean":yn.isString(n)?"string":null}function Jo(e,t){if(e.length){var n=t?yn.identity:(t=Qo(e[0]),Vo);return t.reduce((function(t,r){return t[r]=Ko(e,n(r)),t}),{})}}function Xo(e,t){var n,r,i;e=yn.array(e),t=yn.$(t);var o=["boolean","integer","number","date"];for(n=0;n<e.length;++n){for(i=t?t(e[n]):e[n],r=0;r<o.length;++r)yn.isValid(i)&&!zo[o[r]](i)&&(o.splice(r,1),r-=1);if(0===o.length)return"string"}return o[0]}function Zo(e,t){var n=t?yn.identity:(t=Qo(e[0]),Vo);return t.reduce((function(t,r){return t[r]=Xo(e,n(r)),t}),{})}Ko.annotation=qo,Ko.all=Jo,Ko.infer=Xo,Ko.inferAll=Zo,Ko.parsers=Go;var ea=Ko,ta=ea.inferAll,na=n((function(e){var t=e.exports;t.repeat=function(e,t){var n,r=Array(t);for(n=0;n<t;++n)r[n]=e;return r},t.zeros=function(e){return t.repeat(0,e)},t.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("Infinite range");var r,i=[],o=-1;if(n<0)for(;(r=e+n*++o)>t;)i.push(r);else for(;(r=e+n*++o)<t;)i.push(r);return i},t.random={},t.random.uniform=function(e,n){void 0===n&&(n=void 0===e?1:e,e=0);var r=n-e,i=function(){return e+r*Math.random()};return i.samples=function(e){return t.zeros(e).map(i)},i.pdf=function(t){return t>=e&&t<=n?1/r:0},i.cdf=function(t){return t<e?0:t>n?1:(t-e)/r},i.icdf=function(t){return t>=0&&t<=1?e+t*r:NaN},i},t.random.integer=function(e,n){void 0===n&&(n=e,e=0);var r=n-e,i=function(){return e+Math.floor(r*Math.random())};return i.samples=function(e){return t.zeros(e).map(i)},i.pdf=function(t){return t===Math.floor(t)&&t>=e&&t<n?1/r:0},i.cdf=function(t){var i=Math.floor(t);return i<e?0:i>=n?1:(i-e+1)/r},i.icdf=function(t){return t>=0&&t<=1?e-1+Math.floor(t*r):NaN},i},t.random.normal=function(e,n){var r;e=e||0,n=n||1;var i=function(){var t,i,o=0,a=0;if(void 0!==r)return o=r,r=void 0,o;do{t=(o=2*Math.random()-1)*o+(a=2*Math.random()-1)*a}while(0===t||t>1);return i=Math.sqrt(-2*Math.log(t)/t),r=e+a*i*n,e+o*i*n};return i.samples=function(e){return t.zeros(e).map(i)},i.pdf=function(t){var r=Math.exp(Math.pow(t-e,2)/(-2*Math.pow(n,2)));return 1/(n*Math.sqrt(2*Math.PI))*r},i.cdf=function(t){var r,i=(t-e)/n,o=Math.abs(i);if(o>37)r=0;else{var a=Math.exp(-o*o/2);o<7.07106781186547?(r=a*((((((.0352624965998911*o+.700383064443688)*o+6.37396220353165)*o+33.912866078383)*o+112.079291497871)*o+221.213596169931)*o+220.206867912376),r/=((((((.0883883476483184*o+1.75566716318264)*o+16.064177579207)*o+86.7807322029461)*o+296.564248779674)*o+637.333633378831)*o+793.826512519948)*o+440.413735824752):r=a/(o+1/(o+2/(o+3/(o+4/(o+.65)))))/2.506628274631}return i>0?1-r:r},i.icdf=function(t){if(t<=0||t>=1)return NaN;var r=2*t-1,i=8*(Math.PI-3)/(3*Math.PI*(4-Math.PI)),o=2/(Math.PI*i)+Math.log(1-Math.pow(r,2))/2,a=Math.log(1-r*r)/i,s=(r>0?1:-1)*Math.sqrt(Math.sqrt(o*o-a)-o);return e+n*Math.SQRT2*s},i},t.random.bootstrap=function(e,n){var r=e.filter(yn.isValid),i=r.length,o=n?t.random.normal(0,n):null,a=function(){return r[~~(Math.random()*i)]+(o?o():0)};return a.samples=function(e){return t.zeros(e).map(a)},a}})),ra=n((function(e){var t=e.exports;function n(e,n,r){var i=e&&e.nullh||0,o=na.random.normal(0,1),a=t.mean(n,r),s=t.stdev(n,r)/Math.sqrt(t.count.valid(n,r));if(0===s)return a-i==0?1:0;var c=(a-i)/s;return 2*o.cdf(-Math.abs(c))}function r(e,n,r,i){var o,a=i?n.map(yn.$(r)):n,s=i?n.map(yn.$(i)):r,c=t.count(a),u=t.count(s),l=Array();if(c!==u)throw Error("Array lengths must match.");for(o=0;o<c;++o)yn.isValid(a[o])&&yn.isValid(s[o])&&l.push(a[o]-s[o]);return t.z.test(l,e&&e.nullh||0)}function i(e,n,r,i){var o=i?n.map(yn.$(r)):n,a=i?n.map(yn.$(i)):r,s=t.count.valid(o),c=t.count.valid(a),u=na.random.normal(0,1),l=t.mean(o)-t.mean(a)-(e&&e.nullh||0),d=Math.sqrt(t.variance(o)/s+t.variance(a)/c);if(0===d)return 0===l?1:0;var f=l/d;return 2*u.cdf(-Math.abs(f))}t.unique=function(e,t,n){t=yn.$(t),n=n||[];var r,i,o,a={};for(i=0,o=e.length;i<o;++i)(r=t?t(e[i]):e[i])in a||(a[r]=1,n.push(r));return n},t.count=function(e){return e&&e.length||0},t.count.valid=function(e,t){t=yn.$(t);var n,r,i,o=0;for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],yn.isValid(n)&&(o+=1);return o},t.count.missing=function(e,t){t=yn.$(t);var n,r,i=0;for(n=0,r=e.length;n<r;++n)null==(t?t(e[n]):e[n])&&(i+=1);return i},t.count.distinct=function(e,t){t=yn.$(t);var n,r,i,o={},a=0;for(r=0,i=e.length;r<i;++r)(n=t?t(e[r]):e[r])in o||(o[n]=1,a+=1);return a},t.count.map=function(e,t){t=yn.$(t);var n,r,i,o={};for(r=0,i=e.length;r<i;++r)o[n=t?t(e[r]):e[r]]=n in o?o[n]+1:1;return o},t.median=function(e,n){return n&&(e=e.map(yn.$(n))),e=e.filter(yn.isValid).sort(yn.cmp),t.quantile(e,.5)},t.quartile=function(e,n){n&&(e=e.map(yn.$(n))),e=e.filter(yn.isValid).sort(yn.cmp);var r=t.quantile;return[r(e,.25),r(e,.5),r(e,.75)]},t.quantile=function(e,t,n){void 0===n&&(n=t,t=yn.identity),t=yn.$(t);var r=(e.length-1)*n+1,i=Math.floor(r),o=+t(e[i-1]),a=r-i;return a?o+a*(t(e[i])-o):o},t.sum=function(e,t){t=yn.$(t);for(var n,r=0,i=0,o=e.length;i<o;++i)n=t?t(e[i]):e[i],yn.isValid(n)&&(r+=n);return r},t.mean=function(e,t){t=yn.$(t);var n,r,i,o,a=0;for(n=0,i=0,r=e.length;n<r;++n)o=t?t(e[n]):e[n],yn.isValid(o)&&(a+=(o-a)/++i);return a},t.mean.geometric=function(e,t){t=yn.$(t);var n,r,i,o,a=1;for(o=0,n=0,r=e.length;o<r;++o)if(i=t?t(e[o]):e[o],yn.isValid(i)){if(i<=0)throw Error("Geometric mean only defined for positive values.");a*=i,++n}return a=n>0?Math.pow(a,1/n):0},t.mean.harmonic=function(e,t){t=yn.$(t);var n,r,i,o,a=0;for(o=0,n=0,r=e.length;o<r;++o)i=t?t(e[o]):e[o],yn.isValid(i)&&(a+=1/i,++n);return n/a},t.variance=function(e,t){if(t=yn.$(t),!yn.isArray(e)||e.length<2)return 0;var n,r,i,o,a=0,s=0;for(r=0,i=0;r<e.length;++r)o=t?t(e[r]):e[r],yn.isValid(o)&&(s+=(n=o-a)*(o-(a+=n/++i)));return s/=i-1},t.stdev=function(e,n){return Math.sqrt(t.variance(e,n))},t.modeskew=function(e,n){var r=t.mean(e,n),i=t.median(e,n),o=t.stdev(e,n);return 0===o?0:(r-i)/o},t.min=function(e,n){return t.extent(e,n)[0]},t.max=function(e,n){return t.extent(e,n)[1]},t.extent=function(e,t){t=yn.$(t);var n,r,i,o,a=e.length;for(o=0;o<a;++o)if(i=t?t(e[o]):e[o],yn.isValid(i)){n=r=i;break}for(;o<a;++o)i=t?t(e[o]):e[o],yn.isValid(i)&&(i<n&&(n=i),i>r&&(r=i));return[n,r]},t.extent.index=function(e,t){t=yn.$(t);var n,r,i,o,a=-1,s=-1,c=e.length;for(o=0;o<c;++o)if(i=t?t(e[o]):e[o],yn.isValid(i)){n=r=i,a=s=o;break}for(;o<c;++o)i=t?t(e[o]):e[o],yn.isValid(i)&&(i<n&&(n=i,a=o),i>r&&(r=i,s=o));return[a,s]},t.dot=function(e,t,n){var r,i,o=0;if(n)for(t=yn.$(t),n=yn.$(n),r=0;r<e.length;++r)(i=t(e[r])*n(e[r]))==i&&(o+=i);else{if(e.length!==t.length)throw Error("Array lengths must match.");for(r=0;r<e.length;++r)(i=e[r]*t[r])==i&&(o+=i)}return o},t.dist=function(e,t,n,r){var i,o,a=yn.isFunction(n)||yn.isString(n),s=e,c=a?e:t,u=a?r:n,l=2===u||null==u,d=e.length,f=0;for(a&&(t=yn.$(t),n=yn.$(n)),o=0;o<d;++o)i=a?t(s[o])-n(c[o]):s[o]-c[o],f+=l?i*i:Math.pow(Math.abs(i),u);return l?Math.sqrt(f):Math.pow(f,1/u)},t.cohensd=function(e,n,r){var i=r?e.map(yn.$(n)):e,o=r?e.map(yn.$(r)):n,a=t.mean(i),s=t.mean(o),c=t.count.valid(i),u=t.count.valid(o);if(c+u-2<=0)return 0;var l=t.variance(i),d=t.variance(o),f=Math.sqrt(((c-1)*l+(u-1)*d)/(c+u-2));return 0===f?0:(a-s)/f},t.covariance=function(e,n,r){var i,o,a,s,c,u=r?e.map(yn.$(n)):e,l=r?e.map(yn.$(r)):n,d=u.length,f=t.mean(u),h=t.mean(l),p=0,g=0;if(d!==l.length)throw Error("Input lengths must match.");for(i=0;i<d;++i)if(o=u[i],s=yn.isValid(o),a=l[i],c=yn.isValid(a),s&&c)p+=(o-f)*(a-h),++g;else if(s||c)throw Error("Valid values must align.");return p/(g-1)},t.rank=function(e,t){t=yn.$(t)||yn.identity;var n,r,i,o=e.map((function(e,n){return{idx:n,val:t(e)}})).sort(yn.comparator("val")),a=e.length,s=Array(a),c=-1,u={};for(n=0;n<a;++n){if(r=o[n].val,c<0&&u===r)c=n-1;else if(c>-1&&u!==r){for(i=1+(n-1+c)/2;c<n;++c)s[o[c].idx]=i;c=-1}s[o[n].idx]=n+1,u=r}if(c>-1)for(i=1+(a-1+c)/2;c<a;++c)s[o[c].idx]=i;return s},t.cor=function(e,n,r){var i=r;r=i?e.map(yn.$(r)):n,n=i?e.map(yn.$(n)):e;var o=t.dot(n,r),a=t.mean(n),s=t.mean(r),c=t.stdev(n),u=t.stdev(r),l=e.length;return(o-l*a*s)/((l-1)*c*u)},t.cor.rank=function(e,n,r){var i,o,a,s=r?t.rank(e,n):t.rank(e),c=r?t.rank(e,r):t.rank(n),u=e.length;for(i=0,o=0;i<u;++i)o+=(a=s[i]-c[i])*a;return 1-6*o/(u*(u*u-1))},t.cor.dist=function(e,n,r){var i,o,a,s,c=r?e.map(yn.$(n)):e,u=r?e.map(yn.$(r)):n,l=t.dist.mat(c),d=t.dist.mat(u),f=l.length;for(i=0,o=0,a=0,s=0;i<f;++i)o+=l[i]*l[i],a+=d[i]*d[i],s+=l[i]*d[i];return Math.sqrt(s/Math.sqrt(o*a))},t.linearRegression=function(e,n,r){var i,o,a=r?e.map(yn.$(n)):e,s=r?e.map(yn.$(r)):n,c=a.length,u=t.covariance(a,s),l=t.stdev(a),d=t.stdev(s),f=u/(l*l),h=t.mean(s)-f*t.mean(a),p={slope:f,intercept:h,R:u/(l*d),rss:0};for(o=0;o<c;++o)yn.isValid(a[o])&&yn.isValid(s[o])&&(i=f*a[o]+h-s[o],p.rss+=i*i);return p},t.bootstrap={},t.bootstrap.ci=function(e,n,r,i,o){var a,s,c,u,l,d,f;for(yn.isFunction(n)||yn.isString(n)?(a=e.map(yn.$(n)),s=r,c=i,u=o):(a=e,s=n,c=r,u=i),s=s?+s:1e3,c=c||.05,l=na.random.bootstrap(a,u),f=0,d=Array(s);f<s;++f)d[f]=t.mean(l.samples(a.length));return d.sort(yn.numcmp),[t.quantile(d,c/2),t.quantile(d,1-c/2)]},t.z={},t.z.ci=function(e,n,r){var i=e,o=n;(yn.isFunction(n)||yn.isString(n))&&(i=e.map(yn.$(n)),o=r);var a=.05===(o=o||.05)?1.96:na.random.normal(0,1).icdf(1-o/2),s=t.mean(i),c=t.stdev(i)/Math.sqrt(t.count.valid(i));return[s-a*c,s+a*c]},t.z.test=function(e,t,o,a){return yn.isFunction(o)||yn.isString(o)?(a&&a.paired?r:i)(a,e,t,o):yn.isArray(t)?(o&&o.paired?r:i)(o,e,t):yn.isFunction(t)||yn.isString(t)?n(o,e,t):n(t,e)},t.dist.mat=function(e){var t,n,r,i=e.length,o=i*i,a=Array(o),s=na.zeros(i),c=0;for(n=0;n<i;++n)for(a[n*i+n]=0,r=n+1;r<i;++r)a[n*i+r]=t=Math.abs(e[n]-e[r]),a[r*i+n]=t,s[n]+=t,s[r]+=t;for(n=0;n<i;++n)c+=s[n],s[n]/=i;for(c/=o,n=0;n<i;++n)for(r=n;r<i;++r)a[n*i+r]+=c-s[n]-s[r],a[r*i+n]=a[n*i+r];return a},t.entropy=function(e,t){t=yn.$(t);var n,r,i=0,o=0,a=e.length;for(n=0;n<a;++n)i+=t?t(e[n]):e[n];if(0===i)return 0;for(n=0;n<a;++n)(r=(t?t(e[n]):e[n])/i)&&(o+=r*Math.log(r));return-o/Math.LN2},t.mutual=function(e,t,n,r){var i,o,a,s=r?e.map(yn.$(t)):e,c=r?e.map(yn.$(n)):t,u=r?e.map(yn.$(r)):n,l={},d={},f=u.length,h=0,p=0,g=0;for(a=0;a<f;++a)l[s[a]]=0,d[c[a]]=0;for(a=0;a<f;++a)l[s[a]]+=u[a],d[c[a]]+=u[a],h+=u[a];for(o=1/(h*Math.LN2),a=0;a<f;++a)0!==u[a]&&(i=h*u[a]/(l[s[a]]*d[c[a]]),p+=u[a]*o*Math.log(i),g+=u[a]*o*Math.log(u[a]/h));return[p,1+p/g]},t.mutual.info=function(e,n,r,i){return t.mutual(e,n,r,i)[0]},t.mutual.dist=function(e,n,r,i){return t.mutual(e,n,r,i)[1]},t.profile=function(e,n){var r,i,o,a,s,c=0,u=0,l=0,d=0,f=null,h=null,p=0,g=[],m={};for(o=0;o<e.length;++o)m[a=n?n(e[o]):e[o]]=a in m?m[a]+1:(d+=1,1),null==a?++l:yn.isValid(a)&&(s="string"==typeof a?a.length:a,(null===f||s<f)&&(f=s),(null===h||s>h)&&(h=s),p+=(r=s-c)*(s-(c+=r/++u)),g.push(s));return p/=u-1,i=Math.sqrt(p),g.sort(yn.cmp),{type:ea(e,n),unique:m,count:e.length,valid:u,missing:l,distinct:d,min:f,max:h,mean:c,stdev:i,median:a=t.quantile(g,.5),q1:t.quantile(g,.25),q3:t.quantile(g,.75),modeskew:0===i?0:(c-a)/i}},t.summary=function(e,n){var r=(n=n||yn.keys(e[0])).map((function(n){var r=t.profile(e,yn.$(n));return r.field=n,r}));return r.__summary__=!0,r}})),ia=ra.summary;const oa=jo;function aa(e,t={},n={fields:[]}){t=Tn({},Jr,t);let r=ia(e),i=ta(e),o=n.fields.reduce(((e,t)=>(e[t.name]=t,e)),{}),a=r.map((function(n,r){const a=n.field,s="date"===i[a]?ha.DATETIME:i[a];let c,u=n.distinct;if(s===ha.NUMBER)c=Gt;else if(s===ha.INTEGER)c=u<t.numberNominalLimit&&u/n.count<t.numberNominalProportion?Qt:Gt;else if(s===ha.DATETIME){c=qt,n.min=new Date(e[0][a]),n.max=new Date(e[0][a]);for(const t of e){const e=new Date(t[a]).getTime();e<n.min.getTime()&&(n.min=new Date(e)),e>n.max.getTime()&&(n.max=new Date(e))}}else c=Qt;c===Qt&&u/n.count>t.minPercentUniqueForKey&&n.count>t.minCardinalityForKey&&(c=Ci.KEY);let l={name:a,originalIndex:r,vlType:c,type:s,stats:n,timeStats:{},binStats:{}};const d=o[l.name];return l=Tn(l,d),l}));for(let e of a)if(e.vlType===Gt)for(let n of t.enum.binProps.maxbins)e.binStats[n]=ua(n,e.stats);else if(e.vlType===qt)for(let n of t.enum.timeUnit)void 0!==n&&(e.timeStats[n]=la(n,e.stats));const s=Object.assign({},n,{fields:a});return new ca(s)}const sa={nominal:0,key:1,ordinal:2,temporal:3,quantitative:4};class ca{constructor(e){this._tableSchema=e,e.fields.sort((function(e,t){return sa[e.vlType]<sa[t.vlType]?-1:sa[e.vlType]>sa[t.vlType]?1:e.name.localeCompare(t.name)})),e.fields.forEach(((e,t)=>e.index=t)),this._fieldSchemaIndex=e.fields.reduce(((e,t)=>(e[t.name]=t,e)),{})}fieldNames(){return this._tableSchema.fields.map((e=>e.name))}get fieldSchemas(){return this._tableSchema.fields}fieldSchema(e){return this._fieldSchemaIndex[e]}tableSchema(){const e=wn(this._tableSchema);return e.fields.sort(((e,t)=>e.originalIndex-t.originalIndex)),e}primitiveType(e){return this._fieldSchemaIndex[e]?this._fieldSchemaIndex[e].type:null}vlType(e){return this._fieldSchemaIndex[e]?this._fieldSchemaIndex[e].vlType:null}cardinality(e,t=!0,n=!1){const r=this._fieldSchemaIndex[e.field];if(e.aggregate||uo(e)&&e.autoCount)return 1;if(e.bin){let t;t="boolean"==typeof e.bin?{maxbins:li(e.channel)}:"?"===e.bin?{enum:[!0,!1]}:e.bin;const n=t.maxbins;return r.binStats[n]||(r.binStats[n]=ua(n,r.stats)),r.binStats[n].distinct}if(e.timeUnit){if(t)switch(e.timeUnit){case vr.SECONDS:case vr.MINUTES:return 60;case vr.HOURS:return 24;case vr.DAY:return 7;case vr.DATE:return 31;case vr.MONTH:return 12;case vr.QUARTER:return 4;case vr.MILLISECONDS:return 1e3}let i=e.timeUnit,o=r.timeStats;return o&&o[i]||(o=Object.assign({},o,{[i]:la(e.timeUnit,r.stats)})),n?o[i].distinct-fa(o[i].unique,["Invalid Date",null]):o[i].distinct}return r?n?r.stats.distinct-fa(r.stats.unique,[NaN,null]):r.stats.distinct:null}timeUnitHasVariation(e){if(!e.timeUnit)return;if(e.timeUnit===vr.DAY){const t=Tn({},e,{timeUnit:vr.DATE});if(this.cardinality(t,!1,!0)<=1)return!1}let t=e.timeUnit;for(let n of br)if(Pr(t,n)){const t=Tn({},e,{timeUnit:n});if(this.cardinality(t,!1,!0)<=1)return!1}return!0}domain(e){const t=this._fieldSchemaIndex[e.field];let n=bn(t.stats.unique);return t.vlType===Gt?[+t.stats.min,+t.stats.max]:t.type===ha.DATETIME?[t.stats.min,t.stats.max]:t.type===ha.INTEGER||t.type===ha.NUMBER?(n=n.map((e=>+e)),n.sort(En)):t.vlType===zt&&t.ordinalDomain?t.ordinalDomain:n.map((e=>"null"===e?null:e)).sort(En)}stats(e){const t=this._fieldSchemaIndex[e.field];return t?t.stats:null}}function ua(e,t){const n=oa({min:t.min,max:t.max,maxbins:e}),r=Tn({},t);return r.unique=da(n,t.unique),r.distinct=(n.stop-n.start)/n.step,r.min=n.start,r.max=n.stop,r}function la(e,t){const n=Tn({},t);let r={};return bn(t.unique).forEach((function(n){let i,o="null"===n?null:new Date(n);i=null===o?null:isNaN(o.getTime())?"Invalid Date":(e===vr.DAY?o.getDay():Mr(e,o)).toString(),r[i]=(r[i]||0)+t.unique[n]})),n.unique=r,n.distinct=bn(r).length,n}function da(e,t){const n={};for(let r in t){let i;i=null===r?null:isNaN(Number(r))?NaN:e.value(Number(r)),n[i]=(n[i]||0)+t[r]}return n}function fa(e,t){return t.reduce((function(t,n){return e[n]?t+1:t}),0)}var ha;!function(e){e[e.STRING="string"]="STRING",e[e.NUMBER="number"]="NUMBER",e[e.INTEGER="integer"]="INTEGER",e[e.BOOLEAN="boolean"]="BOOLEAN",e[e.DATETIME="datetime"]="DATETIME"}(ha||(ha={}));var pa=Object.freeze({build:aa,Schema:ca,get PrimitiveType(){return ha}});class ga{constructor(e){this.constraint=e}name(){return this.constraint.name}description(){return this.constraint.description}properties(){return this.constraint.properties}strict(){return this.constraint.strict}}class ma extends ga{constructor(e){super(e)}hasAllRequiredPropertiesSpecific(e){return xn(this.constraint.properties,(t=>{if(kn(t)){let n=t.parent,r=t.child;return!e[n]||!kr(e[n][r])}return!e[t]||!kr(e[t])}))}satisfy(e,t,n,r){return!this.constraint.allowWildcardForProperties&&!this.hasAllRequiredPropertiesSpecific(e)||this.constraint.satisfy(e,t,n,r)}}const ya=[{name:"aggregateOpSupportedByType",description:"Aggregate function should be supported by data type.",properties:[ir.TYPE,ir.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>!e.aggregate||!Ni(e.type)},{name:"asteriskFieldWithCountOnly",description:'Field="*" should be disallowed except aggregate="count"',properties:[ir.FIELD,ir.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>"*"===e.field==("count"===e.aggregate)},{name:"minCardinalityForBin",description:"binned quantitative field should not have too low cardinality",properties:[ir.BIN,ir.FIELD,ir.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>{if(e.bin&&e.type===Gt){let n={channel:e.channel,field:e.field,type:e.type};return t.cardinality(n)>=r.minCardinalityForBin}return!0}},{name:"binAppliedForQuantitative",description:"bin should be applied to quantitative field only.",properties:[ir.TYPE,ir.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>!e.bin||e.type===Gt},{name:"channelFieldCompatible",description:"encoding channel's range type be compatible with channel type.",properties:[ir.CHANNEL,ir.TYPE,ir.BIN,ir.TIMEUNIT],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>{const i=Object.assign({field:"f"},mo(e,{schema:t,props:["bin","timeUnit","type"]})),{compatible:o}=Ti(i,e.channel);return!!o||!("row"!==e.channel&&"column"!==e.channel||!wr(i.timeUnit)&&!Ar(i.timeUnit))}},{name:"hasFn",description:"A field with as hasFn flag should have one of aggregate, timeUnit, or bin.",properties:[ir.AGGREGATE,ir.BIN,ir.TIMEUNIT],allowWildcardForProperties:!0,strict:!0,satisfy:(e,t,n,r)=>!(e.hasFn&&!e.aggregate&&!e.bin&&!e.timeUnit)},{name:"omitScaleZeroWithBinnedField",description:"Do not use scale zero with binned field",properties:[ir.SCALE,er("scale","zero"),ir.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>!e.bin||!e.scale||!0!==e.scale.zero},{name:"onlyOneTypeOfFunction",description:"Only of of aggregate, autoCount, timeUnit, or bin should be applied at the same time.",properties:[ir.AGGREGATE,ir.AUTOCOUNT,ir.TIMEUNIT,ir.BIN],allowWildcardForProperties:!0,strict:!0,satisfy:(e,t,n,r)=>!co(e)||(!kr(e.aggregate)&&e.aggregate?1:0)+(!kr(e.bin)&&e.bin?1:0)+(!kr(e.timeUnit)&&e.timeUnit?1:0)<=1},{name:"timeUnitAppliedForTemporal",description:"Time unit should be applied to temporal field only.",properties:[ir.TYPE,ir.TIMEUNIT],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>!e.timeUnit||e.type===qt},{name:"timeUnitShouldHaveVariation",description:"A particular time unit should be applied only if they produce unique values.",properties:[ir.TIMEUNIT,ir.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n,r)=>!e.timeUnit||e.type!==qt||!n.has("timeUnit")&&!r.constraintManuallySpecifiedValue||t.timeUnitHasVariation(e)},{name:"scalePropertiesSupportedByScaleType",description:"Scale properties must be supported by correct scale type",properties:[].concat(Gn,[ir.SCALE,ir.TYPE]),allowWildcardForProperties:!0,strict:!0,satisfy:(e,t,n,r)=>{if(e.scale){const t=e.scale,n=bo(e);if(null==n)return!0;for(let e in t){if("type"===e||"name"===e||"enum"===e)continue;const t=e;if("point"===n){if(!dn("point",t)&&!dn("band",t))return!1}else if(!dn(n,t))return!1}}return!0}},{name:"scalePropertiesSupportedByChannel",description:"Not all scale properties are supported by all encoding channels",properties:[].concat(Gn,[ir.SCALE,ir.CHANNEL]),allowWildcardForProperties:!0,strict:!0,satisfy:(e,t,n,r)=>{if(e){let t=e.channel,n=e.scale;if(t&&!kr(t)&&n){if("row"===t||"column"===t)return!1;for(let e in n)if(n.hasOwnProperty(e)&&"type"!==e&&"name"!==e&&"enum"!==e&&void 0!==fn(t,e))return!1}}return!0}},{name:"typeMatchesPrimitiveType",description:"Data type should be supported by field's primitive type.",properties:[ir.FIELD,ir.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>{if("*"===e.field)return!0;const i=t.primitiveType(e.field),o=e.type;if(!n.has("field")&&!n.has("type")&&!r.constraintManuallySpecifiedValue)return!0;switch(i){case ha.BOOLEAN:case ha.STRING:return o!==Gt&&o!==qt;case ha.NUMBER:case ha.INTEGER:return o!==qt;case ha.DATETIME:return o===qt;case null:return!1}throw new Error("Not implemented")}},{name:"typeMatchesSchemaType",description:"Enumerated data type of a field should match the field's type in the schema.",properties:[ir.FIELD,ir.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n,r)=>!(n.has("field")||n.has("type")||r.constraintManuallySpecifiedValue)||("*"===e.field?e.type===Gt:t.vlType(e.field)===e.type)},{name:"maxCardinalityForCategoricalColor",description:"Categorical channel should not have too high cardinality",properties:[ir.CHANNEL,ir.FIELD],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n,r)=>e.channel!==G||e.type!==Qt&&e.type!==Ci.KEY||t.cardinality(e)<=r.maxCardinalityForCategoricalColor},{name:"maxCardinalityForFacet",description:"Row/column channel should not have too high cardinality",properties:[ir.CHANNEL,ir.FIELD,ir.BIN,ir.TIMEUNIT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n,r)=>e.channel!==R&&e.channel!==k||t.cardinality(e)<=r.maxCardinalityForFacet},{name:"maxCardinalityForShape",description:"Shape channel should not have too high cardinality",properties:[ir.CHANNEL,ir.FIELD,ir.BIN,ir.TIMEUNIT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n,r)=>e.channel!==Q||t.cardinality(e)<=r.maxCardinalityForShape},{name:"dataTypeAndFunctionMatchScaleType",description:"Scale type must match data type",properties:[ir.TYPE,ir.SCALE,er("scale","type"),ir.TIMEUNIT,ir.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>{if(e.scale){const t=e.type,n=bo(e);if(Ni(t))return void 0===n||on(n);if(t===qt)return e.timeUnit?On([Jt.TIME,Jt.UTC,void 0],n)||on(n):On([Jt.TIME,Jt.UTC,void 0],n);if(t===Gt)return e.bin?On([Jt.LINEAR,void 0],n):On([Jt.LOG,Jt.POW,Jt.SQRT,Jt.QUANTILE,Jt.QUANTIZE,Jt.LINEAR,void 0],n)}return!0}},{name:"stackIsOnlyUsedWithXY",description:"stack should only be allowed for x and y channels",properties:[ir.STACK,ir.CHANNEL],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>!e.stack||e.channel===F||e.channel===L}].map((e=>new ma(e)));ya.reduce(((e,t)=>(e[t.name()]=t,e)),{});const va=ya.reduce(((e,t)=>{for(const n of t.properties())e.set(n,e.get(n)||[]),e.get(n).push(t);return e}),new Oi),Ea=[{name:"doesNotSupportConstantValue",description:"row, column, x, y, order, and detail should not work with constant values.",properties:[ir.TYPE,ir.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>!On(["row","column","x","y","detail","order"],e.channel)}].map((e=>new ma(e)));Ea.reduce(((e,t)=>(e[t.name()]=t,e)),{});const ba=Ea.reduce(((e,t)=>{for(const n of t.properties())e.set(n,e.get(n)||[]),e.get(n).push(t);return e}),new Oi);function wa(e,t,n,r,i,o){const a=va.get(e)||[],s=r.getEncodingQueryByIndex(n);for(const e of a)if((e.strict()||o[e.name()])&&!e.satisfy(s,i,r.wildcardIndex.encodings[n],o)){let n="(enc) "+e.name();return o.verbose&&console.log(n+" failed with "+r.toShorthand()+" for "+t.name),n}const c=ba.get(e)||[];for(const e of c)if((e.strict()||o[e.name()])&&so(s)&&!e.satisfy(s,i,r.wildcardIndex.encodings[n],o)){let n="(enc) "+e.name();return o.verbose&&console.log(n+" failed with "+r.toShorthand()+" for "+t.name),n}return null}var Ta=Object.freeze({checkEncoding:wa});const Aa=ge.reduce(((e,t)=>(e[t]=!0,e)),{});class Sa extends ga{constructor(e){super(e)}hasAllRequiredPropertiesSpecific(e){return xn(this.constraint.properties,(t=>{if(t===ir.MARK)return!kr(e.getMark());if(kn(t)){let n=t.parent,r=t.child;return xn(e.getEncodings(),(e=>!e[n]||!kr(e[n][r])))}if(!tr(t))throw new Error("UNIMPLEMENTED");return xn(e.getEncodings(),(e=>!e[t]||!kr(e[t])))}))}satisfy(e,t,n){return!this.constraint.allowWildcardForProperties&&!this.hasAllRequiredPropertiesSpecific(e)||this.constraint.satisfy(e,t,n)}}const Ca=[{name:"noRepeatedChannel",description:"Each encoding channel should only be used once.",properties:[ir.CHANNEL],allowWildcardForProperties:!0,strict:!0,satisfy:(e,t,n)=>{let r={};return xn(e.getEncodings(),(e=>!!kr(e.channel)||!r[e.channel]&&(r[e.channel]=!0,!0)))}},{name:"alwaysIncludeZeroInScaleWithBarMark",description:"Do not recommend bar mark if scale does not start at zero",properties:[ir.MARK,ir.SCALE,er("scale","zero"),ir.CHANNEL,ir.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n)=>{const r=e.getMark(),i=e.getEncodings();if(r===sr)for(let e of i)if(co(e)&&(e.channel===F||e.channel===L)&&e.type===Gt&&e.scale&&!1===e.scale.zero)return!1;return!0}},{name:"autoAddCount",description:"Automatically adding count only for plots with only ordinal, binned quantitative, or temporal with timeunit fields.",properties:[ir.BIN,ir.TIMEUNIT,ir.TYPE,ir.AUTOCOUNT],allowWildcardForProperties:!0,strict:!1,satisfy:(e,t,n)=>{if(Un(e.getEncodings(),(e=>fo(e))))return xn(e.getEncodings(),(e=>{if(so(e))return!0;if(uo(e))return!0;switch(e.type){case Gt:return!!e.bin;case qt:return!!e.timeUnit;case zt:case Ci.KEY:case Qt:return!0}throw new Error("Unsupported Type")}));{const t=xn(e.wildcardIndex.encodingIndicesByProperty.get("autoCount")||[],(t=>{let n=e.getEncodingQueryByIndex(t);return uo(n)&&!kr(n.autoCount)}));if(t)return Un(e.getEncodings(),(e=>(co(e)||uo(e))&&e.type===Gt?!lo(e)&&co(e)&&(!e.bin||kr(e.bin)):!(!co(e)||e.type!==qt)&&(!e.timeUnit||kr(e.timeUnit))))}return!0}},{name:"channelPermittedByMarkType",description:"Each encoding channel should be supported by the mark type",properties:[ir.CHANNEL,ir.MARK],allowWildcardForProperties:!0,strict:!0,satisfy:(e,t,n)=>{const r=e.getMark();return!!kr(r)||xn(e.getEncodings(),(e=>!!kr(e.channel)||!!be(e.channel,r)))}},{name:"hasAllRequiredChannelsForMark",description:"All required channels for the specified mark should be specified",properties:[ir.CHANNEL,ir.MARK],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n)=>{const r=e.getMark();switch(r){case ar:case cr:return e.channelUsed(F)&&e.channelUsed(L);case fr:return e.channelUsed(te);case sr:case pr:case gr:case hr:case dr:case lr:return e.channelUsed(F)||e.channelUsed(L);case ur:return!e.wildcardIndex.hasProperty(ir.CHANNEL)||e.channelUsed(F)||e.channelUsed(L)}throw new Error("hasAllRequiredChannelsForMark not implemented for mark"+JSON.stringify(r))}},{name:"omitAggregate",description:"Omit aggregate plots.",properties:[ir.AGGREGATE,ir.AUTOCOUNT],allowWildcardForProperties:!0,strict:!1,satisfy:(e,t,n)=>!e.isAggregate()},{name:"omitAggregatePlotWithDimensionOnlyOnFacet",description:"Omit aggregate plots with dimensions only on facets as that leads to inefficient use of space.",properties:[ir.CHANNEL,ir.AGGREGATE,ir.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n)=>{if(e.isAggregate()){let t=!1,r=!1,i=!1;if(e.specQuery.encodings.forEach(((n,o)=>{so(n)||lo(n)||co(n)&&!n.aggregate&&(r=!0,On([R,k],n.channel)?e.wildcardIndex.hasEncodingProperty(o,ir.CHANNEL)&&(i=!0):t=!0)})),r&&!t&&(i||n.constraintManuallySpecifiedValue))return!1}return!0}},{name:"omitAggregatePlotWithoutDimension",description:"Aggregate plots without dimension should be omitted",properties:[ir.AGGREGATE,ir.AUTOCOUNT,ir.BIN,ir.TIMEUNIT,ir.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n)=>!e.isAggregate()||Un(e.getEncodings(),(e=>!!(Eo(e)||co(e)&&"temporal"===e.type)))},{name:"omitBarLineAreaWithOcclusion",description:"Don't use bar, line or area to visualize raw plot as they often lead to occlusion.",properties:[ir.MARK,ir.AGGREGATE,ir.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n)=>!On([sr,cr,ar],e.getMark())||e.isAggregate()},{name:"omitBarTickWithSize",description:"Do not map field to size channel with bar and tick mark",properties:[ir.CHANNEL,ir.MARK],allowWildcardForProperties:!0,strict:!1,satisfy:(e,t,n)=>{const r=e.getMark();if(On([hr,sr],r)&&e.channelEncodingField(V)){if(n.constraintManuallySpecifiedValue)return!1;{const t=e.specQuery.encodings;for(let n=0;n<t.length;n++)if(t[n].channel===V)return!e.wildcardIndex.hasEncodingProperty(n,ir.CHANNEL)}}return!0}},{name:"omitBarAreaForLogScale",description:"Do not use bar and area mark for x and y's log scale",properties:[ir.MARK,ir.CHANNEL,ir.SCALE,er("scale","type"),ir.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n)=>{const r=e.getMark(),i=e.getEncodings();if(r===ar||r===sr)for(let e of i)if(co(e)&&(e.channel===F||e.channel===L)&&e.scale&&bo(e)===Jt.LOG)return!1;return!0}},{name:"omitMultipleNonPositionalChannels",description:"Unless manually specified, do not use multiple non-positional encoding channel to avoid over-encoding.",properties:[ir.CHANNEL],allowWildcardForProperties:!0,strict:!1,satisfy:(e,t,n)=>{const r=e.specQuery.encodings;let i=0,o=!1;for(let t=0;t<r.length;t++){const a=r[t];if(so(a)||lo(a))continue;const s=a.channel;if(!kr(s)&&Aa[s+""]&&(i+=1,e.wildcardIndex.hasEncodingProperty(t,ir.CHANNEL)&&(o=!0),i>1&&(o||n.constraintManuallySpecifiedValue)))return!1}return!0}},{name:"omitNonPositionalOrFacetOverPositionalChannels",description:"Do not use non-positional channels unless all positional channels are used",properties:[ir.CHANNEL],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n)=>{const r=e.specQuery.encodings;let i=!1,o=!1,a=!1,s=!1;for(let t=0;t<r.length;t++){const n=r[t];if(so(n)||lo(n))continue;const c=n.channel;c===F?a=!0:c===L?s=!0:kr(c)||(i=!0,e.wildcardIndex.hasEncodingProperty(t,ir.CHANNEL)&&(o=!0))}return!(o||n.constraintManuallySpecifiedValue&&i)||a&&s}},{name:"omitRaw",description:"Omit raw plots.",properties:[ir.AGGREGATE,ir.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n)=>!!e.isAggregate()},{name:"omitRawContinuousFieldForAggregatePlot",description:"Aggregate plot should not use raw continuous field as group by values. (Quantitative should be binned. Temporal should have time unit.)",properties:[ir.AGGREGATE,ir.AUTOCOUNT,ir.TIMEUNIT,ir.BIN,ir.TYPE],allowWildcardForProperties:!0,strict:!1,satisfy:(e,t,n)=>{if(e.isAggregate()){const t=e.specQuery.encodings;for(let r=0;r<t.length;r++){const i=t[r];if(!so(i)&&!lo(i)){if(co(i)&&i.type===qt&&!i.timeUnit&&(e.wildcardIndex.hasEncodingProperty(r,ir.TIMEUNIT)||n.constraintManuallySpecifiedValue))return!1;if(i.type===Gt&&co(i)&&!i.bin&&!i.aggregate){if(e.wildcardIndex.hasEncodingProperty(r,ir.BIN)||e.wildcardIndex.hasEncodingProperty(r,ir.AGGREGATE)||e.wildcardIndex.hasEncodingProperty(r,ir.AUTOCOUNT))return!1;if(n.constraintManuallySpecifiedValue)return!1}}}}return!0}},{name:"omitRawDetail",description:"Do not use detail channel with raw plot.",properties:[ir.CHANNEL,ir.AGGREGATE,ir.AUTOCOUNT],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n)=>!!e.isAggregate()||xn(e.specQuery.encodings,((t,r)=>!(!so(t)&&!lo(t))||t.channel!==re||!e.wildcardIndex.hasEncodingProperty(r,ir.CHANNEL)&&!n.constraintManuallySpecifiedValue))},{name:"omitRepeatedField",description:"Each field should be mapped to only one channel",properties:[ir.FIELD],allowWildcardForProperties:!0,strict:!1,satisfy:(e,t,n)=>{let r={},i={};const o=e.specQuery.encodings;for(let t=0;t<o.length;t++){const a=o[t];if(so(a)||uo(a))continue;let s;if(a.field&&!kr(a.field)&&(s=a.field),uo(a)&&!kr(a.autoCount)&&(s="count_*"),s){if(e.wildcardIndex.hasEncodingProperty(t,ir.FIELD)&&(i[s]=!0),r[s]&&(i[s]||n.constraintManuallySpecifiedValue))return!1;r[s]=!0}}return!0}},{name:"omitVerticalDotPlot",description:"Do not output vertical dot plot.",properties:[ir.CHANNEL],allowWildcardForProperties:!0,strict:!1,satisfy:(e,t,n)=>{const r=e.getEncodings();return 1!==r.length||r[0].channel!==L}},{name:"hasAppropriateGraphicTypeForMark",description:"Has appropriate graphic type for mark",properties:[ir.CHANNEL,ir.MARK,ir.TYPE,ir.TIMEUNIT,ir.BIN,ir.AGGREGATE,ir.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n)=>{const r=e.getMark();switch(r){case ar:case cr:if(e.isAggregate()){const t=e.getEncodingQueryByChannel(F),n=e.getEncodingQueryByChannel(L),r=vo(t),i=vo(n);return t&&n&&r!==i&&!(co(t)&&!r&&On(["nominal","key"],t.type))&&!(co(n)&&!i&&On(["nominal","key"],n.type))}return!0;case fr:return!0;case sr:case hr:if(e.channelEncodingField(V))return!1;{const t=e.getEncodingQueryByChannel(F),n=e.getEncodingQueryByChannel(L);return vo(t)!==vo(n)}case lr:const t=e.getEncodingQueryByChannel(F),n=e.getEncodingQueryByChannel(L),r=Eo(t),i=Eo(n),o=e.getEncodingQueryByChannel(G),a=vo(o),s=!!co(o)&&o.type===zt;return(r&&i||r&&!e.channelUsed(L)||i&&!e.channelUsed(F))&&(!o||o&&(a||s));case pr:case ur:case gr:case dr:return!0}throw new Error("hasAllRequiredChannelsForMark not implemented for mark"+r)}},{name:"omitInvalidStackSpec",description:"If stack is specified, must follow Vega-Lite stack rules",properties:[ir.STACK,ir.FIELD,ir.CHANNEL,ir.MARK,ir.AGGREGATE,ir.AUTOCOUNT,ir.SCALE,er("scale","type"),ir.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n)=>{if(!e.wildcardIndex.hasProperty(ir.STACK))return!0;const r=e.getVlStack();return(null!==r||null===e.getStackOffset())&&r.fieldChannel===e.getStackChannel()}},{name:"omitNonSumStack",description:"Stack specifications that use non-summative aggregates should be omitted (even implicit ones)",properties:[ir.CHANNEL,ir.MARK,ir.AGGREGATE,ir.AUTOCOUNT,ir.SCALE,er("scale","type"),ir.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n)=>{const r=e.getVlStack();if(null!=r){const t=e.getEncodingQueryByChannel(r.fieldChannel);if(!On(ai,t.aggregate))return!1}return!0}},{name:"omitTableWithOcclusionIfAutoAddCount",description:"Plots without aggregation or autocount where x and y are both discrete should be omitted if autoAddCount is enabled as they often lead to occlusion",properties:[ir.CHANNEL,ir.TYPE,ir.TIMEUNIT,ir.BIN,ir.AGGREGATE,ir.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n)=>{if(n.autoAddCount){const t=e.getEncodingQueryByChannel("x"),n=e.getEncodingQueryByChannel("y");if((!co(t)||Eo(t))&&(!co(n)||Eo(n)))return!!e.isAggregate()&&xn(e.getEncodings(),(e=>{let t=e.channel;return!(t!==F&&t!==L&&t!==R&&t!==k&&co(e)&&!e.aggregate)}))}return!0}}].map((e=>new Sa(e))),Na=Ca.reduce(((e,t)=>(e[t.name()]=t,e)),{}),Oa=Ca.reduce(((e,t)=>{for(const n of t.properties())e.set(n,e.get(n)||[]),e.get(n).push(t);return e}),new Oi);function xa(e,t,n,r,i){const o=Oa.get(e)||[];for(const e of o)if((e.strict()||i[e.name()])&&!e.satisfy(n,r,i)){let r="(spec) "+e.name();return i.verbose&&console.log(r+" failed with "+n.toShorthand()+" for "+t.name),r}return null}var Ia=Object.freeze({SpecConstraintModel:Sa,SPEC_CONSTRAINTS:Ca,SPEC_CONSTRAINT_INDEX:Na,checkSpec:xa}),Ua=Object.freeze({encoding:Ta,spec:Ia});const Ma=new Oi;function _a(e){return Ma.get(e)}function Pa(e){return(t,n,r)=>(i,o)=>{const a=t.encodingIndicesByProperty.get(e);function s(c){if(c===a.length)return void i.push(o.duplicate());const u=a[c],l=t.encodings[u].get(e),d=o.getEncodingQueryByIndex(u),f=o.getEncodingProperty(u,e);so(d)||lo(d)||!f?s(c+1):(l.enum.forEach((t=>{null===t&&(t=void 0),o.setEncodingProperty(u,e,t,l),wa(e,l,u,o,n,r)||xa(e,l,o,n,r)||s(c+1)})),o.resetEncodingProperty(u,e,l))}return s(0),i}}Ma.set("mark",((e,t,n)=>(r,i)=>(i.getMark().enum.forEach((o=>{i.setMark(o),xa("mark",e.mark,i,t,n)||r.push(i.duplicate())})),i.resetMark(),r))),Fn.forEach((e=>{Ma.set(e,Pa(e))})),Qn.forEach((e=>{Ma.set(e,Pa(e))}));var Ra=Object.freeze({getEnumerator:_a,EncodingPropertyGeneratorFactory:Pa});const ka={"*":""},Da={x:"xy",y:"xy"},Fa={row:"facet",column:"facet"},La={color:"style",opacity:"style",shape:"style",size:"style"};function Ba(e){return An(e)&&!!e.property}function $a(e,t,n){return t=t||new Oi,n=n||new Oi,e.forEach((e=>{Ba(e)?(t.setByKey(e.property,!0),n.setByKey(e.property,e.replace)):t.setByKey(e,!0)})),{include:t,replaceIndex:n,replacer:Hi(n)}}function Ya(e){return vn(e)?e.map((e=>{if(Ba(e)){if(e.replace){let t=bn(e.replace).reduce(((t,n)=>{const r=e.replace[n];return(t[r]=t[r]||[]).push(n),t}),{});return e.property+"["+bn(t).map((e=>t[e].sort().join(",")+"=>"+e)).join(";")+"]"}return e.property}return e})).join(","):e}const Wa=[ir.FIELD,ir.TYPE,ir.AGGREGATE,ir.BIN,ir.TIMEUNIT,ir.STACK],ja=Wa.concat([{property:ir.CHANNEL,replace:{x:"xy",y:"xy",color:"style",size:"style",shape:"style",opacity:"style",row:"facet",column:"facet"}}]);var Ha=Object.freeze({REPLACE_BLANK_FIELDS:ka,REPLACE_XY_CHANNELS:Da,REPLACE_FACET_CHANNELS:Fa,REPLACE_MARK_STYLE_CHANNELS:La,isExtendedGroupBy:Ba,parseGroupBy:$a,toString:Ya,GROUP_BY_FIELD_TRANSFORM:Wa,GROUP_BY_ENCODING:ja});let Ga={};function za(e,t){Ga[e]=t}const qa="field",Qa="fieldTransform",Va="encoding",Ka="spec";function Ja(e,t){if(t){const n={name:"",path:"",items:[]};let r={},i=[],o=[],a=[];for(let e=0;e<t.length;e++){i.push(e>0?i[e-1].duplicate():new Oi),o.push(e>0?o[e-1].duplicate():new Oi);const n=t[e].groupBy;if(vn(n)){let t=$a(n,i[e],o[e]);a.push(t.replacer)}}return e.forEach((e=>{let o="",s=n;for(let n=0;n<t.length;n++){const c=s.groupBy=t[n].groupBy;s.orderGroupBy=t[n].orderGroupBy;const u=vn(c)?Xi(e.specQuery,i[n],a[n]):Ga[c](e.specQuery);o+="/"+u,r[o]||(r[o]={name:u,path:o,items:[]},s.items.push(r[o])),s=r[o]}s.items.push(e)})),n}return{name:"",path:"",items:e}}const Xa=$a([ir.FIELD]);function Za(e,t){return Ga[t](e)}za(qa,(e=>Xi(e,Xa.include,Xa.replacer)));const es=$a(Wa);za(Qa,(e=>Xi(e,es.include,es.replacer)));const ts=$a(ja);za(Va,(e=>Xi(e,ts.include,ts.replacer))),za(Ka,(e=>JSON.stringify(e)));var ns=Object.freeze({registerKeyFn:za,FIELD:qa,FIELD_TRANSFORM:Qa,ENCODING:Va,SPEC:Ka,nest:Ja,getGroupByKey:Za,PARSED_GROUP_BY_FIELD_TRANSFORM:es,PARSED_GROUP_BY_ENCODING:ts});class rs{constructor(){this._mark=void 0,this._encodings={},this._encodingIndicesByProperty=new Oi}setEncodingProperty(e,t,n){const r=this._encodings;(r[e]=r[e]||new Oi).set(t,n);const i=this._encodingIndicesByProperty;return i.set(t,i.get(t)||[]),i.get(t).push(e),this}hasEncodingProperty(e,t){return!!this._encodings[e]&&this._encodings[e].has(t)}hasProperty(e){if(tr(e))return this.encodingIndicesByProperty.has(e);if("mark"===e)return!!this.mark;throw new Error("Unimplemented for property "+e)}isEmpty(){return!this.mark&&0===this.encodingIndicesByProperty.size()}setMark(e){return this._mark=e,this}get mark(){return this._mark}get encodings(){return this._encodings}get encodingIndicesByProperty(){return this._encodingIndicesByProperty}}class is{constructor(e,t,n,r,i){this._rankingScore={},this._spec=e,this._channelFieldCount=e.encodings.reduce(((e,t)=>(kr(t.channel)||uo(t)&&!1===t.autoCount||(e[t.channel+""]=1),e)),{}),this._wildcardIndex=t,this._assignedWildcardIndex=i,this._opt=r,this._schema=n}static build(e,t,n){let r=new rs;if(kr(e.mark)){const t=Yr(ir.MARK);e.mark=Lr(e.mark,t,n.enum.mark),r.setMark(e.mark)}if(e.encodings.forEach(((e,i)=>{uo(e)&&(console.warn("A field with autoCount should not be included as autoCount meant to be an internal object."),e.type=Gt),co(e)&&void 0===e.type&&(e.type=Rr),Fn.forEach((o=>{if(kr(e[o])){const a=Yr(o)+i,s=Vr(o,t,n),c=e[o]=Lr(e[o],a,s);r.setEncodingProperty(i,o,c)}})),Qn.forEach((o=>{const a=e[o.parent];if(a){const e=o.child;if(kr(a[e])){const s=Yr(o)+i,c=Vr(o,t,n),u=a[e]=Lr(a[e],s,c);r.setEncodingProperty(i,o,u)}}}))})),n.autoAddCount){const i={name:Yr(ir.CHANNEL)+e.encodings.length,enum:Vr(ir.CHANNEL,t,n)},o={name:Yr(ir.AUTOCOUNT)+e.encodings.length,enum:[!1,!0]},a={channel:i,autoCount:o,type:Gt};e.encodings.push(a);const s=e.encodings.length-1;r.setEncodingProperty(s,ir.CHANNEL,i),r.setEncodingProperty(s,ir.AUTOCOUNT,o)}return new is(e,r,t,n,{})}get wildcardIndex(){return this._wildcardIndex}get schema(){return this._schema}get specQuery(){return this._spec}duplicate(){return new is(wn(this._spec),this._wildcardIndex,this._schema,this._opt,wn(this._assignedWildcardIndex))}setMark(e){const t=this._wildcardIndex.mark.name;this._assignedWildcardIndex[t]=this._spec.mark=e}resetMark(){const e=this._spec.mark=this._wildcardIndex.mark;delete this._assignedWildcardIndex[e.name]}getMark(){return this._spec.mark}getEncodingProperty(e,t){const n=this._spec.encodings[e];return kn(t)?n[t.parent][t.child]:n[t]}setEncodingProperty(e,t,n,r){const i=this._spec.encodings[e];t===ir.CHANNEL&&i.channel&&!kr(i.channel)&&this._channelFieldCount[i.channel]--,kn(t)?i[t.parent][t.child]=n:$n(t)&&!0===n?i[t]=Tn({},i[t],{enum:void 0,name:void 0}):i[t]=n,this._assignedWildcardIndex[r.name]=n,t===ir.CHANNEL&&(this._channelFieldCount[n]=(this._channelFieldCount[n]||0)+1)}resetEncodingProperty(e,t,n){const r=this._spec.encodings[e];t===ir.CHANNEL&&this._channelFieldCount[r.channel]--,kn(t)?r[t.parent][t.child]=n:r[t]=n,delete this._assignedWildcardIndex[n.name]}channelUsed(e){return this._channelFieldCount[e]>0}channelEncodingField(e){return co(this.getEncodingQueryByChannel(e))}getEncodings(){return this._spec.encodings.filter((e=>!lo(e)))}getEncodingQueryByChannel(e){for(let t of this._spec.encodings)if(t.channel===e)return t}getEncodingQueryByIndex(e){return this._spec.encodings[e]}isAggregate(){return Di(this._spec)}getVlStack(){return Fi(this._spec)}getStackOffset(){return Li(this._spec)}getStackChannel(){return Bi(this._spec)}toShorthand(e){if(e){if(Nn(e))return Za(this.specQuery,e);const t=$a(e);return Xi(this._spec,t.include,t.replacer)}return Xi(this._spec)}toSpec(e){if(kr(this._spec.mark))return null;let t={};return(e=e||this._spec.data)&&(t.data=e),this._spec.transform&&(t.transform=this._spec.transform),t.mark=this._spec.mark,t.encoding=po(this.specQuery.encodings,{schema:this._schema,wildcardMode:"null"}),this._spec.width&&(t.width=this._spec.width),this._spec.height&&(t.height=this._spec.height),this._spec.background&&(t.background=this._spec.background),this._spec.padding&&(t.padding=this._spec.padding),this._spec.title&&(t.title=this._spec.title),null===t.encoding?null:((this._spec.config||this._opt.defaultSpecConfig)&&(t.config=Tn({},this._opt.defaultSpecConfig,this._spec.config)),t)}getRankingScore(e){return this._rankingScore[e]}setRankingScore(e,t){this._rankingScore[e]=t}}var os=Object.freeze({SpecQueryModel:is}),as=Object.freeze({});function ss(e){if(e.groupBy){let t={groupBy:e.groupBy};e.orderBy&&(t.orderGroupBy=e.orderBy);let n={spec:wn(e.spec),nest:[t]};return e.chooseBy&&(n.chooseBy=e.chooseBy),e.config&&(n.config=e.config),n}return wn(e)}var cs=Object.freeze({encoding:wo,groupBy:Ha,shorthand:ao,spec:ji,transform:as,normalize:ss});function us(e){return void 0!==e.items}function ls(e){let t=e.items[0];for(;t&&us(t);)t=t.items[0];return t}function ds(e,t){return Object.assign({},e,{items:e.items.map((e=>us(e)?ds(e,t):t(e)))})}var fs,hs=Object.freeze({isResultTree:us,getTopResultTreeItem:ls,mapLeaves:ds});class ps{constructor(e){this.type=e,this.scoreIndex=this.initScore()}getFeatureScore(e){const t=this.type,n=this.scoreIndex[e];if(void 0!==n)return{type:t,feature:e,score:n}}}!function(e){e[e.Q=Gt]="Q",e[e.BIN_Q="bin_"+Gt]="BIN_Q",e[e.T=qt]="T",e[e.TIMEUNIT_T="timeUnit_time"]="TIMEUNIT_T",e[e.TIMEUNIT_O="timeUnit_"+zt]="TIMEUNIT_O",e[e.O=zt]="O",e[e.N=Qt]="N",e[e.K=Ci.KEY]="K",e[e.NONE="-"]="NONE"}(fs||(fs={}));const gs=fs.Q,ms=fs.BIN_Q,ys=fs.T,vs=fs.TIMEUNIT_T,Es=fs.TIMEUNIT_O,bs=fs.O,ws=fs.N,Ts=fs.K,As=fs.NONE;function Ss(e){return e.bin?fs.BIN_Q:e.timeUnit?on(bo(e))?fs.TIMEUNIT_O:fs.TIMEUNIT_T:e.type}class Cs extends ps{constructor(){super("Axis")}initScore(e={}){e=Object.assign({},Jr,e);let t={};return[{feature:ms,opt:"preferredBinAxis"},{feature:ys,opt:"preferredTemporalAxis"},{feature:vs,opt:"preferredTemporalAxis"},{feature:Es,opt:"preferredTemporalAxis"},{feature:bs,opt:"preferredOrdinalAxis"},{feature:ws,opt:"preferredNominalAxis"}].forEach((n=>{e[n.opt]===F?t[n.feature+"_"+L]=-.01:e[n.opt]===L&&(t[n.feature+"_"+F]=-.01)})),t}featurize(e,t){return e+"_"+t}getScore(e,t,n){return e.getEncodings().reduce(((e,t)=>{if(co(t)||uo(t)){const n=Ss(t),r=this.featurize(n,t.channel),i=this.getFeatureScore(r);i&&e.push(i)}return e}),[])}}class Ns extends ps{constructor(){super("Dimension")}initScore(){return{row:-2,column:-2,color:0,opacity:0,size:0,shape:0}}getScore(e,t,n){return e.isAggregate()&&e.getEncodings().reduce(((e,t)=>{if(uo(t)||co(t)&&!t.aggregate){const n=this.getFeatureScore(t.channel+"");if(n&&n.score>e.score)return n}return e}),{type:"Dimension",feature:"No Dimension",score:-5}),[]}}class Os extends ps{constructor(){super("Facet")}initScore(e){let t={};return(e=Object.assign({},Jr,e)).preferredFacet===R?t[k]=-.01:e.preferredFacet===k&&(t[R]=-.01),t}getScore(e,t,n){return e.getEncodings().reduce(((e,t)=>{if(co(t)||uo(t)){const n=this.getFeatureScore(t.channel);n&&e.push(n)}return e}),[])}}class xs extends ps{constructor(){super("SizeChannel")}initScore(){return{bar_size:-2,tick_size:-2}}getScore(e,t,n){const r=e.getMark();return e.getEncodings().reduce(((e,t)=>{if(co(t)||uo(t)){const n=r+"_"+t.channel,i=this.getFeatureScore(n);i&&e.push(i)}return e}),[])}}const Is=-10;class Us extends ps{constructor(){super("TypeChannel")}initScore(){let e={};const t={x:0,y:0,size:-.575,color:-.725,text:-2,opacity:-3,shape:Is,row:Is,column:Is,detail:2*Is};[gs,ys,vs].forEach((n=>{bn(t).forEach((r=>{e[this.featurize(n,r)]=t[r]}))}));const n=Tn({},t,{row:-.75,column:-.75,shape:-3.1,text:-3.2,detail:-4});[ms,Es,bs].forEach((t=>{bn(n).forEach((r=>{e[this.featurize(t,r)]=n[r]}))}));const r={x:0,y:0,color:-.6,shape:-.65,row:-.7,column:-.7,text:-.8,detail:-2,size:-3,opacity:-3.1};return bn(r).forEach((t=>{e[this.featurize(ws,t)]=r[t],e[this.featurize(Ts,t)]=On(["x","y","detail"],t)?-1:r[t]-2})),e}featurize(e,t){return e+"_"+t}getScore(e,t,n){const r=e.getEncodings().reduce(((e,t)=>{if(co(t)||uo(t)){const n=eo(t);(e[n]=e[n]||[]).push(t)}return e}),{}),i=[];return In(r,(e=>{const t=e.reduce(((e,t)=>{if(co(t)||uo(t)){const n=Ss(t),r=this.featurize(n,t.channel),i=this.getFeatureScore(r);if(null===e||i.score>e.score)return i}return e}),null);i.push(t)})),i}}class Ms extends ps{constructor(){super("Mark")}initScore(){return Ps()}getScore(e,t,n){let r=e.getMark();r!==pr&&r!==gr||(r=ur);const i=e.getEncodingQueryByChannel(F),o=i?Ss(i):As,a=e.getEncodingQueryByChannel(L),s=o+"_"+(a?Ss(a):As)+"_"+!e.isAggregate()+"_"+r,c=this.getFeatureScore(s);return c?[c]:(console.error("feature score missing for",s),[])}}function _s(e,t,n,r){return e+"_"+t+"_"+n+"_"+r}function Ps(){const e=[gs,ys],t=[ms,Es,bs,ws,Ts].concat([As]);let n={};e.forEach((t=>{e.forEach((e=>{In({point:0,text:-.2,tick:-.5,rect:-1,bar:-2,line:-2,area:-2,rule:-2.5},((r,i)=>{const o=_s(t,e,!0,i);n[o]=r})),In({point:0,text:-.2,tick:-.5,bar:-2,line:-2,area:-2,rule:-2.5},((r,i)=>{const o=_s(t,e,!1,i);n[o]=r}))}))})),e.forEach((e=>{t.forEach((t=>{In({tick:0,point:-.2,text:-.5,bar:-2,line:-2,area:-2,rule:-2.5},((r,i)=>{const o=_s(e,t,!0,i);n[o]=r;const a=_s(t,e,!0,i);n[a]=r}))})),[vs].forEach((t=>{In({point:0,text:-.5,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5},((r,i)=>{const o=_s(e,t,!0,i);n[o]=r;const a=_s(t,e,!0,i);n[a]=r}))})),[As,ws,bs,Ts].forEach((t=>{In({bar:0,point:-.2,tick:-.25,text:-.3,line:-2,area:-2,rule:-2.5},((r,i)=>{const o=_s(e,t,!1,i);n[o]=r;const a=_s(t,e,!1,i);n[a]=r}))})),[ms].forEach((t=>{In({bar:0,point:-.2,tick:-.25,text:-.3,line:-.5,area:-.5,rule:-2.5},((r,i)=>{const o=_s(e,t,!1,i);n[o]=r;const a=_s(t,e,!1,i);n[a]=r}))})),[vs,Es].forEach((t=>{In({line:0,area:-.1,bar:-.2,point:-.3,tick:-.35,text:-.4,rule:-2.5},((r,i)=>{const o=_s(e,t,!1,i);n[o]=r;const a=_s(t,e,!1,i);n[a]=r}))}))})),[vs].forEach((e=>{[vs].forEach((t=>{const r={point:0,rect:-.1,text:-.5,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};In(r,((r,i)=>{const o=_s(e,t,!0,i);n[o]=r})),In(r,((r,i)=>{const o=_s(e,t,!1,i);n[o]=r}))})),t.forEach((t=>{const r={tick:0,point:-.2,text:-.5,rect:-1,bar:-2,line:-2,area:-2,rule:-2.5};In(r,((r,i)=>{const o=_s(e,t,!0,i);n[o]=r})),In(r,((r,i)=>{const o=_s(t,e,!0,i);n[o]=r})),In(r,((r,i)=>{const o=_s(e,t,!1,i);n[o]=r})),In(r,((r,i)=>{const o=_s(t,e,!1,i);n[o]=r}))}))}));for(const e of t)for(const r of t){const t={point:0,rect:0,text:-.1,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};In(t,((t,i)=>{const o=_s(e,r,!0,i);n[o]=t})),In(t,((t,i)=>{const o=_s(e,r,!1,i);n[o]=t}))}return n}const Rs=[new Cs,new Ns,new Os,new Ms,new xs,new Us];function ks(e,t,n){const r=Rs.reduce(((r,i)=>{const o=i.getScore(e,t,n);return r.concat(o)}),[]);return{score:r.reduce(((e,t)=>e+t.score),0),features:r}}const Ds="aggregationQuality";function Fs(e,t,n){const r=Ls(e);return{score:r.score,features:[r]}}function Ls(e,t,n){const r=e.getEncodings();if(e.isAggregate()){if(Un(r,(e=>co(e)&&(e.type===Gt&&!e.bin&&!e.aggregate||e.type===qt&&!e.timeUnit))))return{type:Ds,score:.1,feature:"Aggregate with raw continuous"};if(Un(r,(e=>co(e)&&Eo(e)))){let e=Un(r,(e=>co(e)&&"count"===e.aggregate||fo(e))),t=Un(r,(e=>co(e)&&!!e.bin));return e?{type:Ds,score:.8,feature:"Aggregate with count"}:t?{type:Ds,score:.7,feature:"Aggregate with bin but without count"}:{type:Ds,score:.9,feature:"Aggregate without count and without bin"}}return{type:Ds,score:.3,feature:"Aggregate without dimension"}}return Un(r,(e=>co(e)&&!Eo(e)))?{type:Ds,score:1,feature:"Raw with measure"}:{type:Ds,score:.2,feature:"Raw without measure"}}var Bs=Object.freeze({name:Ds,score:Fs});const $s="fieldOrder";function Ys(e,t,n){const r=e.wildcardIndex.encodingIndicesByProperty.get("field");if(!r)return{score:0,features:[]};const i=e.specQuery.encodings,o=t.fieldSchemas.length,a=[];let s=0,c=1;for(let n=r.length-1;n>=0;n--){const u=r[n],l=i[u];let d;if(!co(l))continue;d=l.field;const f=e.wildcardIndex.encodings[u].get("field"),h=t.fieldSchema(d).index,p=-h*c;s+=p,a.push({score:p,type:"fieldOrder",feature:`field ${f.name} is ${d} (#${h} in the schema)`}),c*=o}return{score:s,features:a}}var Ws=Object.freeze({name:$s,score:Ys});let js={};function Hs(e,t){js[e]=t}function Gs(e){return js[e]}function zs(e,t,n,r){return t.nest&&r!==t.nest.length?(e.items.forEach((e=>{zs(e,t,n,r+1)})),t.nest[r].orderGroupBy&&e.items.sort(Qs(t.nest[r].orderGroupBy,n,t.config))):(t.orderBy||t.chooseBy)&&(e.items.sort(qs(t.orderBy||t.chooseBy,n,t.config)),t.chooseBy&&e.items.length>0&&e.items.splice(1)),e}function qs(e,t,n){return(r,i)=>Vs(e instanceof Array?e:[e],r,i,t,n)}function Qs(e,t,n){return(r,i)=>{const o=ls(r),a=ls(i);return Vs(e instanceof Array?e:[e],o,a,t,n)}}function Vs(e,t,n,r,i){for(let o of e){let e=Ks(n,o,r,i).score-Ks(t,o,r,i).score;if(0!==e)return e}return 0}function Ks(e,t,n,r){if(void 0!==e.getRankingScore(t))return e.getRankingScore(t);const i=Gs(t)(e,n,r);return e.setRankingScore(t,i),i}const Js="effectiveness";Hs(Js,ks),Hs(Ds,Fs),Hs($s,Ys);var Xs=Object.freeze({aggregation:Bs,fieldOrder:Ws,register:Hs,get:Gs,rank:zs,comparatorFactory:qs,groupComparatorFactory:Qs,getScore:Ks,EFFECTIVENESS:Js,effectiveness:ks});function Zs(e,t,n){let r={};return e=e.map((function(e){return n.smallRangeStepForHighCardinalityOrFacet&&(e=ec(e,t,r,n)),n.nominalColorScaleForHighCardinality&&(e=tc(e,t,r,n)),n.xAxisOnTopForHighYCardinalityWithoutColumn&&(e=nc(e,t,r,n)),e}))}function ec(e,t,n,r){[R,L,k,F].forEach((t=>{n[t]=e.getEncodingQueryByChannel(t)}));const i=n[L];if(void 0!==i&&co(i)&&(n[R]||t.cardinality(i)>r.smallRangeStepForHighCardinalityOrFacet.maxCardinality)){void 0===i.scale&&(i.scale={});const e=bo(i);i.scale&&(void 0===e||on(e))&&(i.scale.rangeStep||(i.scale.rangeStep=12))}const o=n[F];if(co(o)&&(n[k]||t.cardinality(o)>r.smallRangeStepForHighCardinalityOrFacet.maxCardinality)){void 0===o.scale&&(o.scale={});const e=bo(o);o.scale&&(void 0===e||on(e))&&(o.scale.rangeStep||(o.scale.rangeStep=12))}return e}function tc(e,t,n,r){n[G]=e.getEncodingQueryByChannel(G);const i=n[G];return co(i)&&void 0!==i&&(i.type===Qt||i.type===Ci.KEY)&&t.cardinality(i)>r.nominalColorScaleForHighCardinality.maxCardinality&&(void 0===i.scale&&(i.scale={}),i.scale&&(i.scale.range||(i.scale.scheme=r.nominalColorScaleForHighCardinality.palette))),e}function nc(e,t,n,r){if([k,F,L].forEach((t=>{n[t]=e.getEncodingQueryByChannel(t)})),void 0===n[k]){const e=n[F],i=n[L];co(e)&&co(i)&&void 0!==i&&i.field&&on(bo(i))&&void 0!==e&&t.cardinality(i)>r.xAxisOnTopForHighYCardinalityWithoutColumn.maxCardinality&&(void 0===e.axis&&(e.axis={}),e.axis&&!e.axis.orient&&(e.axis.orient="top"))}return e}function rc(e,t,n=Jr){const r=is.build(e,t,n),i=r.wildcardIndex;let o=[r];return n.propertyPrecedence.forEach((e=>{const r=Xn(e);if(i.hasProperty(r)){const e=_a(r)(i,t,n);o=o.reduce(e,[])}})),!n.stylize||null===n.nominalColorScaleForHighCardinality&&null===n.smallRangeStepForHighCardinalityOrFacet&&null===n.xAxisOnTopForHighYCardinalityWithoutColumn?o:Zs(o,t,n)}function ic(e,t,n){return{query:e=Object.assign({},ss(e),{config:Object.assign({},Jr,n,e.config)}),result:zs(Ja(rc(e.spec,t,e.config),e.nest),e,t,0)}}var oc="0.21.2";e.config=ti,e.constraint=Ua,e.enumerate=Ra,e.generate=rc,e.model=os,e.nest=ns,e.property=or,e.query=cs,e.ranking=Xs,e.recommend=ic,e.result=hs,e.schema=pa,e.util=Rn,e.version=oc,e.wildcard=Kr,Object.defineProperty(e,"__esModule",{value:!0})}(Z.exports);var ee=Z.exports,te=Z.exports.__esModule,ne=Z.exports.config,re=Z.exports.constraint,ie=Z.exports.enumerate,oe=Z.exports.generate,ae=Z.exports.model,se=Z.exports.nest,ce=Z.exports.property,ue=Z.exports.query,le=Z.exports.ranking,de=Z.exports.recommend,fe=Z.exports.result,he=Z.exports.schema,pe=Z.exports.util,ge=Z.exports.version,me=Z.exports.wildcard;export{te as __esModule,ne as config,re as constraint,ee as default,ie as enumerate,oe as generate,ae as model,se as nest,ce as property,ue as query,le as ranking,de as recommend,fe as result,he as schema,pe as util,ge as version,me as wildcard};
