<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Pi 🥮 by lattice | some calculang things</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_import/custom-style.74b84d58.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_import/custom-style.74b84d58.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.css">
<link rel="modulepreload" href="./_observablehq/client.js">
<link rel="modulepreload" href="./_observablehq/runtime.js">
<link rel="modulepreload" href="./_observablehq/stdlib.js">
<link rel="modulepreload" href="./_import/components/scrubber.a7df8a1e.js">
<link rel="modulepreload" href="./_import/graphing-calcs/editor.bundle.b93111cb.js">
<link rel="modulepreload" href="./_import/components/calcuvegadata.42318415.js">
<link rel="modulepreload" href="./_import/components/helpers.114a7fce.js">
<link rel="modulepreload" href="./_import/components/mini-calculang.3e8f8efa.js">
<link rel="modulepreload" href="./_npm/vega-embed@6.24.0/+esm.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/+esm.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.js">
<link rel="modulepreload" href="https://cdn.jsdelivr.net/npm/d3-require/+esm">
<link rel="modulepreload" href="https://cdn.jsdelivr.net/npm/@dagrejs/graphlib/+esm">
<link rel="modulepreload" href="./_npm/object-traversal@1.0.1/+esm.js">
<link rel="modulepreload" href="./_npm/underscore@1.13.6/+esm.js">
<link rel="modulepreload" href="./_npm/d3-require@1.3.0/+esm.js">
<link rel="modulepreload" href="./_npm/compassql@0.21.2/+esm.js">
<link rel="modulepreload" href="./_npm/@dagrejs/graphlib@2.1.13/+esm.js">
<link rel="modulepreload" href="./_npm/lodash@4.17.21/+esm.js">
<link rel="modulepreload" href="./_npm/d3@7.8.5/+esm.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/+esm.js">
<link rel="modulepreload" href="./_npm/fast-json-patch@3.1.1/+esm.js">
<link rel="modulepreload" href="./_npm/json-stringify-pretty-compact@3.0.0/+esm.js">
<link rel="modulepreload" href="./_npm/vega@5.26.1/+esm.js">
<link rel="modulepreload" href="./_npm/vega-interpreter@1.0.5/+esm.js">
<link rel="modulepreload" href="./_npm/vega-lite@5.16.3/+esm.js">
<link rel="modulepreload" href="./_npm/vega-schema-url-parser@2.2.0/+esm.js">
<link rel="modulepreload" href="./_npm/vega-themes@2.14.0/+esm.js">
<link rel="modulepreload" href="./_npm/vega-tooltip@0.34.0/+esm.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/+esm.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/+esm.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/+esm.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/+esm.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/+esm.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/+esm.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/+esm.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/+esm.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/+esm.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/+esm.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/+esm.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/+esm.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/+esm.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/+esm.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.0/+esm.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/+esm.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/+esm.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/+esm.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/+esm.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/+esm.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/+esm.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/+esm.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.0.0/+esm.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/+esm.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/+esm.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/+esm.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/+esm.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/+esm.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/+esm.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/+esm.js">
<link rel="modulepreload" href="./_npm/vega-util@1.17.2/+esm.js">
<link rel="modulepreload" href="./_npm/vega-dataflow@5.7.5/+esm.js">
<link rel="modulepreload" href="./_npm/vega-transforms@4.11.0/+esm.js">
<link rel="modulepreload" href="./_npm/vega-view-transforms@4.5.9/+esm.js">
<link rel="modulepreload" href="./_npm/vega-encode@4.9.2/+esm.js">
<link rel="modulepreload" href="./_npm/vega-geo@4.4.1/+esm.js">
<link rel="modulepreload" href="./_npm/vega-force@4.2.0/+esm.js">
<link rel="modulepreload" href="./_npm/vega-hierarchy@4.1.1/+esm.js">
<link rel="modulepreload" href="./_npm/vega-label@1.2.1/+esm.js">
<link rel="modulepreload" href="./_npm/vega-regression@1.2.0/+esm.js">
<link rel="modulepreload" href="./_npm/vega-voronoi@4.2.2/+esm.js">
<link rel="modulepreload" href="./_npm/vega-wordcloud@4.1.4/+esm.js">
<link rel="modulepreload" href="./_npm/vega-crossfilter@4.1.1/+esm.js">
<link rel="modulepreload" href="./_npm/vega-statistics@1.9.0/+esm.js">
<link rel="modulepreload" href="./_npm/vega-time@2.1.1/+esm.js">
<link rel="modulepreload" href="./_npm/vega-loader@4.5.1/+esm.js">
<link rel="modulepreload" href="./_npm/vega-scenegraph@4.11.1/+esm.js">
<link rel="modulepreload" href="./_npm/vega-scale@7.3.1/+esm.js">
<link rel="modulepreload" href="./_npm/vega-projection@1.6.0/+esm.js">
<link rel="modulepreload" href="./_npm/vega-view@5.11.1/+esm.js">
<link rel="modulepreload" href="./_npm/vega-format@1.1.1/+esm.js">
<link rel="modulepreload" href="./_npm/vega-functions@5.14.0/+esm.js">
<link rel="modulepreload" href="./_npm/vega-parser@6.2.1/+esm.js">
<link rel="modulepreload" href="./_npm/vega-runtime@6.1.4/+esm.js">
<link rel="modulepreload" href="./_npm/vega-expression@5.1.0/+esm.js">
<link rel="modulepreload" href="./_npm/vega-event-selector@3.0.1/+esm.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/+esm.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.0/+esm.js">
<link rel="modulepreload" href="./_npm/vega-scenegraph@4.11.2/+esm.js">
<link rel="modulepreload" href="./_npm/vega-canvas@1.2.7/+esm.js">
<link rel="modulepreload" href="./_npm/topojson-client@3.1.0/+esm.js">
<link rel="modulepreload" href="./_npm/d3-geo-projection@4.0.0/+esm.js">
<link rel="modulepreload" href="./_npm/vega-scenegraph@4.11.0/+esm.js">
<link rel="modulepreload" href="./_npm/vega-selections@5.4.2/+esm.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/+esm.js">
<script type="module">

import {define} from "./_observablehq/client.js";
import {registerFile} from "./_observablehq/stdlib.js";

registerFile("./cul/pi-lattice.cul.js", {"name":"./cul/pi-lattice.cul.js","mimeType":"text/javascript","path":"./_file/cul/pi-lattice.cul.d57b787b.js"});

define({id: "22c64c67", inputs: ["cul_default","Mutable"], outputs: ["Scrubber","editorCm","eslintConfig","calcuvegadata","start_doc","doc","editor"], body: async (cul_default,Mutable) => {
const [{Scrubber}, {editor: editorCm, config: eslintConfig}, {calcuvegadata}] = await Promise.all([import("./_import/components/scrubber.a7df8a1e.js"), import("./_import/graphing-calcs/editor.bundle.b93111cb.js"), import("./_import/components/calcuvegadata.42318415.js")]);




const start_doc = cul_default

const doc = Mutable(start_doc) // I still have doc Input below, remove?

const editor = editorCm({doc: start_doc, update: update => {doc.value = update.state.doc.toString();}})
return {Scrubber,editorCm,eslintConfig,calcuvegadata,start_doc,doc,editor};
}});

define({id: "1a748ae6", inline: true, inputs: ["display","editor"], body: (display,editor) => {
display(editor.dom)
}});

define({id: "a91751cf", inline: true, inputs: ["view","Inputs","esm"], body: (view,Inputs,esm) => {
view(Inputs.textarea({value:esm.code, rows:60, resize: true, disabled:true}))
}});

define({id: "7be5e906", inline: true, inputs: ["display"], body: async (display) => {
display(await(
"todo"
))
}});

define({id: "bd87104d", inline: true, inputs: ["display","introspection"], body: (display,introspection) => {
display(Object.keys(introspection))
}});

define({id: "8094d046", inline: true, inputs: ["display","introspection"], body: (display,introspection) => {
display(JSON.stringify([...introspection.cul_links]))
}});

define({id: "39aaa5c2", inline: true, inputs: ["view","Inputs","Scrubber","_","n_in_Input"], body: (view,Inputs,Scrubber,_,n_in_Input) => {
view(Inputs.bind(Scrubber(_.range(2,76), {value: 10, delay: 1000/10, autoplay: false, alternate:false, loop:false,/*format:d => d3.format('.2f')(d)*/}), n_in_Input))
}});

define({id: "79eba418", inline: true, inputs: ["model","n_in","display"], body: async (model,n_in,display) => {
display(await(
model.proportion_inside({n_in}).toFixed(5)
))
}});

define({id: "490c4272", inline: true, inputs: ["model","n_in","display"], body: async (model,n_in,display) => {
display(await(
model.pi_approximation({n_in}).toFixed(5)
))
}});

define({id: "632312b7", inline: true, inputs: ["model","n_in","display"], body: async (model,n_in,display) => {
display(await(
model.error({n_in}).toFixed(5)
))
}});

define({id: "e0d3da90", inputs: ["model","display","Inputs","d3"], outputs: ["pis"], body: (model,display,Inputs,d3) => {
const pis = [5, 10, 20,30,50,55,60,65,70,75]
  .map(n_in => ({n_in, pi_approximation: model.pi_approximation({ n_in}), error: model.error({ n_in})}))

display(Inputs.table(pis, {sort: 'n_in', reverse: true, format: { pi_approximation: d3.format(',.10f'), error: d3.format(',.4f') }}))
return {pis};
}});

define({id: "5752734d", inputs: ["rhs_width","embed"], outputs: ["spec","viz"], body: (rhs_width,embed) => {
const spec = ({
  // vega-lite
  title: "points",
  mark: {type:'point', tooltip:true, filled:true},
  encoding: {
    x: { field: 'x', type: 'quantitative', scale: { domain: [0,1]} },
    y: { field: 'y', type: 'quantitative', scale: { domain: [0,1]}  },
    color: {field: 'inside', type: 'nominal', sort: 'descending'},
    detail: {field: 'i_in', type: 'nominal'},
  },
  data: { name: "data" },
  autosize: { "type": "fit", "contains": "padding"},
  width: Math.min(500,rhs_width-30),//Math.min(400,rhs_width),
  height: Math.min(500,rhs_width-30)/1.2,//Math.min(400,rhs_width-30),
  background:'rgba(0,0,0,0)'
})

// interactivity via vega signals and listeners
const viz = embed('#viz', spec)
return {spec,viz};
}});

define({id: "75d08f24", inputs: ["calcuvegadata","model","spec","_","n_in"], outputs: ["data_source"], body: (calcuvegadata,model,spec,_,n_in) => {
const data_source = calcuvegadata({
  models: [model],
  spec,
  domains: {
    i_in: _.range(0,n_in*n_in)
  },
  input_cursors: [
    { n_in }
  ]
})
return {data_source};
}});

define({id: "7087a911", inputs: ["viz","data_source"], body: (viz,data_source) => {
viz.view.data("data", data_source)/*.resize()*/.run(); // turn off resize
}});

define({id: "eb13376e", inputs: ["compileWithMemo","doc","introspection2","invalidation"], outputs: ["esm","introspection","inputs","formulae_not_inputs","u","model"], body: async (compileWithMemo,doc,introspection2,invalidation) => {
const esm = compileWithMemo(doc)
const introspection = introspection2(doc)
//display(introspection.cul_input_map) todo put under devtools
//display(introspection)

const inputs = [...introspection.cul_functions.values()].filter(d => d.reason == 'input definition').map(d => d.name).sort()

//display(Object.values(introspection.cul_functions))
//display([...introspection.cul_functions.values()])

const formulae_not_inputs = [...introspection.cul_functions.values()].filter(d => d.reason == 'definition' && inputs.indexOf(d.name+'_in') == -1).map(d => d.name)
//display(formulae_not_inputs)


const u = URL.createObjectURL(new Blob([esm.code], { type: "text/javascript" }))
console.log(`creating ${u}`)

const model = await import(u)

//display(model)

invalidation.then(() => {console.log(`revoking ${u}`); URL.revokeObjectURL(u)});

return {esm,introspection,inputs,formulae_not_inputs,u,model};
}});

define({id: "263dff7b", outputs: ["FileAttachment","cul_default","calcuvizspec","compile","introspection2","compileWithMemo"], body: async () => {
const [{FileAttachment}, {calcuvizspec}, {compile, introspection2, compileWithMemo}] = await Promise.all([import("./_observablehq/stdlib.js"), import("./_import/components/helpers.114a7fce.js"), import("./_import/components/mini-calculang.3e8f8efa.js")]);

const cul_default = await FileAttachment('./cul/pi-lattice.cul.js').text()



return {FileAttachment,cul_default,calcuvizspec,compile,introspection2,compileWithMemo};
}});

define({id: "6a6f8c5a", inputs: ["Inputs","Generators","cul_default"], outputs: ["embed","n_in_Input","n_in","rhs_width","cul_Input","cul"], body: async (Inputs,Generators,cul_default) => {
const {default: embed} = await import("./_npm/vega-embed@6.24.0/+esm.js");

const n_in_Input = Inputs.input(2);
const n_in = Generators.input(n_in_Input);

const rhs_width = Generators.width(document.querySelector(".rhs")); // keep as a generator for reactivity


// circular definition if I use cul_default ?!
const cul_Input = Inputs.input(cul_default);
const cul = Generators.input(cul_Input);

return {embed,n_in_Input,n_in,rhs_width,cul_Input,cul};
}});

</script>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="./">some calculang things</a></li>
  </ol>
  <ol>
    <li class="observablehq-link"><a href="./keep-car-cli">Keep 🚗 on the road</a></li>
    <li class="observablehq-link observablehq-link-active"><a href="./pi-lattice">Pi 🥮 by lattice</a></li>
    <li class="observablehq-link"><a href="./tixyish">tixy-ish 🎨</a></li>
    <li class="observablehq-link"><a href="./dungeon/dungeon">Dungeon Generator 👹👾🔫</a></li>
    <li class="observablehq-link"><a href="./graphing-calcs/graphing-edit-cm-gol-sand">Falling Sand (early)</a></li>
    <li class="observablehq-link"><a href="./graphing-calcs/graphing-edit-cm-gol">Editable Game of Life</a></li>
    <li class="observablehq-link"><a href="./graphing-calcs/graphing-edit-cm">Editable ❤️ CM (preview)</a></li>
    <li class="observablehq-link"><a href="./graphing-calcs/graphing-edit-music">Editable Music 🎶 (beta)</a></li>
    <li class="observablehq-link"><a href="./shader/shader">Editable Shader 🧊</a></li>
  </ol>
</nav>
<script>{Object.assign(document.createElement("a"),{href:""}).password&&location.replace(location.href);const e=document.querySelector("#observablehq-sidebar"),o=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?o.checked=r==="true":o.indeterminate=!0;for(const t of document.querySelectorAll("#observablehq-sidebar summary")){const s=t.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${t.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<div id="cell-22c64c67" class="observablehq observablehq--block"></div>
<div class="wrapper">
  <div class="lhs" style="background: lightgreen">
    <div class="grow">
    <h1>ƒ</h1>
    <!-- can I collapse things responsively? -->
    <details class="calculang"><summary class="calculang" style="margin-bottom:10px">calculang ✍️</summary>
    <span style="font-style: italic">editable and dangerous!</span> 🧙‍♂️⚠️
    <span id="cell-1a748ae6" class="observablehq--loading"></span>
    <details><summary>javascript ✨</summary>
    <span style="font-style: italic">generated from calculang</span> ⬆️
    <span id="cell-a91751cf" class="observablehq--loading"></span>
    </details>
    <details><summary>dev tools 🧰</summary>
    <span id="cell-7be5e906" class="observablehq--loading"></span>
    <span id="cell-bd87104d" class="observablehq--loading"></span>
    <span id="cell-8094d046" class="observablehq--loading"></span>
    </details>
    </details>
    </div>
  </div>
  <div class="rhs" style="background: pink">
    <h1>🎨 Pi 🥮 by lattice</h1>
    <div class="card">
    <details open=""><summary>inputs ⚙️</summary>
    <span id="cell-39aaa5c2" class="observablehq--loading"></span>
    </details>
    </div>
  <span>Press <strong>play</strong> for an improving approximation of <strong>π</strong> based on approximating the area of a unit circle using a lattice!</span>
  <details style="background:lightgreen; padding: 0.5rem; margin: 0.5rem; border: 1px solid blue"><summary style="font-weight:bold">calculang 🔍💬🧮</summary>
  <span>This pi approximation is made with <a href="https://calculang.dev">calculang</a><a>, <span style="font-weight:bold">a language for calculations for transparency and certainty about numbers</span> 🔍💬🧮<br>
  <p>On left/top, you can find and edit the formulas (but this is WIP and very dangerous).
  </p></a><p><a>Better to find the source code </a><a href="https://github.com/declann/calculang-develop-with-framework/">on GitHub</a> and PRs are welcome.</p>
  </span></details>
  <details style="padding: 0.5rem; margin: 0.5rem"><summary style="">inspiration 🧙</summary><p><a href="https://www.geogebra.org/m/kwty4hsz">A Geogebra example</a> I found linked in the <a href="https://www.geogebra.org/u/kmhkmh">wikipedia article for Pi</a>. I replicate this approach/numbers.</p>
  <p>Given this is similar but simpler than the <a href="https://observablehq.com/@declann/monte-carlo-pi?collection=@declann/calculang">Monte Carlo Pi</a> approximation I reproduced last year, I'm not sure why this approach isn't more common.</p>
  </details>

<span>Calculated area inside unit circle = <span id="cell-79eba418" class="observablehq--loading"></span> units squared; *4 ⇒</span>
<h3>π ≈ <span id="cell-490c4272" class="observablehq--loading"></span></h3>
<span>⇒ error <span style="font-weight:bold;color:red"><span id="cell-632312b7" class="observablehq--loading"></span></span></span>
  <div class="card" id="viz"></div>
<details><summary>📜</summary>
<div id="cell-e0d3da90" class="observablehq observablehq--block"></div>
</details>
  <p><strong>See also</strong> more approximations for pi using calculang in my <a href="https://observablehq.com/@declann/its-pi-day">post from last year</a>; and a separate approximation using <a href="https://observablehq.com/@declann/monte-carlo-pi?collection=@declann/calculang">Monte Carlo methods</a>.</p>
</div>
</div>
<br>
<br>
<br>
<br>
<br>
<br>
<hr>
<h2 id="appendix-%26-source-code-of-%F0%9F%8E%A8" tabindex="-1"><a class="observablehq-header-anchor" href="#appendix-%26-source-code-of-%F0%9F%8E%A8">appendix &amp; source code of 🎨</a></h2>
<p><em>showing selected source code of 🎨</em></p>
<p>For complete source see <a href="https://github.com/declann/calculang-develop-with-framework/tree/dev">GitHub</a>.</p>
<details><summary>notes</summary>this is Javascript and using tools and patterns that I repeat, but remember that calculang is unopinionated!<br>
calculang/output is also highly portable and uniform.</details>
<hr>
<h2 id="visual-1" tabindex="-1"><a class="observablehq-header-anchor" href="#visual-1">visual 1</a></h2>
<div id="cell-5752734d" class="observablehq observablehq--block"></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> spec = ({
  <span class="hljs-comment">// vega-lite</span>
  <span class="hljs-attr">title</span>: <span class="hljs-string">"points"</span>,
  <span class="hljs-attr">mark</span>: {<span class="hljs-attr">type</span>:<span class="hljs-string">'point'</span>, <span class="hljs-attr">tooltip</span>:<span class="hljs-literal">true</span>, <span class="hljs-attr">filled</span>:<span class="hljs-literal">true</span>},
  <span class="hljs-attr">encoding</span>: {
    <span class="hljs-attr">x</span>: { <span class="hljs-attr">field</span>: <span class="hljs-string">'x'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'quantitative'</span>, <span class="hljs-attr">scale</span>: { <span class="hljs-attr">domain</span>: [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>]} },
    <span class="hljs-attr">y</span>: { <span class="hljs-attr">field</span>: <span class="hljs-string">'y'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'quantitative'</span>, <span class="hljs-attr">scale</span>: { <span class="hljs-attr">domain</span>: [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>]}  },
    <span class="hljs-attr">color</span>: {<span class="hljs-attr">field</span>: <span class="hljs-string">'inside'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'nominal'</span>, <span class="hljs-attr">sort</span>: <span class="hljs-string">'descending'</span>},
    <span class="hljs-attr">detail</span>: {<span class="hljs-attr">field</span>: <span class="hljs-string">'i_in'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'nominal'</span>},
  },
  <span class="hljs-attr">data</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">"data"</span> },
  <span class="hljs-attr">autosize</span>: { <span class="hljs-string">"type"</span>: <span class="hljs-string">"fit"</span>, <span class="hljs-string">"contains"</span>: <span class="hljs-string">"padding"</span>},
  <span class="hljs-attr">width</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-number">500</span>,rhs_width-<span class="hljs-number">30</span>),<span class="hljs-comment">//Math.min(400,rhs_width),</span>
  <span class="hljs-attr">height</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-number">500</span>,rhs_width-<span class="hljs-number">30</span>)/<span class="hljs-number">1.2</span>,<span class="hljs-comment">//Math.min(400,rhs_width-30),</span>
  <span class="hljs-attr">background</span>:<span class="hljs-string">'rgba(0,0,0,0)'</span>
})

<span class="hljs-comment">// interactivity via vega signals and listeners</span>
<span class="hljs-keyword">const</span> viz = <span class="hljs-title function_">embed</span>(<span class="hljs-string">'#viz'</span>, spec)
</code></pre>
<div id="cell-75d08f24" class="observablehq observablehq--block"></div>
<pre data-language="js"><code class="language-js"><span class="hljs-keyword">const</span> data_source = <span class="hljs-title function_">calcuvegadata</span>({
  <span class="hljs-attr">models</span>: [model],
  spec,
  <span class="hljs-attr">domains</span>: {
    <span class="hljs-attr">i_in</span>: _.<span class="hljs-title function_">range</span>(<span class="hljs-number">0</span>,n_in*n_in)
  },
  <span class="hljs-attr">input_cursors</span>: [
    { n_in }
  ]
})
</code></pre>
<div id="cell-7087a911" class="observablehq observablehq--block"></div>
<pre data-language="js"><code class="language-js">viz.<span class="hljs-property">view</span>.<span class="hljs-title function_">data</span>(<span class="hljs-string">"data"</span>, data_source)<span class="hljs-comment">/*.resize()*/</span>.<span class="hljs-title function_">run</span>(); <span class="hljs-comment">// turn off resize</span>
</code></pre>
<div id="cell-eb13376e" class="observablehq observablehq--block"></div>
<div id="cell-263dff7b" class="observablehq observablehq--block"></div>
<div id="cell-6a6f8c5a" class="observablehq observablehq--block"></div>
</main>
<footer id="observablehq-footer">
<div>Made with 💓 and <a href="https://calculang.dev">calculang</a></div>
</footer>
</div>
