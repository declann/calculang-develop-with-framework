<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>reactive inputs | some calculang things</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_import/custom-style.c46a1ffc.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_import/custom-style.c46a1ffc.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="modulepreload" href="./_observablehq/client.474fcddd.js">
<link rel="modulepreload" href="./_observablehq/runtime.ea5692e9.js">
<link rel="modulepreload" href="./_observablehq/stdlib.846450af.js">
<link rel="modulepreload" href="./_import/components/reactive-inputs.ab7bc931.js">
<link rel="modulepreload" href="./_import/components/helpers.e8ef0295.js">
<link rel="modulepreload" href="./_import/components/mini-calculang.12b2cf5c.js">
<link rel="modulepreload" href="./_import/components/scrubber.a71111d0.js">
<link rel="modulepreload" href="./_import/components/calcuvegadata.001efc7e.js">
<link rel="modulepreload" href="./_npm/vega-embed@6.24.0/83a96281.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/063eb405.js">
<link rel="modulepreload" href="./_npm/@tidyjs/tidy@2.5.2/9a1a3f2b.js">
<link rel="modulepreload" href="./_npm/compassql@0.21.2/e348eafb.js">
<link rel="modulepreload" href="./_npm/@babel/standalone@7.24.3/e4545a63.js">
<link rel="modulepreload" href="./_npm/@dagrejs/graphlib@2.2.1/f3b1bf6a.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.1ed87a87.js">
<link rel="modulepreload" href="./_npm/object-traversal@1.0.1/9530e55f.js">
<link rel="modulepreload" href="./_npm/underscore@1.13.6/2e88d8e6.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/c68fbd73.js">
<link rel="modulepreload" href="./_npm/fast-json-patch@3.1.1/06e2832a.js">
<link rel="modulepreload" href="./_npm/json-stringify-pretty-compact@3.0.0/3579fb4d.js">
<link rel="modulepreload" href="./_npm/vega@5.28.0/c0fb17ef.js">
<link rel="modulepreload" href="./_npm/vega-interpreter@1.0.5/aa0a0135.js">
<link rel="modulepreload" href="./_npm/vega-lite@5.17.0/a703af1d.js">
<link rel="modulepreload" href="./_npm/vega-schema-url-parser@2.2.0/6d1d9021.js">
<link rel="modulepreload" href="./_npm/vega-themes@2.14.0/1d1aba88.js">
<link rel="modulepreload" href="./_npm/vega-tooltip@0.34.0/79b8ab24.js">
<link rel="modulepreload" href="./_npm/d3-array@2.12.1/25a596fb.js">
<link rel="modulepreload" href="./_npm/vega-util@1.17.2/a0ac0a5c.js">
<link rel="modulepreload" href="./_npm/vega-dataflow@5.7.5/d3288fe8.js">
<link rel="modulepreload" href="./_npm/vega-transforms@4.11.1/a2d1adeb.js">
<link rel="modulepreload" href="./_npm/vega-view-transforms@4.5.9/019d8bbd.js">
<link rel="modulepreload" href="./_npm/vega-encode@4.9.2/530d6f45.js">
<link rel="modulepreload" href="./_npm/vega-geo@4.4.1/19012bd0.js">
<link rel="modulepreload" href="./_npm/vega-force@4.2.0/83ae76a1.js">
<link rel="modulepreload" href="./_npm/vega-hierarchy@4.1.1/78aa886f.js">
<link rel="modulepreload" href="./_npm/vega-label@1.2.1/1ace8a5c.js">
<link rel="modulepreload" href="./_npm/vega-regression@1.2.0/e0c6dc22.js">
<link rel="modulepreload" href="./_npm/vega-voronoi@4.2.2/1021ddd5.js">
<link rel="modulepreload" href="./_npm/vega-wordcloud@4.1.4/9bd2e068.js">
<link rel="modulepreload" href="./_npm/vega-crossfilter@4.1.1/d641f5ff.js">
<link rel="modulepreload" href="./_npm/vega-statistics@1.9.0/7174884a.js">
<link rel="modulepreload" href="./_npm/vega-time@2.1.1/e02eda9d.js">
<link rel="modulepreload" href="./_npm/vega-loader@4.5.1/3a29ac6c.js">
<link rel="modulepreload" href="./_npm/vega-scenegraph@4.11.2/1fc5bc2e.js">
<link rel="modulepreload" href="./_npm/vega-scale@7.3.1/feb4adbe.js">
<link rel="modulepreload" href="./_npm/vega-projection@1.6.0/2488de3e.js">
<link rel="modulepreload" href="./_npm/vega-view@5.12.0/4555d56f.js">
<link rel="modulepreload" href="./_npm/vega-format@1.1.1/4d53a048.js">
<link rel="modulepreload" href="./_npm/vega-functions@5.14.0/db1d7fb1.js">
<link rel="modulepreload" href="./_npm/vega-parser@6.3.0/9a5c816c.js">
<link rel="modulepreload" href="./_npm/vega-runtime@6.1.4/b3c1319b.js">
<link rel="modulepreload" href="./_npm/vega-expression@5.1.0/213d9651.js">
<link rel="modulepreload" href="./_npm/vega-event-selector@3.0.1/07d2b39d.js">
<link rel="modulepreload" href="./_npm/internmap@1.0.1/201227d2.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/e95f898e.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/034b7bcb.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/dcd02767.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/2c0cdfa2.js">
<link rel="modulepreload" href="./_npm/vega-canvas@1.2.7/6c089db6.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/5e1ff060.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/f1db2593.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/00c41b5d.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/5bc129e1.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/407f7a1f.js">
<link rel="modulepreload" href="./_npm/topojson-client@3.1.0/44d97fcb.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/f8e03c56.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/4bb53638.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/567840a0.js">
<link rel="modulepreload" href="./_npm/d3-geo-projection@4.0.0/91c31642.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/f31b5398.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/5851d7ef.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/19c92b44.js">
<link rel="modulepreload" href="./_npm/vega-selections@5.4.2/2e05850c.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/5eed35fd.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/aa5b35a8.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/b5f7cdc6.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/e67acb27.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/8ac9039b.js">
<script type="module">

import {define} from "./_observablehq/client.474fcddd.js";
import {registerFile} from "./_observablehq/stdlib.846450af.js";

registerFile("./cul/reactive.cul.js", {"name":"./cul/reactive.cul.js","mimeType":"text/javascript","path":"./_file/cul/reactive.cul.8e576073.js","lastModified":1712500412143});

define({id: "a0fb628d", outputs: ["up","upF"], body: async () => {
const {up, upF} = await import("./_import/components/reactive-inputs.ab7bc931.js");

return {up,upF};
}});

define({id: "6d34ce1d", inputs: ["Inputs"], outputs: ["minibinds"], body: (Inputs) => {
// define inputs
const minibinds = ({
  //c_in: Inputs.range([0,100], {label:'c_in', step:1}),
  a_in: Inputs.range([0,100], {label:'a_in', step:1}),
  t_in: Inputs.range([0,100], {label:'t_in', step:1}),
  month_in: Inputs.range([-1,20], {label:'month_in', step:1}),
  //  x_in: Inputs.range([0,100], {label:'x_in', step:1})
})
return {minibinds};
}});

define({id: "d11543fe", inputs: ["minibinds","inputs_ui"], outputs: ["fake"], body: (minibinds,inputs_ui) => {
minibinds; // when minibinds change, we really want to delete and recreate inputs
document.querySelectorAll('.inputs .flash').forEach(d => d.remove())
inputs_ui.dataset.inputs = '' // up ran first? so use fake to control order:
const fake = ''
return {fake};
}});

define({id: "0cec96ae", outputs: ["inputs_ui"], body: () => {
const inputs_ui = document.createElement('div')
inputs_ui.className = 'inputs'
return {inputs_ui};
}});

define({id: "4ebed23e", inputs: ["Inputs","Generators","display","inputs_ui"], outputs: ["cursor_Input","cursor"], body: (Inputs,Generators,display,inputs_ui) => {
console.log("don't repeat")

const cursor_Input = Inputs.input({})
const cursor = Generators.input(cursor_Input)
display(inputs_ui)
return {cursor_Input,cursor};
}});

define({id: "ab203c7a", body: () => {
//display(cursor)
}});

define({id: "a8cf02b7", body: () => {
//if (el.dataset.inputs == undefined) up(el, cursor_Input, inputs, model, minibinds);
}});

define({id: "03ae10b8", inputs: ["selected_formulae","introspection"], outputs: ["dependencies_set","dependencies"], body: (selected_formulae,introspection) => {
const dependencies_set = selected_formulae.filter(d => d.slice(-3) != '_in').map(e => introspection.cul_input_map[`0_${e}`]).reduce((acc,val) => new Set([...val, ...acc]), new Set())
const dependencies = [...dependencies_set]
return {dependencies_set,dependencies};
}});

define({id: "e21a943d", inputs: ["fake","cursor","up","inputs_ui","cursor_Input","dependencies","model","minibinds"], body: (fake,cursor,up,inputs_ui,cursor_Input,dependencies,model,minibinds) => {
fake;
cursor; // need to react to changes to cursor
up(inputs_ui, cursor_Input, dependencies, model, minibinds); // must keep minibinds sep. to pick up updates
// because needs to detect removal for flash (above)
}});

define({id: "bc8830ae", inputs: ["upF","selected_formulae_Input","formulae_not_inputs"], body: (upF,selected_formulae_Input,formulae_not_inputs) => {
upF(document.querySelector('#selected_formulae'), selected_formulae_Input, formulae_not_inputs);
}});

define({id: "76e0a08c", inputs: ["Inputs","formulae_not_inputs","Generators"], outputs: ["selected_formulae_Input","selected_formulae2"], body: (Inputs,formulae_not_inputs,Generators) => {
//const selected_formulae = view(Inputs.checkbox(formulae_not_inputs, {label: "formulae",  value: ["npv", "total_cf"]/*formulae_not_inputs*/}));

const selected_formulae_Input = Inputs.input(Object.fromEntries(formulae_not_inputs.map(d => [d, true])))//({answer:true})
const selected_formulae2 = Generators.input(selected_formulae_Input)
return {selected_formulae_Input,selected_formulae2};
}});

define({id: "64699760", inputs: ["selected_formulae2"], outputs: ["selected_formulae"], body: (selected_formulae2) => {
const selected_formulae = Object.entries(selected_formulae2).filter(([k,v]) => v).map(([k,v]) => k)
return {selected_formulae};
}});

define({id: "e19e429f", inputs: ["calcudata","model","cursor","selected_formulae"], outputs: ["data"], body: (calcudata,model,cursor,selected_formulae) => {
const data = calcudata({
    models: [model],
    input_domains: { },
    input_cursors: [cursor],
    outputs: selected_formulae
  })
return {data};
}});

define({id: "90d268f6", inputs: ["embed"], outputs: ["spec","viz"], body: (embed) => {
const spec = ({
  // vega-lite
  mark: {type:'text', tooltip:true, fontSize:20, align:'right', font:'monospace', fontWeight: 'bold'},
  encoding: {
    y: { field: 'formula', type: 'nominal' },
    color: { field: 'formula', type: 'nominal', legend: false },
    text: {field: 'value', type: 'nominal', format:',.2f'},
  },
  data: { name: "data" },
  width: 400,
  //height: 200,
})

const viz = embed('#viz', spec)

return {spec,viz};
}});

define({id: "d3f7891e", inputs: ["viz","data"], body: (viz,data) => {
viz.view.data("data", data)/*.resize()*/.run(); // turn off resize
}});

define({id: "c2da93d8", inputs: ["compile","cul_default","compileWithMemo","introspection2","invalidation"], outputs: ["esm_nomemo","esm","introspection","inputs","formulae_not_inputs","u","model"], body: async (compile,cul_default,compileWithMemo,introspection2,invalidation) => {
const esm_nomemo = compile(cul_default)
const esm = compileWithMemo(cul_default)
const introspection = introspection2(cul_default)

const inputs = [...introspection.cul_functions.values()].filter(d => d.reason == 'input definition').map(d => d.name).sort()

const formulae_not_inputs = [...introspection.cul_functions.values()].filter(d => d.reason == 'definition' && inputs.indexOf(d.name+'_in') == -1).map(d => d.name)


const u = URL.createObjectURL(new Blob([esm.code], { type: "text/javascript" }))
console.log(`creating ${u}`)

const model = await import(u)


invalidation.then(() => {console.log(`revoking ${u}`); URL.revokeObjectURL(u)});
return {esm_nomemo,esm,introspection,inputs,formulae_not_inputs,u,model};
}});

define({id: "36ae6da7", outputs: ["FileAttachment","cul_default","calcuvizspec","calcudata","compile","introspection2","compileWithMemo","Scrubber","calcuvegadata","embed_","embed"], body: async () => {
const [{FileAttachment}, {calcuvizspec, calcudata}, {compile, introspection2, compileWithMemo}, {Scrubber}, {calcuvegadata}, {default: embed_}] = await Promise.all([import("./_observablehq/stdlib.846450af.js"), import("./_import/components/helpers.e8ef0295.js"), import("./_import/components/mini-calculang.12b2cf5c.js"), import("./_import/components/scrubber.a71111d0.js"), import("./_import/components/calcuvegadata.001efc7e.js"), import("./_npm/vega-embed@6.24.0/83a96281.js")]);

const cul_default = await FileAttachment("./cul/reactive.cul.js").text()






const embed = (a,b,options) => embed_(a,b, {renderer:'svg', ...options});
return {FileAttachment,cul_default,calcuvizspec,calcudata,compile,introspection2,compileWithMemo,Scrubber,calcuvegadata,embed_,embed};
}});

define({id: "0dccca7a", inputs: ["view","Inputs"], outputs: ["esm_memo"], body: (view,Inputs) => {
const esm_memo = view(Inputs.toggle({label:'include memo optimisation code?'}))
return {esm_memo};
}});

define({id: "e2bad0c5", inputs: ["esm_memo","esm","esm_nomemo","display"], body: async (esm_memo,esm,esm_nomemo,display) => {
display(await(
esm_memo? esm.code : esm_nomemo.code
))
}});

define({id: "5571643d", inputs: ["introspection","display"], body: async (introspection,display) => {
display(await(
introspection.cul_links

))
}});

</script>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="./">some calculang things</a></li>
  </ol>
  <ol>
    <li class="observablehq-link"><a href="./TEMPLATE">Untitled</a></li>
    <li class="observablehq-link"><a href="./game-of-life">Game of Life (GALLERY DEV)</a></li>
    <li class="observablehq-link"><a href="./keep-car-cli">Keep 🚗 on the road</a></li>
    <li class="observablehq-link"><a href="./leafy-matrix">Leafy matrix 🍂🧑‍💻 (GALLERY DEV)</a></li>
    <li class="observablehq-link"><a href="./pi-lattice">Pi 🥮 by lattice (GALLERY DEV)</a></li>
    <li class="observablehq-link observablehq-link-active"><a href="./reactive-inputs">reactive inputs</a></li>
    <li class="observablehq-link"><a href="./savings">Savings Calculator 🪙🪙 (GALLERY DEV)</a></li>
    <li class="observablehq-link"><a href="./spirographs">Spirographs 🌀 (GALLERY DEV)</a></li>
    <li class="observablehq-link"><a href="./sun-moon-paths">☀️ and 🌝 Paths (GALLERY DEV)</a></li>
    <li class="observablehq-link"><a href="./sun-moon-paths2">☀️ and 🌝 Paths 2 (GALLERY DEV)</a></li>
    <li class="observablehq-link"><a href="./tixyish">tixy-ish 🎨</a></li>
    <li class="observablehq-link"><a href="./dungeon/dungeon">Dungeon Generator 👹👾🔫</a></li>
    <li class="observablehq-link"><a href="./graphing-calcs/graphing-edit-cm-gol-sand">Falling Sand (early)</a></li>
    <li class="observablehq-link"><a href="./graphing-calcs/graphing-edit-cm-gol">Editable Game of Life</a></li>
    <li class="observablehq-link"><a href="./graphing-calcs/graphing-edit-cm">Editable ❤️ CM (preview)</a></li>
    <li class="observablehq-link"><a href="./graphing-calcs/graphing-edit-music">Editable Music 🎶 (beta)</a></li>
    <li class="observablehq-link"><a href="./shader/shader">Editable Shader 🧊</a></li>
  </ol>
</nav>
<script>{Object.assign(document.createElement("a"),{href:""}).password&&location.replace(location.href);const e=document.querySelector("#observablehq-sidebar"),t=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?t.checked=r==="true":t.indeterminate=!0;for(const o of document.querySelectorAll("#observablehq-sidebar summary")){const s=o.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${o.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<details><summary>reactive todos</summary>
<ul>
<li>model default changes =&gt; change UI,
<ul>
<li>but only possible (w/o bombing user changes) if I track what user changed</li>
<li>state management? local storage?</li>
</ul>
</li>
</ul>
<div class="observablehq observablehq--block"><!--:a0fb628d:--></div>
<p>inputs, but move this to dependencies (see Layers)</p>
<p>first I need to add Outputs and</p>
<p>how will <code>up()</code> process/pick up changes to dependencies?</p>
</details>
<div class="observablehq observablehq--block"><!--:6d34ce1d:--></div>
<div class="observablehq observablehq--block"><!--:d11543fe:--></div>
<h3 id="inputs-ui" tabindex="-1"><a class="observablehq-header-anchor" href="#inputs-ui">inputs ui:</a></h3>
<p>Reactive UI for OPTIONAL amt of things. Restricted to relevant inputs</p>
<div class="observablehq observablehq--block"><!--:0cec96ae:--></div>
<div class="observablehq observablehq--block"><!--:4ebed23e:--></div>
<div class="observablehq observablehq--block"><!--:ab203c7a:--></div>
<div class="observablehq observablehq--block"><!--:a8cf02b7:--></div>
<div class="observablehq observablehq--block"><!--:03ae10b8:--></div>
<div class="observablehq observablehq--block"><!--:e21a943d:--></div>
<form id="selected_formulae"></form>
<div class="observablehq observablehq--block"><!--:bc8830ae:--></div>
<p><em>reactivity broken on model edit due to formulae_not_inputs -&gt; selected_formulae</em></p>
<div class="observablehq observablehq--block"><!--:76e0a08c:--></div>
<div class="observablehq observablehq--block"><!--:64699760:--></div>
<div id="viz"></div>
<div class="observablehq observablehq--block"><!--:e19e429f:--></div>
<div class="observablehq observablehq--block"><!--:90d268f6:--></div>
<div class="observablehq observablehq--block"><!--:d3f7891e:--></div>
<h2 id="domains" tabindex="-1"><a class="observablehq-header-anchor" href="#domains">Domains</a></h2>
<p>Now TODO domain things =&gt; reactive calcudata call</p>
<div class="observablehq observablehq--block"><!--:c2da93d8:--></div>
<div class="observablehq observablehq--block"><!--:36ae6da7:--></div>
<details><summary>calculang -&gt; esm</summary>
<p>ESM output</p>
<div class="observablehq observablehq--block"><!--:0dccca7a:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:e2bad0c5:--></div>
<pre data-language="js"><code class="language-js">esm_memo? esm.<span class="hljs-property">code</span> : esm_nomemo.<span class="hljs-property">code</span>
</code></pre>
</details>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:5571643d:--></div>
</main>
<footer id="observablehq-footer">
<div>Made with 💓 and <a href="https://calculang.dev" target="_blank" rel="noopener noreferrer">calculang</a></div>
</footer>
</div>
